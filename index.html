<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ŸÜÿ∏ÿßŸÖ ÿ•ÿØÿßÿ±ÿ© ÿßŸÑÿ≠ÿ∂Ÿàÿ± ŸàÿßŸÑÿ∫Ÿäÿßÿ® ÿßŸÑŸÖÿ™ŸÇÿØŸÖ</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
    
    <link rel="manifest" href="https://yasminnmain44-design.github.io/Management/manifest.json">
    
    <link rel="manifest" href="data:application/manifest+json,{
      &quot;name&quot;: &quot;ŸÜÿ∏ÿßŸÖ ÿ•ÿØÿßÿ±ÿ© ÿßŸÑÿ≠ÿ∂Ÿàÿ± ŸàÿßŸÑÿ∫Ÿäÿßÿ®&quot;,
      &quot;short_name&quot;: &quot;ÿßŸÑÿ≠ÿ∂Ÿàÿ±&quot;,
      &quot;start_url&quot;: &quot;https://yasminnmain44-design.github.io/Management/&quot;,
      &quot;display&quot;: &quot;standalone&quot;,
      &quot;background_color&quot;: &quot;#3498db&quot;,
      &quot;theme_color&quot;: &quot;#2c3e50&quot;,
      &quot;icons&quot;: [
        {
          &quot;src&quot;: &quot;https://yasminnmain44-design.github.io/Management/icon-192.png&quot;,
          &quot;sizes&quot;: &quot;192x192&quot;,
          &quot;type&quot;: &quot;image/png&quot;
        },
        {
          &quot;src&quot;: &quot;https://yasminnmain44-design.github.io/Management/icon-512.png&quot;,
          &quot;sizes&quot;: &quot;512x512&quot;,
          &quot;type&quot;: &quot;image/png&quot;
        }
      ]
    }">
    
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ccircle cx='50' cy='50' r='45' fill='%233498db'/%3E%3Ctext x='50' y='70' font-size='50' text-anchor='middle' fill='white' font-family='Arial'%3Eüë§%3C/text%3E%3C/svg%3E" type="image/svg+xml">
    
    <style>
        :root {
            --primary: #3498db;
            --secondary: #2c3e50;
            --success: #27ae60;
            --warning: #f39c12;
            --danger: #e74c3c;
            --light: #ecf0f1;
            --dark: #2c3e50;
            --purple: #9b59b6;
            --orange: #e67e22;
            --cash: #f1c40f;
            --cash-dark: #f39c12;
            --negative: #e74c3c;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #f5f7fa;
            color: #333;
            direction: rtl;
            overflow-x: hidden;
            font-size: 16px;
        }

        .app-container {
            max-width: 100%;
            margin: 0 auto;
            background: white;
            min-height: 100vh;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            position: relative;
        }

        .app-header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            padding: 12px 15px;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .app-title {
            font-size: 1.2rem;
            font-weight: 700;
        }

        .header-actions {
            display: flex;
            gap: 10px;
        }

        .header-action-btn {
            background: rgba(255,255,255,0.2);
            border: none;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
            cursor: pointer;
        }

        .side-menu {
            position: fixed;
            top: 0;
            right: -300px;
            width: 300px;
            height: 100%;
            background: white;
            box-shadow: -2px 0 10px rgba(0,0,0,0.1);
            z-index: 200;
            transition: right 0.3s ease;
            padding: 20px;
            overflow-y: auto;
        }

        .side-menu.active {
            right: 0;
        }

        .side-menu-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }

        .side-menu-title {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--secondary);
        }

        .close-menu {
            background: none;
            border: none;
            font-size: 1.3rem;
            color: #666;
            cursor: pointer;
        }

        .menu-items {
            list-style: none;
        }

        .menu-item {
            margin-bottom: 10px;
        }

        .menu-link {
            display: flex;
            align-items: center;
            padding: 12px 15px;
            color: #333;
            text-decoration: none;
            border-radius: 8px;
            transition: all 0.3s;
        }

        .menu-link:hover, .menu-link.active {
            background: var(--primary);
            color: white;
        }

        .menu-link i {
            margin-left: 10px;
            font-size: 1.1rem;
        }

        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 150;
            display: none;
        }

        .overlay.active {
            display: block;
        }

        .bottom-nav {
            position: fixed;
            bottom: 0;
            right: 0;
            left: 0;
            background: white;
            display: flex;
            justify-content: space-between;
            padding: 10px 5px;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
            z-index: 100;
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-decoration: none;
            color: #666;
            font-size: 0.7rem;
            flex: 1;
            padding: 5px 0;
            cursor: pointer;
            border-radius: 8px;
            margin: 0 2px;
            transition: all 0.3s;
            max-width: 20%;
        }

        .nav-item.active {
            color: var(--primary);
            background-color: rgba(52, 152, 219, 0.1);
        }

        .nav-icon {
            font-size: 1.1rem;
            margin-bottom: 4px;
        }

        .main-content {
            padding: 15px;
            padding-bottom: 70px;
        }

        .stats-container {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            margin-bottom: 15px;
        }

        .stat-card {
            background: white;
            border-radius: 8px;
            padding: 10px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.08);
            text-align: center;
            border-top: 3px solid var(--primary);
            display: flex;
            flex-direction: column;
            justify-content: center;
            min-height: 70px;
        }

        .stat-value {
            font-size: 1rem;
            font-weight: bold;
            margin: 3px 0;
            color: var(--primary);
            line-height: 1.2;
        }

        .stat-title {
            color: #666;
            font-size: 0.7rem;
            margin-bottom: 5px;
            line-height: 1.2;
        }

        .card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
            margin-bottom: 15px;
            overflow: hidden;
        }

        .card-header {
            padding: 15px;
            background: var(--primary);
            color: white;
            font-weight: bold;
            font-size: 1.1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .card-body {
            padding: 15px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #555;
            font-size: 0.95rem;
        }

        input, select, textarea {
            width: 100%;
            padding: 14px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            transition: border 0.3s;
            background: #f9f9f9;
        }

        input:focus, select:focus, textarea:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
            background: white;
        }

        button {
            background: var(--primary);
            color: white;
            border: none;
            padding: 14px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s;
            font-weight: 500;
            width: 100%;
        }

        button:hover {
            background: #2980b9;
        }

        .btn-success {
            background: var(--success);
        }

        .btn-success:hover {
            background: #219653;
        }

        .btn-warning {
            background: var(--warning);
        }

        .btn-warning:hover {
            background: #e67e22;
        }

        .btn-danger {
            background: var(--danger);
        }

        .btn-danger:hover {
            background: #c0392b;
        }

        .btn-secondary {
            background: var(--secondary);
        }

        .btn-secondary:hover {
            background: #1a252f;
        }

        .btn-purple {
            background: var(--purple);
        }

        .btn-purple:hover {
            background: #8e44ad;
        }

        .btn-orange {
            background: var(--orange);
        }

        .btn-orange:hover {
            background: #d35400;
        }

        .btn-cash {
            background: linear-gradient(135deg, var(--cash) 0%, var(--cash-dark) 100%);
        }

        .btn-cash:hover {
            background: #f39c12;
        }

        .table-container {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            margin-bottom: 15px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 500px;
        }

        th, td {
            padding: 12px 10px;
            text-align: right;
            border-bottom: 1px solid #e0e0e0;
            font-size: 0.9rem;
        }

        th {
            background-color: #f8f9fa;
            font-weight: 600;
            color: #555;
        }

        tr:hover {
            background-color: #f9f9f9;
        }

        .actions {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .actions button {
            padding: 8px 12px;
            font-size: 0.85rem;
            width: 100%;
        }

        .tabs {
            display: flex;
            border-bottom: 1px solid #ddd;
            margin-bottom: 15px;
            overflow-x: auto;
        }

        .tab {
            padding: 12px 15px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
            font-weight: 500;
            white-space: nowrap;
        }

        .tab.active {
            border-bottom: 3px solid var(--primary);
            color: var(--primary);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .list-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid #eee;
            flex-wrap: wrap;
        }

        .list-item:last-child {
            border-bottom: none;
        }

        .item-info {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 5px;
            min-width: 200px;
        }

        .item-title {
            font-weight: 600;
            margin-bottom: 0;
        }

        .item-subtitle {
            color: #666;
            font-size: 0.9rem;
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
        }

        .item-subtitle span {
            display: inline-block;
        }

        .item-actions {
            display: flex;
            flex-direction: column;
            gap: 5px;
            min-width: 120px;
            margin-right: auto;
            margin-left: 10px;
        }

        .status-present {
            color: var(--success);
            font-weight: bold;
        }

        .status-absent {
            color: var(--danger);
            font-weight: bold;
        }

        .status-leave {
            color: var(--warning);
            font-weight: bold;
        }

        .status-fixed {
            color: var(--success);
            font-weight: bold;
        }

        .status-in-progress {
            color: var(--warning);
            font-weight: bold;
        }

        .status-pending {
            color: var(--danger);
            font-weight: bold;
        }

        .cash-positive {
            color: var(--success);
            font-weight: bold;
            background: rgba(39, 174, 96, 0.1);
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.85rem;
        }

        .cash-negative {
            color: var(--negative);
            font-weight: bold;
            background: rgba(231, 76, 60, 0.1);
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.85rem;
        }

        .quick-actions {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            margin-bottom: 15px;
        }

        .quick-action {
            background: white;
            border-radius: 8px;
            padding: 10px 5px;
            text-align: center;
            box-shadow: 0 2px 6px rgba(0,0,0,0.08);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
            min-height: 70px;
        }

        .quick-action:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .quick-action i {
            font-size: 1.2rem;
            margin-bottom: 5px;
            color: var(--primary);
        }

        .quick-action span {
            font-weight: 600;
            font-size: 0.75rem;
            line-height: 1.2;
        }

        .see-all {
            font-size: 0.9rem;
            cursor: pointer;
            opacity: 0.8;
        }

        .see-all:hover {
            opacity: 1;
        }

        .btn-edit {
            background: var(--warning);
        }
        
        .btn-edit:hover {
            background: #e67e22;
        }
        
        .btn-delete {
            background: var(--danger);
        }
        
        .btn-delete:hover {
            background: #c0392b;
        }

        .btn-activate {
            background: var(--success);
        }
        
        .btn-activate:hover {
            background: #219653;
        }

        .btn-deactivate {
            background: #95a5a6;
        }
        
        .btn-deactivate:hover {
            background: #7f8c8d;
        }

        .btn-whatsapp {
            background: #25D366;
        }
        
        .btn-whatsapp:hover {
            background: #128C7E;
        }

        .btn-call {
            background: #3498db;
        }
        
        .btn-call:hover {
            background: #2980b9;
        }

        @media (max-width: 360px) {
            .stats-container {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .quick-actions {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .main-content {
                padding: 10px;
                padding-bottom: 70px;
            }
            
            .app-title {
                font-size: 1.1rem;
            }
            
            .stat-card, .quick-action {
                min-height: 65px;
            }
            
            .stat-value {
                font-size: 0.9rem;
            }
            
            .stat-title, .quick-action span {
                font-size: 0.65rem;
            }
            
            .item-actions {
                min-width: 100%;
                margin-top: 10px;
            }
        }

        @media (min-width: 768px) {
            .app-container {
                max-width: 500px;
                margin: 0 auto;
            }
            
            .stats-container, .quick-actions {
                gap: 12px;
            }
            
            .stat-card, .quick-action {
                min-height: 80px;
            }
        }

        .backup-section {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #eee;
        }

        .backup-buttons {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .backup-buttons button {
            flex: 1;
        }
        
        .empty-state {
            text-align: center;
            color: #666;
            padding: 20px;
            font-style: italic;
        }

        .employee-status {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: bold;
        }
        
        .status-active {
            background-color: rgba(39, 174, 96, 0.1);
            color: var(--success);
        }
        
        .status-inactive {
            background-color: rgba(149, 165, 166, 0.1);
            color: #7f8c8d;
        }

        .employee-details-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
            margin-bottom: 15px;
            overflow: hidden;
        }

        .employee-details-header {
            padding: 15px;
            background: var(--primary);
            color: white;
            font-weight: bold;
            font-size: 1.1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .employee-details-body {
            padding: 15px;
        }

        .employee-info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .info-item {
            display: flex;
            flex-direction: column;
        }

        .info-label {
            font-weight: 600;
            color: #555;
            margin-bottom: 5px;
        }

        .info-value {
            color: #333;
        }

        .employee-actions {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 15px;
        }

        .employee-actions button {
            flex: 1;
            min-width: 80px;
            padding: 10px 8px;
            font-size: 0.8rem;
            white-space: nowrap;
        }

        .nav-item-attendance {
            background-color: var(--success);
            color: white;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-top: -20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }

        .nav-item-attendance .nav-icon {
            font-size: 1.3rem;
            margin-bottom: 0;
        }

        .nav-item-attendance .nav-text {
            display: none;
        }

        .add-employee-db {
            margin-bottom: 20px;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
            margin-right: 10px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .connection-status {
            position: fixed;
            top: 10px;
            left: 10px;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 12px;
            z-index: 1000;
        }

        .connection-online {
            background-color: var(--success);
            color: white;
        }

        .connection-offline {
            background-color: var(--danger);
            color: white;
        }
        
        .cash-tabs {
            display: flex;
            border-bottom: 1px solid #ddd;
            margin-bottom: 15px;
            overflow-x: auto;
        }
        
        .cash-tab {
            flex: 1;
            padding: 12px 15px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
            font-weight: 500;
            white-space: nowrap;
            text-align: center;
        }
        
        .cash-tab.active {
            border-bottom: 3px solid var(--primary);
            color: var(--primary);
            background: rgba(52, 152, 219, 0.05);
        }
        
        .cash-tab-content {
            display: none;
        }
        
        .cash-tab-content.active {
            display: block;
        }
        
        .cash-summary {
            background: linear-gradient(135deg, rgba(241, 196, 15, 0.1) 0%, rgba(243, 156, 18, 0.05) 100%);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 20px;
            border: 1px solid rgba(241, 196, 15, 0.3);
        }
        
        .cash-summary-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid rgba(241, 196, 15, 0.2);
        }
        
        .cash-summary-item:last-child {
            border-bottom: none;
        }
        
        .cash-summary-label {
            font-weight: 600;
            color: #555;
        }
        
        .cash-summary-value {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--cash-dark);
        }
        
        .cash-summary-value.negative {
            color: var(--negative);
        }
        
        .cash-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .cash-stat-card {
            background: white;
            border-radius: 10px;
            padding: 15px 5px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            border-top: 3px solid var(--cash);
        }
        
        .cash-stat-value {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--cash-dark);
            margin: 5px 0;
        }
        
        .cash-stat-value.negative {
            color: var(--negative);
        }
        
        .cash-stat-label {
            color: #666;
            font-size: 0.8rem;
        }
        
        .filter-with-button {
            display: flex;
            gap: 10px;
            align-items: flex-end;
        }
        
        .filter-with-button .form-group {
            flex: 1;
            margin-bottom: 0;
        }
        
        .filter-with-button button {
            width: auto;
            padding: 14px 20px;
            height: 52px;
            white-space: nowrap;
        }
        
        .validation-error {
            color: var(--danger);
            font-size: 0.8rem;
            margin-top: 5px;
            display: none;
        }
        
        .input-error {
            border-color: var(--danger);
        }
        
        .hidden {
            display: none;
        }

        .import-section {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #eee;
        }

        .import-actions {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .import-actions button {
            flex: 1;
        }

        .import-preview {
            margin-top: 15px;
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 10px;
            background-color: #f9f9f9;
        }

        .import-preview table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.85rem;
        }

        .import-preview th, .import-preview td {
            padding: 8px;
            text-align: right;
            border-bottom: 1px solid #e0e0e0;
        }

        .import-preview th {
            background-color: #f0f0f0;
            font-weight: 600;
        }

        .import-status {
            margin-top: 10px;
            padding: 10px;
            border-radius: 8px;
            font-size: 0.9rem;
        }

        .import-success {
            background-color: rgba(39, 174, 96, 0.1);
            color: var(--success);
            border: 1px solid rgba(39, 174, 96, 0.3);
        }

        .import-error {
            background-color: rgba(231, 76, 60, 0.1);
            color: var(--danger);
            border: 1px solid rgba(231, 76, 60, 0.3);
        }

        .import-warning {
            background-color: rgba(243, 156, 18, 0.1);
            color: var(--warning);
            border: 1px solid rgba(243, 156, 18, 0.3);
        }

        .import-info {
            background-color: rgba(52, 152, 219, 0.1);
            color: var(--primary);
            border: 1px solid rgba(52, 152, 219, 0.3);
        }

        .import-template {
            margin-top: 10px;
            padding: 10px;
            background-color: #f5f5f5;
            border-radius: 8px;
            font-size: 0.85rem;
        }

        .import-template ul {
            margin: 10px 0;
            padding-right: 20px;
        }

        .import-template li {
            margin-bottom: 5px;
        }

        .contacts-import-section {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #eee;
        }

        .contacts-import-actions {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 10px;
        }

        .contacts-import-actions button {
            width: 100%;
        }

        .contacts-preview {
            margin-top: 15px;
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 10px;
            background-color: #f9f9f9;
        }

        .contacts-preview table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.85rem;
        }

        .contacts-preview th, .contacts-preview td {
            padding: 8px;
            text-align: right;
            border-bottom: 1px solid #e0e0e0;
        }

        .contacts-preview th {
            background-color: #f0f0f0;
            font-weight: 600;
        }

        .contact-checkbox {
            width: 20px;
            height: 20px;
        }

        .contacts-selection {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .contacts-selection-actions {
            display: flex;
            gap: 5px;
        }

        .contacts-selection-actions button {
            padding: 5px 10px;
            font-size: 0.8rem;
            width: auto;
        }

        .employee-report-section {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #eee;
        }

        .employee-report-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
            margin-bottom: 20px;
            overflow: hidden;
            border: 1px solid #e0e0e0;
        }

        .employee-report-header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            padding: 15px;
            font-size: 1.2rem;
            font-weight: bold;
        }

        .employee-report-body {
            padding: 20px;
        }

        .report-info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 1px solid #e0e0e0;
        }

        .report-info-item {
            display: flex;
            flex-direction: column;
        }

        .report-info-label {
            font-weight: 600;
            color: #555;
            margin-bottom: 5px;
            font-size: 0.9rem;
        }

        .report-info-value {
            color: var(--primary);
            font-size: 1.1rem;
            font-weight: bold;
        }

        .daily-report-table {
            margin-top: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            overflow: hidden;
            background: white;
        }

        .daily-report-table table {
            width: 100%;
            border-collapse: collapse;
        }

        .daily-report-table th {
            background-color: var(--primary);
            color: white;
            font-weight: 600;
            padding: 12px;
            text-align: center;
            border: 1px solid #2980b9;
        }

        .daily-report-table td {
            padding: 10px;
            text-align: center;
            border: 1px solid #e0e0e0;
        }

        .daily-report-table tr:nth-child(even) {
            background-color: #f8f9fa;
        }

        .daily-report-table tr:hover {
            background-color: #e8f4f8;
        }

        .day-name {
            font-weight: 600;
            color: var(--secondary);
        }

        .salary-summary {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 12px;
            padding: 25px;
            margin-top: 25px;
            border: 2px solid var(--primary);
        }

        .salary-summary h4 {
            color: var(--secondary);
            margin-bottom: 20px;
            text-align: center;
            font-size: 1.2rem;
            border-bottom: 2px solid var(--primary);
            padding-bottom: 10px;
        }

        .salary-breakdown {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }

        .breakdown-item {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.08);
            border-right: 5px solid var(--primary);
            transition: transform 0.2s;
        }

        .breakdown-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 12px rgba(0,0,0,0.12);
        }

        .breakdown-label {
            font-weight: 600;
            color: #666;
            margin-bottom: 10px;
            font-size: 1rem;
        }

        .breakdown-value {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--primary);
        }

        .breakdown-value.positive {
            color: var(--success);
        }

        .breakdown-value.negative {
            color: var(--danger);
        }

        .net-salary {
            text-align: center;
            padding: 25px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            border-radius: 12px;
            margin-top: 20px;
        }

        .net-salary h3 {
            margin: 0;
            font-size: 2rem;
            font-weight: bold;
        }
        
        .date-range-filter {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        .date-range-filter .form-group {
            flex: 1;
            min-width: 150px;
            margin-bottom: 0;
        }
        
        .date-filter-actions {
            display: flex;
            gap: 5px;
            align-items: flex-end;
        }
        
        .date-filter-actions button {
            width: auto;
            padding: 10px 15px;
            height: 46px;
        }
        
        .export-report-btn {
            width: auto;
            padding: 8px 15px;
            font-size: 0.9rem;
            margin-left: 10px;
        }

        .report-controls {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            border: 1px solid #e0e0e0;
            margin-bottom: 20px;
        }

        .report-controls .form-group {
            margin-bottom: 15px;
        }

        .generate-report-btn {
            background: var(--success);
            font-size: 1.1rem;
            padding: 15px;
            margin-top: 10px;
        }

        .generate-report-btn i {
            margin-left: 10px;
        }

        .report-container {
            background: white;
            border-radius: 12px;
            border: 1px solid #e0e0e0;
            margin-top: 20px;
        }

        .report-header {
            background: var(--secondary);
            color: white;
            padding: 15px;
            border-radius: 12px 12px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .report-header h3 {
            margin: 0;
            font-size: 1.2rem;
        }

        .report-actions {
            display: flex;
            gap: 10px;
        }

        .report-actions button {
            width: auto;
            padding: 8px 15px;
            font-size: 0.9rem;
        }

        .summary-badge {
            background: white;
            color: var(--secondary);
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
        }

        .attendance-stats {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin: 15px 0;
        }

        .attendance-stat {
            flex: 1;
            min-width: 120px;
            background: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            border: 1px solid #e0e0e0;
        }

        .attendance-stat.present {
            border-top: 3px solid var(--success);
        }

        .attendance-stat.absent {
            border-top: 3px solid var(--danger);
        }

        .attendance-stat.leave {
            border-top: 3px solid var(--warning);
        }

        .attendance-stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            margin: 5px 0;
        }

        .attendance-stat-label {
            color: #666;
            font-size: 0.9rem;
        }

        .station-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: bold;
            background-color: rgba(52, 152, 219, 0.1);
            color: var(--primary);
        }

        .station-type {
            display: inline-block;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 0.7rem;
            background-color: #f0f0f0;
            color: #555;
            margin-left: 5px;
        }

        .filter-section {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            border: 1px solid #e0e0e0;
        }

        .filter-section h4 {
            margin-bottom: 10px;
            color: var(--secondary);
        }

        .filter-row {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            align-items: flex-end;
        }

        .filter-row .form-group {
            flex: 1;
            min-width: 150px;
            margin-bottom: 0;
        }

        .filter-actions {
            display: flex;
            gap: 5px;
            min-width: 100px;
        }

        .filter-actions button {
            width: auto;
            padding: 10px 15px;
            height: 46px;
        }

        .fault-status {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: bold;
        }

        .fault-fixed {
            background-color: rgba(39, 174, 96, 0.1);
            color: var(--success);
        }

        .fault-in-progress {
            background-color: rgba(243, 156, 18, 0.1);
            color: var(--warning);
        }

        .fault-pending {
            background-color: rgba(231, 76, 60, 0.1);
            color: var(--danger);
        }
        
        .retry-button {
            background: var(--warning);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            margin-top: 10px;
            width: auto;
        }
        
        .retry-button:hover {
            background: #e67e22;
        }
        
        .loading-container {
            text-align: center;
            padding: 20px;
        }
        
        .error-container {
            text-align: center;
            padding: 20px;
            color: var(--danger);
        }
        
        .attendance-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 15px;
            border-bottom: 1px solid #eee;
        }
        .attendance-item:last-child {
            border-bottom: none;
        }
        .attendance-employee-info {
            display: flex;
            flex-direction: column;
            gap: 3px;
        }
        .attendance-employee-name {
            font-weight: 600;
        }
        .attendance-employee-details {
            font-size: 0.8rem;
            color: #555;
            display: flex;
            gap: 10px;
        }
        .attendance-supervisor {
            color: #777;
        }
        .attendance-status-badge {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
            min-width: 60px;
        }
        .status-present-badge {
            background-color: rgba(39, 174, 96, 0.1);
            color: var(--success);
        }
        .status-leave-badge {
            background-color: rgba(243, 156, 18, 0.1);
            color: var(--warning);
        }
        .filter-with-button {
            display: flex;
            gap: 10px;
            align-items: flex-end;
        }
        .filter-with-button .form-group {
            flex: 1;
            margin-bottom: 0;
        }
        .filter-with-button button {
            width: auto;
            padding: 14px 20px;
            height: 52px;
            white-space: nowrap;
        }
        .station-group {
            margin-bottom: 20px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            overflow: hidden;
        }
        .station-group-header {
            background-color: var(--primary);
            color: white;
            padding: 12px 15px;
            font-weight: bold;
            font-size: 1.1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .station-group-body {
            padding: 5px 0;
        }
        .station-group-body .attendance-item {
            padding: 10px 20px;
        }
        .station-group-body .attendance-item:last-child {
            border-bottom: none;
        }
        .station-employee-count {
            background-color: rgba(255,255,255,0.2);
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
        }

        /* ÿ£ŸÜŸÖÿßÿ∑ ÿßŸÑÿπŸáÿØÿ© ÿßŸÑŸÖÿ≠ÿ≥ŸÜÿ© */
        .cash-stats-container {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }

        .cash-stat-box {
            background: white;
            border-radius: 12px;
            padding: 15px 5px;
            text-align: center;
            box-shadow: 0 3px 10px rgba(0,0,0,0.08);
            border-top: 4px solid var(--cash);
        }

        .cash-stat-box.negative-balance {
            border-top-color: var(--negative);
        }

        .cash-stat-icon {
            font-size: 1.5rem;
            color: var(--cash-dark);
            margin-bottom: 8px;
        }

        .cash-stat-box.negative-balance .cash-stat-icon {
            color: var(--negative);
        }

        .cash-stat-box.negative-balance .cash-stat-number {
            color: var(--negative);
        }

        .cash-stat-number {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--cash-dark);
            margin: 5px 0;
        }

        .cash-stat-label {
            color: #666;
            font-size: 0.8rem;
        }

        .cash-dashboard-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin: 10px 0;
        }

        .cash-dashboard-item {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 10px;
            padding: 10px;
            text-align: center;
        }

        .cash-dashboard-label {
            color: #555;
            font-size: 0.8rem;
            margin-bottom: 5px;
        }

        .cash-dashboard-value {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--cash-dark);
        }

        .cash-dashboard-value.negative {
            color: var(--negative);
        }

        .alert {
            padding: 12px 15px;
            border-radius: 8px;
            margin: 10px 0;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .alert-warning {
            background: rgba(243, 156, 18, 0.1);
            color: var(--warning);
            border: 1px solid rgba(243, 156, 18, 0.3);
        }

        .alert-info {
            background: rgba(52, 152, 219, 0.1);
            color: var(--primary);
            border: 1px solid rgba(52, 152, 219, 0.3);
        }

        .alert i {
            font-size: 1.1rem;
        }
    </style>
    
    <script>
        // Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('https://yasminnmain44-design.github.io/Management/service-worker.js')
                    .catch(function(error) {
                        console.log('ServiceWorker registration failed: ', error);
                        registerDynamicServiceWorker();
                    });
            });
        }
        
        function registerDynamicServiceWorker() {
            const swCode = `
                const CACHE_NAME = 'attendance-cache-v1';
                const urlsToCache = [
                    'https://yasminnmain44-design.github.io/Management/',
                    'https://yasminnmain44-design.github.io/Management/index.html',
                    'https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css',
                    'https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js',
                    'https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js',
                    'https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js'
                ];

                self.addEventListener('install', function(event) {
                    event.waitUntil(
                        caches.open(CACHE_NAME)
                            .then(function(cache) {
                                console.log('Opened cache');
                                return cache.addAll(urlsToCache);
                            })
                    );
                });

                self.addEventListener('fetch', function(event) {
                    event.respondWith(
                        caches.match(event.request)
                            .then(function(response) {
                                if (response) {
                                    return response;
                                }
                                return fetch(event.request);
                            })
                    );
                });
            `;
            
            const blob = new Blob([swCode], { type: 'application/javascript' });
            const url = URL.createObjectURL(blob);
            
            navigator.serviceWorker.register(url).catch(function(error) {
                console.log('Dynamic ServiceWorker registration failed: ', error);
            });
        }
    </script>
</head>
<body>
    <div class="app-container">
        <header class="app-header">
            <div class="header-top">
                <div class="app-title" id="pageTitle">ŸÑŸàÿ≠ÿ© ÿßŸÑÿ™ÿ≠ŸÉŸÖ</div>
                <div class="header-actions">
                    <button class="header-action-btn" id="exportBtn">
                        <i class="fas fa-file-export"></i>
                    </button>
                    <button class="header-action-btn" id="menuBtn">
                        <i class="fas fa-bars"></i>
                    </button>
                </div>
            </div>
        </header>

        <div id="connectionStatus" class="connection-status connection-online">
            <i class="fas fa-wifi"></i> ŸÖÿ™ÿµŸÑ ÿ®ŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿ≥ÿ≠ÿßÿ®Ÿäÿ©
        </div>

        <div class="side-menu" id="sideMenu">
            <div class="side-menu-header">
                <div class="side-menu-title">ÿßŸÑŸÇÿßÿ¶ŸÖÿ© ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©</div>
                <button class="close-menu" id="closeMenu">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <ul class="menu-items">
                <li class="menu-item">
                    <a href="#" class="menu-link active" data-target="dashboard">
                        <i class="fas fa-home"></i>
                        <span>ŸÑŸàÿ≠ÿ© ÿßŸÑÿ™ÿ≠ŸÉŸÖ</span>
                    </a>
                </li>
                <li class="menu-item">
                    <a href="#" class="menu-link" data-target="employees">
                        <i class="fas fa-users"></i>
                        <span>ÿ•ÿØÿßÿ±ÿ© ÿßŸÑŸÖŸàÿ∏ŸÅŸäŸÜ</span>
                    </a>
                </li>
                <li class="menu-item">
                    <a href="#" class="menu-link" data-target="employee-database">
                        <i class="fas fa-address-book"></i>
                        <span>ŸÇÿßÿπÿØÿ© ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸÖŸàÿ∏ŸÅŸäŸÜ</span>
                    </a>
                </li>
                <li class="menu-item">
                    <a href="#" class="menu-link" data-target="attendance">
                        <i class="fas fa-calendar-check"></i>
                        <span>ÿßŸÑÿ≠ÿ∂Ÿàÿ± ŸàÿßŸÑÿ∫Ÿäÿßÿ®</span>
                    </a>
                </li>
                <li class="menu-item">
                    <a href="#" class="menu-link" data-target="leaves">
                        <i class="fas fa-umbrella-beach"></i>
                        <span>ÿ•ÿØÿßÿ±ÿ© ÿßŸÑÿ•ÿ¨ÿßÿ≤ÿßÿ™</span>
                    </a>
                </li>
                <li class="menu-item">
                    <a href="#" class="menu-link" data-target="employee-records">
                        <i class="fas fa-user-circle"></i>
                        <span>ÿ≥ÿ¨ŸÑ ÿßŸÑŸÖŸàÿ∏ŸÅŸäŸÜ</span>
                    </a>
                </li>
                <li class="menu-item">
                    <a href="#" class="menu-link" data-target="financial">
                        <i class="fas fa-hand-holding-usd"></i>
                        <span>ÿßŸÑÿ≥ŸÑŸÅ ŸàÿßŸÑŸÖŸÉÿßŸÅÿ¢ÿ™</span>
                    </a>
                </li>
                <li class="menu-item">
                    <a href="#" class="menu-link" data-target="reports">
                        <i class="fas fa-chart-bar"></i>
                        <span>ÿßŸÑÿ™ŸÇÿßÿ±Ÿäÿ±</span>
                    </a>
                </li>
                <li class="menu-item">
                    <a href="#" class="menu-link" data-target="cash">
                        <i class="fas fa-wallet"></i>
                        <span>ÿ•ÿØÿßÿ±ÿ© ÿßŸÑÿπŸáÿØÿ©</span>
                    </a>
                </li>
                <li class="menu-item">
                    <a href="#" class="menu-link" data-target="faults">
                        <i class="fas fa-exclamation-triangle"></i>
                        <span>ÿ≥ÿ¨ŸÑ ÿßŸÑÿ£ÿπÿ∑ÿßŸÑ</span>
                    </a>
                </li>
                <li class="menu-item">
                    <a href="#" class="menu-link" data-target="stations">
                        <i class="fas fa-building"></i>
                        <span>ÿ•ÿØÿßÿ±ÿ© ÿßŸÑŸÖÿ≠ÿ∑ÿßÿ™</span>
                    </a>
                </li>
                <li class="menu-item">
                    <a href="#" class="menu-link" data-target="supervisors">
                        <i class="fas fa-user-tie"></i>
                        <span>ÿ•ÿØÿßÿ±ÿ© ÿßŸÑŸÖÿ≥ÿ§ŸàŸÑŸäŸÜ</span>
                    </a>
                </li>
                <li class="menu-item">
                    <a href="#" class="menu-link" data-target="settings">
                        <i class="fas fa-cog"></i>
                        <span>ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™</span>
                    </a>
                </li>
                <li class="menu-item">
                    <a href="#" class="menu-link" data-target="backup">
                        <i class="fas fa-database"></i>
                        <span>ÿßŸÑŸÜÿ≥ÿÆ ÿßŸÑÿßÿ≠ÿ™Ÿäÿßÿ∑Ÿä</span>
                    </a>
                </li>
                <li class="menu-item">
                    <a href="#" class="menu-link" id="logoutBtn">
                        <i class="fas fa-sign-out-alt"></i>
                        <span>ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿÆÿ±Ÿàÿ¨</span>
                    </a>
                </li>
            </ul>
        </div>

        <div class="overlay" id="overlay"></div>

        <main class="main-content">
            <!-- ŸÑŸàÿ≠ÿ© ÿßŸÑÿ™ÿ≠ŸÉŸÖ -->
            <div id="dashboard" class="tab-content active">
                <div class="stats-container">
                    <div class="stat-card">
                        <div class="stat-title">ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑŸÖŸàÿ∏ŸÅŸäŸÜ</div>
                        <div class="stat-value" id="totalEmployees">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-title">ÿßŸÑÿ≠ÿ∂Ÿàÿ± ÿßŸÑŸäŸàŸÖ</div>
                        <div class="stat-value" id="todayAttendance">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-title">ÿπÿØÿØ ÿßŸÑŸÖÿ≠ÿ∑ÿßÿ™</div>
                        <div class="stat-value" id="totalStations">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-title">ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑÿÆÿµŸàŸÖÿßÿ™</div>
                        <div class="stat-value" id="totalDeductions">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-title">ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑŸÖŸÉÿßŸÅÿ¢ÿ™</div>
                        <div class="stat-value" id="monthlyRewards">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-title">ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑÿ≥ŸÑŸÅ</div>
                        <div class="stat-value" id="totalLoans">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-title">ÿßŸÑÿ£ÿπÿ∑ÿßŸÑ ÿßŸÑŸÜÿ¥ÿ∑ÿ©</div>
                        <div class="stat-value" id="activeFaults">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-title">ŸÖŸàÿ∏ŸÅŸäŸÜ ŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™</div>
                        <div class="stat-value" id="totalDbEmployees">0</div>
                    </div>
                </div>

                <!-- ÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™ ÿßŸÑÿπŸáÿØÿ© ŸÅŸä ŸÑŸàÿ≠ÿ© ÿßŸÑÿ™ÿ≠ŸÉŸÖ -->
                <div class="card">
                    <div class="card-header">
                        <i class="fas fa-wallet"></i> ÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™ ÿßŸÑÿπŸáÿØÿ©
                    </div>
                    <div class="card-body">
                        <div class="cash-stats-container">
                            <div class="cash-stat-box" id="cashBalanceBox">
                                <div class="cash-stat-icon"><i class="fas fa-coins"></i></div>
                                <div class="cash-stat-number" id="dashboardCashBalance">0 ÿ¨.ŸÖ</div>
                                <div class="cash-stat-label">ÿßŸÑÿ±ÿµŸäÿØ ÿßŸÑÿ≠ÿßŸÑŸä</div>
                            </div>
                            <div class="cash-stat-box">
                                <div class="cash-stat-icon"><i class="fas fa-plus-circle"></i></div>
                                <div class="cash-stat-number" id="dashboardTotalDeposits">0 ÿ¨.ŸÖ</div>
                                <div class="cash-stat-label">ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑÿ•ŸäÿØÿßÿπÿßÿ™</div>
                            </div>
                            <div class="cash-stat-box">
                                <div class="cash-stat-icon"><i class="fas fa-minus-circle"></i></div>
                                <div class="cash-stat-number" id="dashboardTotalWithdrawals">0 ÿ¨.ŸÖ</div>
                                <div class="cash-stat-label">ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑŸÖÿµÿ±ŸàŸÅÿßÿ™</div>
                            </div>
                        </div>
                        
                        <div class="cash-dashboard-stats">
                            <div class="cash-dashboard-item">
                                <div class="cash-dashboard-label">ÿ•ŸäÿØÿßÿπÿßÿ™ ÿßŸÑŸäŸàŸÖ</div>
                                <div class="cash-dashboard-value" id="dashboardTodayDeposits">0 ÿ¨.ŸÖ</div>
                            </div>
                            <div class="cash-dashboard-item">
                                <div class="cash-dashboard-label">ŸÖÿµÿ±ŸàŸÅÿßÿ™ ÿßŸÑŸäŸàŸÖ</div>
                                <div class="cash-dashboard-value negative" id="dashboardTodayWithdrawals">0 ÿ¨.ŸÖ</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="quick-actions">
                    <div class="quick-action" data-target="employee-database">
                        <i class="fas fa-address-book"></i>
                        <span>ŸÇÿßÿπÿØÿ© ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸÖŸàÿ∏ŸÅŸäŸÜ</span>
                    </div>
                    <div class="quick-action" data-target="leaves">
                        <i class="fas fa-umbrella-beach"></i>
                        <span>ÿ•ÿØÿßÿ±ÿ© ÿßŸÑÿ•ÿ¨ÿßÿ≤ÿßÿ™</span>
                    </div>
                    <div class="quick-action" data-target="employee-records">
                        <i class="fas fa-user-circle"></i>
                        <span>ÿ≥ÿ¨ŸÑ ÿßŸÑŸÖŸàÿ∏ŸÅŸäŸÜ</span>
                    </div>
                    <div class="quick-action" data-target="reports">
                        <i class="fas fa-chart-bar"></i>
                        <span>ÿßŸÑÿ™ŸÇÿßÿ±Ÿäÿ±</span>
                    </div>
                    <div class="quick-action" data-target="supervisors">
                        <i class="fas fa-user-tie"></i>
                        <span>ÿ•ÿØÿßÿ±ÿ© ÿßŸÑŸÖÿ≥ÿ§ŸàŸÑŸäŸÜ</span>
                    </div>
                    <div class="quick-action" data-target="settings">
                        <i class="fas fa-cog"></i>
                        <span>ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™</span>
                    </div>
                    <div class="quick-action" data-target="backup">
                        <i class="fas fa-database"></i>
                        <span>ÿßŸÑŸÜÿ≥ÿÆ ÿßŸÑÿßÿ≠ÿ™Ÿäÿßÿ∑Ÿä</span>
                    </div>
                    <div class="quick-action" data-target="cash">
                        <i class="fas fa-wallet"></i>
                        <span>ÿßŸÑÿπŸáÿØÿ©</span>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        ÿßŸÑÿ≠ÿ∂Ÿàÿ± ÿßŸÑŸäŸàŸÖŸä ÿ≠ÿ≥ÿ® ÿßŸÑŸÖÿ≠ÿ∑ÿ©
                        <span class="see-all" data-target="attendance">ÿπÿ±ÿ∂ ÿßŸÑŸÉŸÑ</span>
                    </div>
                    <div class="card-body">
                        <div class="filter-section">
                            <h4>ÿßÿÆÿ™ÿ± ÿßŸÑŸÖÿ≠ÿ∑ÿ© ŸÑÿπÿ±ÿ∂ ÿßŸÑÿ≠ÿ∂Ÿàÿ±</h4>
                            <div class="form-group">
                                <select id="dashboardStationFilter">
                                    <option value="">ÿ¨ŸÖŸäÿπ ÿßŸÑŸÖÿ≠ÿ∑ÿßÿ™</option>
                                </select>
                            </div>
                        </div>
                        <div id="todayAttendanceList" class="empty-state">
                            ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ≥ÿ¨ŸÑÿßÿ™ ÿ≠ÿ∂Ÿàÿ± ŸÑŸáÿ∞ÿß ÿßŸÑŸäŸàŸÖ
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        ÿ¢ÿÆÿ± ÿ≠ÿ±ŸÉÿßÿ™ ÿßŸÑÿπŸáÿØÿ©
                        <span class="see-all" data-target="cash">ÿπÿ±ÿ∂ ÿßŸÑŸÉŸÑ</span>
                    </div>
                    <div class="card-body" id="recentCashTransactions">
                        <!-- ÿ≥Ÿäÿ™ŸÖ ÿ™ÿπÿ®ÿ¶ÿ™Ÿáÿß ÿØŸäŸÜÿßŸÖŸäŸÉŸäÿßŸã -->
                    </div>
                </div>
            </div>

            <!-- ÿ•ÿØÿßÿ±ÿ© ÿßŸÑŸÖŸàÿ∏ŸÅŸäŸÜ -->
            <div id="employees" class="tab-content">
                <div class="card">
                    <div class="card-header" id="employeeFormHeader">
                        ÿ•ÿ∂ÿßŸÅÿ© ŸÖŸàÿ∏ŸÅ ÿ¨ÿØŸäÿØ
                        <button class="btn-secondary" id="showAddForm" style="padding: 8px 12px; width: auto;">ÿ•ÿ∏Ÿáÿßÿ± ÿßŸÑŸÜŸÖŸàÿ∞ÿ¨</button>
                    </div>
                    <div class="card-body">
                        <form id="employeeForm" class="hidden">
                            <div class="form-group">
                                <label for="empName">ÿßÿ≥ŸÖ ÿßŸÑŸÖŸàÿ∏ŸÅ</label>
                                <input type="text" id="empName" required placeholder="ÿ£ÿØÿÆŸÑ ÿßÿ≥ŸÖ ÿßŸÑŸÖŸàÿ∏ŸÅ">
                                <div class="validation-error" id="empNameError">ÿßÿ≥ŸÖ ÿßŸÑŸÖŸàÿ∏ŸÅ ŸÖŸàÿ¨ŸàÿØ ŸÖÿ≥ÿ®ŸÇÿßŸã</div>
                            </div>
                            <div class="form-group">
                                <label for="empPhone">ÿ±ŸÇŸÖ ÿßŸÑŸáÿßÿ™ŸÅ</label>
                                <input type="text" id="empPhone" required placeholder="ÿ£ÿØÿÆŸÑ ÿ±ŸÇŸÖ ÿßŸÑŸáÿßÿ™ŸÅ">
                                <div class="validation-error" id="empPhoneError">ÿ±ŸÇŸÖ ÿßŸÑŸáÿßÿ™ŸÅ ŸÖŸàÿ¨ŸàÿØ ŸÖÿ≥ÿ®ŸÇÿßŸã</div>
                            </div>
                            <div class="form-group">
                                <label for="empJob">ÿßŸÑŸàÿ∏ŸäŸÅÿ©</label>
                                <input type="text" id="empJob" required placeholder="ÿ£ÿØÿÆŸÑ ÿßŸÑŸàÿ∏ŸäŸÅÿ©">
                            </div>
                            <div class="form-group">
                                <label for="empSalary">ÿßŸÑÿ±ÿßÿ™ÿ® ÿßŸÑÿ£ÿ≥ÿßÿ≥Ÿä (ÿ¨ŸÜŸäŸá ŸÖÿµÿ±Ÿä)</label>
                                <input type="number" id="empSalary" required placeholder="ÿ£ÿØÿÆŸÑ ÿßŸÑÿ±ÿßÿ™ÿ®">
                            </div>
                            <div class="form-group">
                                <label for="empWorkDays">ÿ£ŸäÿßŸÖ ÿßŸÑÿπŸÖŸÑ ÿßŸÑŸÖÿ™ŸÅŸÇ ÿπŸÑŸäŸáÿß (ŸäŸàŸÖ)</label>
                                <input type="number" id="empWorkDays" value="24" required>
                            </div>
                            <div class="form-group">
                                <label for="empActive">ÿ≠ÿßŸÑÿ© ÿßŸÑŸÖŸàÿ∏ŸÅ</label>
                                <select id="empActive" required>
                                    <option value="true">ŸÅÿπÿßŸÑ</option>
                                    <option value="false">ÿ∫Ÿäÿ± ŸÅÿπÿßŸÑ</option>
                                </select>
                            </div>
                            <button type="submit" class="btn-success">
                                <span id="employeeSubmitText">ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑŸÖŸàÿ∏ŸÅ</span>
                            </button>
                        </form>
                        <div id="employeeFormMessage" class="empty-state">
                            Ÿäÿ¨ÿ® ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑŸÖŸàÿ∏ŸÅ ÿ£ŸàŸÑÿßŸã ŸÅŸä ŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ŸÇÿ®ŸÑ ÿ•ÿ∂ÿßŸÅÿ™Ÿá ÿ•ŸÑŸâ ÿßŸÑŸÖŸàÿ∏ŸÅŸäŸÜ ÿßŸÑŸÜÿ¥ÿ∑ŸäŸÜ
                        </div>
                        
                        <div class="import-section">
                            <h3>ÿßÿ≥ÿ™Ÿäÿ±ÿßÿØ ŸÖŸàÿ∏ŸÅŸäŸÜ ŸÖŸÜ ŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™</h3>
                            <p>ŸäŸÖŸÉŸÜŸÉ ÿßÿ≥ÿ™Ÿäÿ±ÿßÿØ ŸÖŸàÿ∏ŸÅŸäŸÜ ŸÖŸÜ ŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ Ÿàÿ•ÿ∂ÿßŸÅÿ™ŸáŸÖ ŸÉŸÖŸàÿ∏ŸÅŸäŸÜ ŸÜÿ¥ÿ∑ŸäŸÜ.</p>
                            
                            <div class="form-group">
                                <label for="selectMultipleEmployees">ÿßÿÆÿ™ÿ± ÿßŸÑŸÖŸàÿ∏ŸÅŸäŸÜ ŸÑŸÑÿ•ÿ∂ÿßŸÅÿ©</label>
                                <select id="selectMultipleEmployees" multiple style="height: 150px;"></select>
                            </div>
                            
                            <div class="form-group">
                                <label for="defaultJob">ÿßŸÑŸàÿ∏ŸäŸÅÿ© ÿßŸÑÿßŸÅÿ™ÿ±ÿßÿ∂Ÿäÿ©</label>
                                <input type="text" id="defaultJob" placeholder="ÿ£ÿØÿÆŸÑ ÿßŸÑŸàÿ∏ŸäŸÅÿ© ÿßŸÑÿßŸÅÿ™ÿ±ÿßÿ∂Ÿäÿ© ŸÑŸÑŸÖŸàÿ∏ŸÅŸäŸÜ">
                            </div>
                            
                            <div class="form-group">
                                <label for="defaultSalary">ÿßŸÑÿ±ÿßÿ™ÿ® ÿßŸÑÿ£ÿ≥ÿßÿ≥Ÿä ÿßŸÑÿßŸÅÿ™ÿ±ÿßÿ∂Ÿä (ÿ¨ŸÜŸäŸá ŸÖÿµÿ±Ÿä)</label>
                                <input type="number" id="defaultSalary" placeholder="ÿ£ÿØÿÆŸÑ ÿßŸÑÿ±ÿßÿ™ÿ® ÿßŸÑÿßŸÅÿ™ÿ±ÿßÿ∂Ÿä">
                            </div>
                            
                            <div class="form-group">
                                <label for="defaultWorkDays">ÿ£ŸäÿßŸÖ ÿßŸÑÿπŸÖŸÑ ÿßŸÑŸÖÿ™ŸÅŸÇ ÿπŸÑŸäŸáÿß ÿßŸÑÿßŸÅÿ™ÿ±ÿßÿ∂Ÿäÿ© (ŸäŸàŸÖ)</label>
                                <input type="number" id="defaultWorkDays" value="24">
                            </div>
                            
                            <button class="btn-success" id="importFromDatabaseBtn">
                                <i class="fas fa-user-plus"></i> ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑŸÖŸàÿ∏ŸÅŸäŸÜ ÿßŸÑŸÖÿ≠ÿØÿØŸäŸÜ
                            </button>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑŸÖŸàÿ∏ŸÅŸäŸÜ
                        <button class="btn-secondary" id="exportEmployees" style="padding: 8px 12px; width: auto;">ÿ™ÿµÿØŸäÿ± Excel</button>
                    </div>
                    <div class="card-body">
                        <div id="employeesList" class="empty-state">
                            ŸÑÿß ŸäŸàÿ¨ÿØ ŸÖŸàÿ∏ŸÅŸäŸÜ ŸÖÿ≥ÿ¨ŸÑŸäŸÜ
                        </div>
                    </div>
                </div>
            </div>

            <!-- ŸÇÿßÿπÿØÿ© ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸÖŸàÿ∏ŸÅŸäŸÜ -->
            <div id="employee-database" class="tab-content">
                <div class="card add-employee-db">
                    <div class="card-header">ÿ•ÿ∂ÿßŸÅÿ© ŸÖŸàÿ∏ŸÅ ÿ¨ÿØŸäÿØ ÿ•ŸÑŸâ ŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™</div>
                    <div class="card-body">
                        <form id="employeeDatabaseForm">
                            <div class="form-group">
                                <label for="dbEmpName">ÿßÿ≥ŸÖ ÿßŸÑŸÖŸàÿ∏ŸÅ</label>
                                <input type="text" id="dbEmpName" required placeholder="ÿ£ÿØÿÆŸÑ ÿßÿ≥ŸÖ ÿßŸÑŸÖŸàÿ∏ŸÅ">
                                <div class="validation-error" id="dbEmpNameError">ÿßÿ≥ŸÖ ÿßŸÑŸÖŸàÿ∏ŸÅ ŸÖŸàÿ¨ŸàÿØ ŸÖÿ≥ÿ®ŸÇÿßŸã</div>
                            </div>
                            <div class="form-group">
                                <label for="dbEmpPhone">ÿ±ŸÇŸÖ ÿßŸÑŸáÿßÿ™ŸÅ</label>
                                <input type="text" id="dbEmpPhone" required placeholder="ÿ£ÿØÿÆŸÑ ÿ±ŸÇŸÖ ÿßŸÑŸáÿßÿ™ŸÅ">
                                <div class="validation-error" id="dbEmpPhoneError">ÿ±ŸÇŸÖ ÿßŸÑŸáÿßÿ™ŸÅ ŸÖŸàÿ¨ŸàÿØ ŸÖÿ≥ÿ®ŸÇÿßŸã</div>
                            </div>
                            <div class="form-group">
                                <label for="dbEmpWhatsapp">ÿ±ŸÇŸÖ ÿßŸÑŸàÿßÿ™ÿ≥ÿßÿ®</label>
                                <input type="text" id="dbEmpWhatsapp" placeholder="ÿ£ÿØÿÆŸÑ ÿ±ŸÇŸÖ ÿßŸÑŸàÿßÿ™ÿ≥ÿßÿ® (ÿßÿÆÿ™Ÿäÿßÿ±Ÿä)">
                            </div>
                            <div class="form-group">
                                <label for="dbEmpAddress">ÿßŸÑÿπŸÜŸàÿßŸÜ</label>
                                <textarea id="dbEmpAddress" rows="2" placeholder="ÿ£ÿØÿÆŸÑ ÿπŸÜŸàÿßŸÜ ÿßŸÑŸÖŸàÿ∏ŸÅ (ÿßÿÆÿ™Ÿäÿßÿ±Ÿä)"></textarea>
                            </div>
                            <button type="submit" class="btn-success">
                                <span id="employeeDbSubmitText">ÿ•ÿ∂ÿßŸÅÿ© ÿ•ŸÑŸâ ŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™</span>
                            </button>
                        </form>

                        <div class="contacts-import-section">
                            <h3>ÿßÿ≥ÿ™Ÿäÿ±ÿßÿØ ÿ¨Ÿáÿßÿ™ ÿßŸÑÿßÿ™ÿµÿßŸÑ ŸÖŸÜ ÿßŸÑŸáÿßÿ™ŸÅ</h3>
                            <p>ŸäŸÖŸÉŸÜŸÉ ÿßÿ≥ÿ™Ÿäÿ±ÿßÿØ ÿ¨Ÿáÿßÿ™ ÿßŸÑÿßÿ™ÿµÿßŸÑ ŸÖŸÜ Ÿáÿßÿ™ŸÅŸÉ ŸÖÿ®ÿßÿ¥ÿ±ÿ© ŸÑÿ™ŸàŸÅŸäÿ± ÿßŸÑŸàŸÇÿ™ ŸàÿßŸÑÿ¨ŸáÿØ.</p>
                            
                            <div class="contacts-import-actions">
                                <button class="btn-success" id="importContactsBtn">
                                    <i class="fas fa-address-book"></i> ÿßÿ≥ÿ™Ÿäÿ±ÿßÿØ ÿ¨Ÿáÿßÿ™ ÿßŸÑÿßÿ™ÿµÿßŸÑ
                                </button>
                            </div>
                            
                            <div id="contactsPreview" class="contacts-preview" style="display: none;">
                                <div class="contacts-selection">
                                    <h4>ÿßÿÆÿ™ÿ± ÿ¨Ÿáÿßÿ™ ÿßŸÑÿßÿ™ÿµÿßŸÑ ŸÑŸÑÿ•ÿ∂ÿßŸÅÿ©</h4>
                                    <div class="contacts-selection-actions">
                                        <button class="btn-secondary" id="selectAllContacts">ÿ™ÿ≠ÿØŸäÿØ ÿßŸÑŸÉŸÑ</button>
                                        <button class="btn-secondary" id="deselectAllContacts">ÿ•ŸÑÿ∫ÿßÿ° ÿßŸÑÿ™ÿ≠ÿØŸäÿØ</button>
                                    </div>
                                </div>
                                <table id="contactsPreviewTable">
                                    <thead>
                                        <tr>
                                            <th>ÿ™ÿ≠ÿØŸäÿØ</th>
                                            <th>ÿßŸÑÿßÿ≥ŸÖ</th>
                                            <th>ÿ±ŸÇŸÖ ÿßŸÑŸáÿßÿ™ŸÅ</th>
                                            <th>ÿßŸÑÿ≠ÿßŸÑÿ©</th>
                                        </tr>
                                    </thead>
                                    <tbody></tbody>
                                </table>
                                
                                <div class="contacts-import-actions" style="margin-top: 15px;">
                                    <button class="btn-success" id="addSelectedContactsBtn">
                                        <i class="fas fa-user-plus"></i> ÿ•ÿ∂ÿßŸÅÿ© ÿ¨Ÿáÿßÿ™ ÿßŸÑÿßÿ™ÿµÿßŸÑ ÿßŸÑŸÖÿ≠ÿØÿØÿ©
                                    </button>
                                </div>
                            </div>
                        </div>

                        <div class="import-section">
                            <h3>ÿßÿ≥ÿ™Ÿäÿ±ÿßÿØ ŸÖŸàÿ∏ŸÅŸäŸÜ ŸÖŸÜ ŸÖŸÑŸÅ Excel ÿ£Ÿà CSV</h3>
                            <p>ŸäŸÖŸÉŸÜŸÉ ÿßÿ≥ÿ™Ÿäÿ±ÿßÿØ ŸÇÿßÿ¶ŸÖÿ© ÿ®ÿßŸÑŸÖŸàÿ∏ŸÅŸäŸÜ ŸÖŸÜ ŸÖŸÑŸÅ Excel ÿ£Ÿà CSV ŸÑÿ™ŸàŸÅŸäÿ± ÿßŸÑŸàŸÇÿ™.</p>
                            
                            <div class="import-template">
                                <strong>ŸÜŸÖŸàÿ∞ÿ¨ ŸÖŸÑŸÅ Excel/CSV ÿßŸÑŸÖÿ∑ŸÑŸàÿ®:</strong>
                                <ul>
                                    <li>Ÿäÿ¨ÿ® ÿ£ŸÜ Ÿäÿ≠ÿ™ŸàŸä ÿßŸÑŸÖŸÑŸÅ ÿπŸÑŸâ ÿßŸÑÿ£ÿπŸÖÿØÿ© ÿßŸÑÿ™ÿßŸÑŸäÿ© ÿ®ÿßŸÑÿ™ÿ±ÿ™Ÿäÿ®:</li>
                                    <li>ÿßŸÑÿπŸÖŸàÿØ ÿßŸÑÿ£ŸàŸÑ: ÿßÿ≥ŸÖ ÿßŸÑŸÖŸàÿ∏ŸÅ (ŸÖÿ∑ŸÑŸàÿ®)</li>
                                    <li>ÿßŸÑÿπŸÖŸàÿØ ÿßŸÑÿ´ÿßŸÜŸä: ÿ±ŸÇŸÖ ÿßŸÑŸáÿßÿ™ŸÅ (ŸÖÿ∑ŸÑŸàÿ®)</li>
                                    <li>ÿßŸÑÿπŸÖŸàÿØ ÿßŸÑÿ´ÿßŸÑÿ´: ÿ±ŸÇŸÖ ÿßŸÑŸàÿßÿ™ÿ≥ÿßÿ® (ÿßÿÆÿ™Ÿäÿßÿ±Ÿä)</li>
                                    <li>ÿßŸÑÿπŸÖŸàÿØ ÿßŸÑÿ±ÿßÿ®ÿπ: ÿßŸÑÿπŸÜŸàÿßŸÜ (ÿßÿÆÿ™Ÿäÿßÿ±Ÿä)</li>
                                </ul>
                                <button class="btn-secondary" id="downloadTemplateBtn" style="padding: 8px 12px; width: auto;">
                                    <i class="fas fa-download"></i> ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÜŸÖŸàÿ∞ÿ¨
                                </button>
                            </div>
                            
                            <div class="form-group">
                                <label for="importFile">ÿßÿÆÿ™ÿ± ŸÖŸÑŸÅ Excel ÿ£Ÿà CSV</label>
                                <input type="file" id="importFile" accept=".xlsx, .xls, .csv">
                            </div>
                            
                            <div class="import-actions">
                                <button class="btn-warning" id="previewImportBtn">
                                    <i class="fas fa-eye"></i> ŸÖÿπÿßŸäŸÜÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™
                                </button>
                                <button class="btn-success" id="importEmployeesBtn">
                                    <i class="fas fa-upload"></i> ÿßÿ≥ÿ™Ÿäÿ±ÿßÿØ ÿßŸÑŸÖŸàÿ∏ŸÅŸäŸÜ
                                </button>
                            </div>
                            
                            <div id="importPreview" class="import-preview" style="display: none;">
                                <h4>ŸÖÿπÿßŸäŸÜÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸÖÿ≥ÿ™Ÿàÿ±ÿØÿ©</h4>
                                <table id="previewTable">
                                    <thead>
                                        <tr>
                                            <th>ÿßÿ≥ŸÖ ÿßŸÑŸÖŸàÿ∏ŸÅ</th>
                                            <th>ÿ±ŸÇŸÖ ÿßŸÑŸáÿßÿ™ŸÅ</th>
                                            <th>ÿ±ŸÇŸÖ ÿßŸÑŸàÿßÿ™ÿ≥ÿßÿ®</th>
                                            <th>ÿßŸÑÿπŸÜŸàÿßŸÜ</th>
                                        </tr>
                                    </thead>
                                    <tbody></tbody>
                                </table>
                            </div>
                            
                            <div id="importStatus" class="import-status" style="display: none;"></div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        ŸÇÿßÿπÿØÿ© ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸÖŸàÿ∏ŸÅŸäŸÜ
                        <button class="btn-secondary" id="exportEmployeeDatabase" style="padding: 8px 12px; width: auto;">ÿ™ÿµÿØŸäÿ± Excel</button>
                    </div>
                    <div class="card-body">
                        <div class="form-group">
                            <input type="text" id="searchEmployee" placeholder="ÿßÿ®ÿ≠ÿ´ ÿπŸÜ ŸÖŸàÿ∏ŸÅ ÿ®ÿßŸÑÿßÿ≥ŸÖ ÿ£Ÿà ÿ±ŸÇŸÖ ÿßŸÑŸáÿßÿ™ŸÅ...">
                        </div>
                        <div id="employeeDatabaseList" class="empty-state">
                            ŸÑÿß ŸäŸàÿ¨ÿØ ŸÖŸàÿ∏ŸÅŸäŸÜ ŸÖÿ≥ÿ¨ŸÑŸäŸÜ
                        </div>
                    </div>
                </div>
            </div>

            <!-- ÿßŸÑÿ≠ÿ∂Ÿàÿ± ŸàÿßŸÑÿ∫Ÿäÿßÿ® -->
            <div id="attendance" class="tab-content">
                <div class="card">
                    <div class="card-header">ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿ≠ÿ∂Ÿàÿ± ŸàÿßŸÑÿ∫Ÿäÿßÿ®</div>
                    <div class="card-body">
                        <div class="form-group">
                            <button class="btn-success" id="autoAttendanceBtn">
                                <span id="autoAttendanceText">ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿ≠ÿ∂Ÿàÿ± ÿßŸÑÿ™ŸÑŸÇÿßÿ¶Ÿä</span>
                            </button>
                        </div>
                        <form id="manualAttendanceForm">
                            <div class="form-group">
                                <label for="attendanceEmployee">ÿßÿÆÿ™ÿ± ÿßŸÑŸÖŸàÿ∏ŸÅ</label>
                                <select id="attendanceEmployee" required>
                                    <option value="">ÿßÿÆÿ™ÿ± ÿßŸÑŸÖŸàÿ∏ŸÅ</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="attendanceStation">ÿßÿÆÿ™ÿ± ÿßŸÑŸÖÿ≠ÿ∑ÿ©</label>
                                <select id="attendanceStation" required>
                                    <option value="">ÿßÿÆÿ™ÿ± ÿßŸÑŸÖÿ≠ÿ∑ÿ©</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="attendanceSupervisor">ÿßŸÑŸÖÿ≥ÿ§ŸàŸÑ ÿπŸÜ ÿßŸÑÿ™ÿ≥ÿ¨ŸäŸÑ</label>
                                <select id="attendanceSupervisor" required>
                                    <option value="">ÿßÿÆÿ™ÿ± ÿßŸÑŸÖÿ≥ÿ§ŸàŸÑ</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="attendanceDate">ÿßŸÑÿ™ÿßÿ±ŸäÿÆ</label>
                                <input type="date" id="attendanceDate" required>
                            </div>
                            <div class="form-group">
                                <label for="attendanceStatus">ÿßŸÑÿ≠ÿßŸÑÿ©</label>
                                <select id="attendanceStatus" required>
                                    <option value="ÿ≠ÿßÿ∂ÿ±">ÿ≠ÿßÿ∂ÿ± (ŸÖŸàÿ¨ŸàÿØ ŸÅŸä ÿßŸÑŸÖÿ≠ÿ∑ÿ©)</option>
                                    <option value="ÿ∫ÿßÿ¶ÿ®">ÿ∫ÿßÿ¶ÿ® (ÿ∫Ÿäÿ± ŸÖŸàÿ¨ŸàÿØ ŸÅŸä ÿßŸÑŸÖÿ≠ÿ∑ÿ©)</option>
                                    <option value="ÿ•ÿ¨ÿßÿ≤ÿ©">ÿ•ÿ¨ÿßÿ≤ÿ©</option>
                                </select>
                            </div>
                            <button type="submit" class="btn-success">
                                <span id="attendanceSubmitText">ÿ™ÿ≥ÿ¨ŸäŸÑ</span>
                            </button>
                        </form>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        ÿ≥ÿ¨ŸÑ ÿßŸÑÿ≠ÿ∂Ÿàÿ± ŸàÿßŸÑÿ∫Ÿäÿßÿ®
                        <button class="btn-secondary" id="exportAttendance" style="padding: 8px 12px; width: auto;">ÿ™ÿµÿØŸäÿ± Excel</button>
                    </div>
                    <div class="card-body">
                        <div class="filter-section">
                            <h4>ŸÅŸÑÿ™ÿ±ÿ© ÿßŸÑÿ≥ÿ¨ŸÑ</h4>
                            <div class="filter-row">
                                <div class="form-group">
                                    <label for="filterAttendanceMonth">ÿßÿÆÿ™ÿ± ÿßŸÑÿ¥Ÿáÿ±</label>
                                    <input type="month" id="filterAttendanceMonth">
                                </div>
                                <div class="form-group">
                                    <label for="filterAttendanceStation">ÿßÿÆÿ™ÿ± ÿßŸÑŸÖÿ≠ÿ∑ÿ©</label>
                                    <select id="filterAttendanceStation">
                                        <option value="">ÿ¨ŸÖŸäÿπ ÿßŸÑŸÖÿ≠ÿ∑ÿßÿ™</option>
                                    </select>
                                </div>
                                <div class="filter-actions">
                                    <button class="btn-success" id="applyAttendanceFilter">
                                        <i class="fas fa-filter"></i> ÿ™ÿ∑ÿ®ŸäŸÇ
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div id="attendanceList" class="empty-state">
                            ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ≥ÿ¨ŸÑÿßÿ™ ÿ≠ÿ∂Ÿàÿ±
                        </div>
                    </div>
                </div>
            </div>

            <!-- ÿ•ÿØÿßÿ±ÿ© ÿßŸÑÿ•ÿ¨ÿßÿ≤ÿßÿ™ -->
            <div id="leaves" class="tab-content">
                <div class="card">
                    <div class="card-header">ÿ™ÿ≥ÿ¨ŸäŸÑ ÿ•ÿ¨ÿßÿ≤ÿ©</div>
                    <div class="card-body">
                        <form id="leaveForm">
                            <div class="form-group">
                                <label for="leaveEmployee">ÿßÿÆÿ™ÿ± ÿßŸÑŸÖŸàÿ∏ŸÅ</label>
                                <select id="leaveEmployee" required>
                                    <option value="">ÿßÿÆÿ™ÿ± ÿßŸÑŸÖŸàÿ∏ŸÅ</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="leaveStation">ÿßÿÆÿ™ÿ± ÿßŸÑŸÖÿ≠ÿ∑ÿ©</label>
                                <select id="leaveStation" required>
                                    <option value="">ÿßÿÆÿ™ÿ± ÿßŸÑŸÖÿ≠ÿ∑ÿ©</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="leaveSupervisor">ÿßŸÑŸÖÿ≥ÿ§ŸàŸÑ ÿπŸÜ ÿßŸÑÿ™ÿ≥ÿ¨ŸäŸÑ</label>
                                <select id="leaveSupervisor" required>
                                    <option value="">ÿßÿÆÿ™ÿ± ÿßŸÑŸÖÿ≥ÿ§ŸàŸÑ</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="leaveType">ŸÜŸàÿπ ÿßŸÑÿ•ÿ¨ÿßÿ≤ÿ©</label>
                                <select id="leaveType" required>
                                    <option value="ÿ≥ŸÜŸàŸäÿ©">ÿ≥ŸÜŸàŸäÿ©</option>
                                    <option value="ŸÖÿ±ÿ∂Ÿäÿ©">ŸÖÿ±ÿ∂Ÿäÿ©</option>
                                    <option value="ÿ∑ÿßÿ±ÿ¶ÿ©">ÿ∑ÿßÿ±ÿ¶ÿ©</option>
                                    <option value="ÿ£ÿÆÿ±Ÿâ">ÿ£ÿÆÿ±Ÿâ</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="leaveStart">ÿ™ÿßÿ±ŸäÿÆ ÿßŸÑÿ®ÿØÿ°</label>
                                <input type="date" id="leaveStart" required>
                            </div>
                            <div class="form-group">
                                <label for="leaveEnd">ÿ™ÿßÿ±ŸäÿÆ ÿßŸÑÿßŸÜÿ™Ÿáÿßÿ°</label>
                                <input type="date" id="leaveEnd" required>
                            </div>
                            <div class="form-group">
                                <label for="leaveNotes">ŸÖŸÑÿßÿ≠ÿ∏ÿßÿ™</label>
                                <textarea id="leaveNotes" rows="3" placeholder="ÿ£ÿØÿÆŸÑ ŸÖŸÑÿßÿ≠ÿ∏ÿßÿ™ ÿ≠ŸàŸÑ ÿßŸÑÿ•ÿ¨ÿßÿ≤ÿ©"></textarea>
                            </div>
                            <button type="submit" class="btn-success">
                                <span id="leaveSubmitText">ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿ•ÿ¨ÿßÿ≤ÿ©</span>
                            </button>
                        </form>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        ÿ≥ÿ¨ŸÑ ÿßŸÑÿ•ÿ¨ÿßÿ≤ÿßÿ™
                        <button class="btn-secondary" id="exportLeaves" style="padding: 8px 12px; width: auto;">ÿ™ÿµÿØŸäÿ± Excel</button>
                    </div>
                    <div class="card-body">
                        <div class="filter-section">
                            <h4>ŸÅŸÑÿ™ÿ±ÿ© ÿßŸÑÿ≥ÿ¨ŸÑ</h4>
                            <div class="filter-row">
                                <div class="form-group">
                                    <label for="leaveFilterStartDate">ŸÖŸÜ ÿ™ÿßÿ±ŸäÿÆ</label>
                                    <input type="date" id="leaveFilterStartDate">
                                </div>
                                <div class="form-group">
                                    <label for="leaveFilterEndDate">ÿ•ŸÑŸâ ÿ™ÿßÿ±ŸäÿÆ</label>
                                    <input type="date" id="leaveFilterEndDate">
                                </div>
                                <div class="form-group">
                                    <label for="filterLeaveStation">ÿßŸÑŸÖÿ≠ÿ∑ÿ©</label>
                                    <select id="filterLeaveStation">
                                        <option value="">ÿ¨ŸÖŸäÿπ ÿßŸÑŸÖÿ≠ÿ∑ÿßÿ™</option>
                                    </select>
                                </div>
                            </div>
                            <div class="date-filter-actions">
                                <button class="btn-success" id="applyLeaveFilter">
                                    <i class="fas fa-filter"></i> ÿ™ÿ∑ÿ®ŸäŸÇ ÿßŸÑŸÅŸÑÿ™ÿ±
                                </button>
                                <button class="btn-secondary" id="resetLeaveFilter">
                                    <i class="fas fa-redo"></i> ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ
                                </button>
                            </div>
                        </div>
                        <div id="leavesList" class="empty-state">
                            ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ•ÿ¨ÿßÿ≤ÿßÿ™ ŸÖÿ≥ÿ¨ŸÑÿ©
                        </div>
                    </div>
                </div>
            </div>

            <!-- ÿ≥ÿ¨ŸÑ ÿßŸÑŸÖŸàÿ∏ŸÅŸäŸÜ -->
            <div id="employee-records" class="tab-content">
                <div class="card">
                    <div class="card-header">
                        <i class="fas fa-file-alt"></i> ÿ≥ÿ¨ŸÑ ÿßŸÑŸÖŸàÿ∏ŸÅŸäŸÜ ÿßŸÑÿ¥Ÿáÿ±Ÿä
                    </div>
                    <div class="card-body">
                        <div class="report-controls">
                            <div class="form-group">
                                <label for="selectEmployeeForReport">
                                    <i class="fas fa-user"></i> ÿßÿÆÿ™ÿ± ÿßŸÑŸÖŸàÿ∏ŸÅ
                                </label>
                                <select id="selectEmployeeForReport" required>
                                    <option value="">-- ÿßÿÆÿ™ÿ± ÿßŸÑŸÖŸàÿ∏ŸÅ --</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="selectMonthForReport">
                                    <i class="fas fa-calendar-alt"></i> ÿßÿÆÿ™ÿ± ÿßŸÑÿ¥Ÿáÿ±
                                </label>
                                <input type="month" id="selectMonthForReport" required>
                            </div>
                            
                            <button id="generateEmployeeReportBtn" class="btn-success generate-report-btn">
                                <i class="fas fa-chart-line"></i> ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑÿ™ŸÇÿ±Ÿäÿ±
                            </button>
                        </div>
                    </div>
                </div>
                
                <div id="employeeReportContainer" style="display: none;"></div>
            </div>

            <!-- ÿßŸÑÿ≥ŸÑŸÅ ŸàÿßŸÑŸÖŸÉÿßŸÅÿ¢ÿ™ -->
            <div id="financial" class="tab-content">
                <div class="card">
                    <div class="card-header">ÿßŸÑÿ≥ŸÑŸÅ ŸàÿßŸÑŸÖŸÉÿßŸÅÿ¢ÿ™ ŸàÿßŸÑÿÆÿµŸàŸÖÿßÿ™</div>
                    <div class="card-body">
                        <form id="financialForm">
                            <div class="form-group">
                                <label for="financialEmployee">ÿßÿÆÿ™ÿ± ÿßŸÑŸÖŸàÿ∏ŸÅ</label>
                                <select id="financialEmployee" required>
                                    <option value="">ÿßÿÆÿ™ÿ± ÿßŸÑŸÖŸàÿ∏ŸÅ</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="financialStation">ÿßÿÆÿ™ÿ± ÿßŸÑŸÖÿ≠ÿ∑ÿ©</label>
                                <select id="financialStation" required>
                                    <option value="">ÿßÿÆÿ™ÿ± ÿßŸÑŸÖÿ≠ÿ∑ÿ©</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="financialSupervisor">ÿßŸÑŸÖÿ≥ÿ§ŸàŸÑ ÿπŸÜ ÿßŸÑÿ™ÿ≥ÿ¨ŸäŸÑ</label>
                                <select id="financialSupervisor" required>
                                    <option value="">ÿßÿÆÿ™ÿ± ÿßŸÑŸÖÿ≥ÿ§ŸàŸÑ</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="financialType">ÿßŸÑŸÜŸàÿπ</label>
                                <select id="financialType" required>
                                    <option value="ÿ≥ŸÑŸÅÿ©">ÿ≥ŸÑŸÅÿ©</option>
                                    <option value="ŸÖŸÉÿßŸÅÿ£ÿ©">ŸÖŸÉÿßŸÅÿ£ÿ©</option>
                                    <option value="ÿÆÿµŸÖ">ÿÆÿµŸÖ</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="financialAmount">ÿßŸÑŸÖÿ®ŸÑÿ∫ (ÿ¨ŸÜŸäŸá ŸÖÿµÿ±Ÿä)</label>
                                <input type="number" id="financialAmount" required placeholder="ÿ£ÿØÿÆŸÑ ÿßŸÑŸÖÿ®ŸÑÿ∫">
                            </div>
                            <div class="form-group">
                                <label for="financialDate">ÿßŸÑÿ™ÿßÿ±ŸäÿÆ</label>
                                <input type="date" id="financialDate" required>
                            </div>
                            <div class="form-group">
                                <label for="financialNotes">ŸÖŸÑÿßÿ≠ÿ∏ÿßÿ™</label>
                                <textarea id="financialNotes" rows="3" placeholder="ÿ£ÿØÿÆŸÑ ŸÖŸÑÿßÿ≠ÿ∏ÿßÿ™ ÿ≠ŸàŸÑ ÿßŸÑÿ≠ÿ±ŸÉÿ© ÿßŸÑŸÖÿßŸÑŸäÿ©"></textarea>
                            </div>
                            <button type="submit" class="btn-success">
                                <span id="financialSubmitText">ÿ™ÿ≥ÿ¨ŸäŸÑ</span>
                            </button>
                        </form>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        ÿ≥ÿ¨ŸÑ ÿßŸÑÿ≥ŸÑŸÅ ŸàÿßŸÑŸÖŸÉÿßŸÅÿ¢ÿ™ ŸàÿßŸÑÿÆÿµŸàŸÖÿßÿ™
                        <button class="btn-secondary" id="exportFinancials" style="padding: 8px 12px; width: auto;">ÿ™ÿµÿØŸäÿ± Excel</button>
                    </div>
                    <div class="card-body">
                        <div class="filter-section">
                            <h4>ŸÅŸÑÿ™ÿ±ÿ© ÿßŸÑÿ≥ÿ¨ŸÑ</h4>
                            <div class="filter-row">
                                <div class="form-group">
                                    <label for="filterFinancialMonth">ÿßÿÆÿ™ÿ± ÿßŸÑÿ¥Ÿáÿ±</label>
                                    <input type="month" id="filterFinancialMonth">
                                </div>
                                <div class="form-group">
                                    <label for="filterFinancialEmployee">ÿßÿ≥ŸÖ ÿßŸÑŸÖŸàÿ∏ŸÅ</label>
                                    <select id="filterFinancialEmployee">
                                        <option value="">ÿ¨ŸÖŸäÿπ ÿßŸÑŸÖŸàÿ∏ŸÅŸäŸÜ</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="filterFinancialStation">ÿßÿÆÿ™ÿ± ÿßŸÑŸÖÿ≠ÿ∑ÿ©</label>
                                    <select id="filterFinancialStation">
                                        <option value="">ÿ¨ŸÖŸäÿπ ÿßŸÑŸÖÿ≠ÿ∑ÿßÿ™</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="filterFinancialType">ŸÜŸàÿπ ÿßŸÑÿ≠ÿ±ŸÉÿ©</label>
                                    <select id="filterFinancialType">
                                        <option value="">ÿ¨ŸÖŸäÿπ ÿßŸÑÿ≠ÿ±ŸÉÿßÿ™</option>
                                        <option value="ÿ≥ŸÑŸÅÿ©">ÿ≥ŸÑŸÅÿ©</option>
                                        <option value="ŸÖŸÉÿßŸÅÿ£ÿ©">ŸÖŸÉÿßŸÅÿ£ÿ©</option>
                                        <option value="ÿÆÿµŸÖ">ÿÆÿµŸÖ</option>
                                    </select>
                                </div>
                                <div class="filter-actions">
                                    <button class="btn-success" id="applyFinancialFilter">
                                        <i class="fas fa-filter"></i> ÿ™ÿ∑ÿ®ŸäŸÇ ÿßŸÑŸÅŸÑÿ™ÿ±
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div id="financialList" class="empty-state">
                            ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ≠ÿ±ŸÉÿßÿ™ ŸÖÿßŸÑŸäÿ© ŸÖÿ≥ÿ¨ŸÑÿ©
                        </div>
                    </div>
                </div>
            </div>

            <!-- ÿßŸÑÿ™ŸÇÿßÿ±Ÿäÿ± -->
            <div id="reports" class="tab-content">
                <div class="card">
                    <div class="card-header">
                        ÿ™ŸÇÿ±Ÿäÿ± ÿßŸÑŸÖÿ±ÿ™ÿ®ÿßÿ™
                        <button class="btn-secondary" id="exportReport" style="padding: 8px 12px; width: auto;">ÿ™ÿµÿØŸäÿ± Excel</button>
                    </div>
                    <div class="card-body">
                        <div class="form-group">
                            <label for="reportMonth">ÿßÿÆÿ™ÿ± ÿßŸÑÿ¥Ÿáÿ±</label>
                            <input type="month" id="reportMonth">
                            <button id="generateReport" class="btn-success" style="margin-top: 10px;">
                                <span id="generateReportText">ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑÿ™ŸÇÿ±Ÿäÿ±</span>
                            </button>
                        </div>

                        <div class="table-container">
                            <table id="salaryReportTable">
                                <thead>
                                    <tr>
                                        <th>ÿßÿ≥ŸÖ ÿßŸÑŸÖŸàÿ∏ŸÅ</th>
                                        <th>ÿßŸÑÿ±ÿßÿ™ÿ® ÿßŸÑÿ£ÿ≥ÿßÿ≥Ÿä</th>
                                        <th>ÿ£ŸäÿßŸÖ ÿßŸÑÿπŸÖŸÑ</th>
                                        <th>ÿµÿßŸÅŸä ÿßŸÑŸÖÿ±ÿ™ÿ®</th>
                                        <th>ÿßŸÑÿ™ŸÅÿßÿµŸäŸÑ</th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ÿ•ÿØÿßÿ±ÿ© ÿßŸÑÿπŸáÿØÿ© (ŸÖÿ≠ÿØÿ´ÿ©) -->
            <div id="cash" class="tab-content">
                <div class="card">
                    <div class="card-header">
                        <i class="fas fa-wallet"></i> ÿ•ÿØÿßÿ±ÿ© ÿßŸÑÿπŸáÿØÿ©
                    </div>
                    <div class="card-body">
                        <!-- ŸÖŸÑÿÆÿµ ÿßŸÑÿπŸáÿØÿ© -->
                        <div class="cash-summary">
                            <div class="cash-summary-item">
                                <span class="cash-summary-label">ÿßŸÑÿ±ÿµŸäÿØ ÿßŸÑÿ≠ÿßŸÑŸä:</span>
                                <span class="cash-summary-value" id="currentCashBalance">0 ÿ¨.ŸÖ</span>
                            </div>
                            <div class="cash-summary-item">
                                <span class="cash-summary-label">ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑÿ•ŸäÿØÿßÿπÿßÿ™:</span>
                                <span class="cash-summary-value" id="totalDeposits">0 ÿ¨.ŸÖ</span>
                            </div>
                            <div class="cash-summary-item">
                                <span class="cash-summary-label">ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑŸÖÿµÿ±ŸàŸÅÿßÿ™:</span>
                                <span class="cash-summary-value" id="totalWithdrawals">0 ÿ¨.ŸÖ</span>
                            </div>
                        </div>
                        
                        <!-- ÿ™ÿ®ŸàŸäÿ®ÿßÿ™ ÿßŸÑÿπŸáÿØÿ© -->
                        <div class="cash-tabs">
                            <div class="cash-tab active" data-tab="deposit">ÿ•ŸäÿØÿßÿπ</div>
                            <div class="cash-tab" data-tab="withdrawal">ÿµÿ±ŸÅ</div>
                        </div>
                        
                        <!-- ŸÜŸÖŸàÿ∞ÿ¨ ÿ•ŸäÿØÿßÿπ -->
                        <div id="deposit" class="cash-tab-content active">
                            <form id="cashDepositForm">
                                <div class="form-group">
                                    <label><i class="fas fa-building"></i> ÿßŸÑŸÖÿ≠ÿ∑ÿ© (ÿßÿÆÿ™Ÿäÿßÿ±Ÿä)</label>
                                    <select id="cashDepositStation">
                                        <option value="">ÿßÿÆÿ™ÿ± ÿßŸÑŸÖÿ≠ÿ∑ÿ© (ÿßÿÆÿ™Ÿäÿßÿ±Ÿä)</option>
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label><i class="fas fa-user"></i> ÿßŸÑŸÖÿ≥ÿ§ŸàŸÑ</label>
                                    <select id="cashDepositSupervisor" required>
                                        <option value="">ÿßÿÆÿ™ÿ± ÿßŸÑŸÖÿ≥ÿ§ŸàŸÑ</option>
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label><i class="fas fa-money-bill"></i> ÿßŸÑŸÖÿ®ŸÑÿ∫ (ÿ¨ŸÜŸäŸá ŸÖÿµÿ±Ÿä)</label>
                                    <input type="number" id="cashDepositAmount" required placeholder="ÿ£ÿØÿÆŸÑ ÿßŸÑŸÖÿ®ŸÑÿ∫" min="1">
                                    <div class="validation-error" id="cashDepositAmountError">Ÿäÿ±ÿ¨Ÿâ ÿ•ÿØÿÆÿßŸÑ ŸÖÿ®ŸÑÿ∫ ÿµÿ≠Ÿäÿ≠</div>
                                </div>
                                
                                <div class="form-group">
                                    <label><i class="fas fa-calendar"></i> ÿßŸÑÿ™ÿßÿ±ŸäÿÆ</label>
                                    <input type="date" id="cashDepositDate" required>
                                </div>
                                
                                <div class="form-group">
                                    <label><i class="fas fa-tag"></i> ÿ≥ÿ®ÿ® ÿßŸÑÿ•ŸäÿØÿßÿπ</label>
                                    <input type="text" id="cashDepositReason" required placeholder="ÿ£ÿØÿÆŸÑ ÿ≥ÿ®ÿ® ÿßŸÑÿ•ŸäÿØÿßÿπ">
                                </div>
                                
                                <div class="form-group">
                                    <label><i class="fas fa-sticky-note"></i> ŸÖŸÑÿßÿ≠ÿ∏ÿßÿ™ (ÿßÿÆÿ™Ÿäÿßÿ±Ÿä)</label>
                                    <textarea id="cashDepositNotes" rows="3" placeholder="ÿ£ÿØÿÆŸÑ ŸÖŸÑÿßÿ≠ÿ∏ÿßÿ™"></textarea>
                                </div>
                                
                                <button type="submit" class="btn-cash">
                                    <span id="cashDepositSubmitText"><i class="fas fa-plus-circle"></i> ÿ™ÿ≥ÿ¨ŸäŸÑ ÿ•ŸäÿØÿßÿπ</span>
                                </button>
                            </form>
                        </div>
                        
                        <!-- ŸÜŸÖŸàÿ∞ÿ¨ ÿµÿ±ŸÅ -->
                        <div id="withdrawal" class="cash-tab-content">
                            <form id="cashWithdrawalForm">
                                <div class="form-group">
                                    <label><i class="fas fa-building"></i> ÿßŸÑŸÖÿ≠ÿ∑ÿ© (ÿßÿÆÿ™Ÿäÿßÿ±Ÿä)</label>
                                    <select id="cashWithdrawalStation">
                                        <option value="">ÿßÿÆÿ™ÿ± ÿßŸÑŸÖÿ≠ÿ∑ÿ© (ÿßÿÆÿ™Ÿäÿßÿ±Ÿä)</option>
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label><i class="fas fa-user"></i> ÿßŸÑŸÖÿ≥ÿ§ŸàŸÑ</label>
                                    <select id="cashWithdrawalSupervisor" required>
                                        <option value="">ÿßÿÆÿ™ÿ± ÿßŸÑŸÖÿ≥ÿ§ŸàŸÑ</option>
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label><i class="fas fa-money-bill"></i> ÿßŸÑŸÖÿ®ŸÑÿ∫ (ÿ¨ŸÜŸäŸá ŸÖÿµÿ±Ÿä)</label>
                                    <input type="number" id="cashWithdrawalAmount" required placeholder="ÿ£ÿØÿÆŸÑ ÿßŸÑŸÖÿ®ŸÑÿ∫" min="1">
                                    <div class="validation-error" id="cashWithdrawalAmountError">Ÿäÿ±ÿ¨Ÿâ ÿ•ÿØÿÆÿßŸÑ ŸÖÿ®ŸÑÿ∫ ÿµÿ≠Ÿäÿ≠</div>
                                </div>
                                
                                <div class="form-group">
                                    <label><i class="fas fa-calendar"></i> ÿßŸÑÿ™ÿßÿ±ŸäÿÆ</label>
                                    <input type="date" id="cashWithdrawalDate" required>
                                </div>
                                
                                <div class="form-group">
                                    <label><i class="fas fa-tag"></i> ÿ≥ÿ®ÿ® ÿßŸÑÿµÿ±ŸÅ</label>
                                    <input type="text" id="cashWithdrawalReason" required placeholder="ÿ£ÿØÿÆŸÑ ÿ≥ÿ®ÿ® ÿßŸÑÿµÿ±ŸÅ">
                                </div>
                                
                                <div class="form-group">
                                    <label><i class="fas fa-user"></i> ÿßŸÑŸÖÿ≥ÿ™ŸÑŸÖ</label>
                                    <input type="text" id="cashWithdrawalRecipient" required placeholder="ÿ£ÿØÿÆŸÑ ÿßÿ≥ŸÖ ÿßŸÑŸÖÿ≥ÿ™ŸÑŸÖ">
                                </div>
                                
                                <div class="form-group">
                                    <label><i class="fas fa-sticky-note"></i> ŸÖŸÑÿßÿ≠ÿ∏ÿßÿ™ (ÿßÿÆÿ™Ÿäÿßÿ±Ÿä)</label>
                                    <textarea id="cashWithdrawalNotes" rows="3" placeholder="ÿ£ÿØÿÆŸÑ ŸÖŸÑÿßÿ≠ÿ∏ÿßÿ™"></textarea>
                                </div>
                                
                                <div class="alert alert-warning">
                                    <i class="fas fa-exclamation-triangle"></i>
                                    ŸäŸÖŸÉŸÜŸÉ ÿßŸÑÿµÿ±ŸÅ ÿ≠ÿ™Ÿâ ŸÑŸà ŸÉÿßŸÜ ÿßŸÑÿ±ÿµŸäÿØ ÿ∫Ÿäÿ± ŸÉÿßŸÅŸç - ÿ≥Ÿäÿ∏Ÿáÿ± ÿßŸÑÿ±ÿµŸäÿØ ÿ®ÿßŸÑÿ≥ÿßŸÑÿ®
                                </div>
                                
                                <button type="submit" class="btn-warning">
                                    <span id="cashWithdrawalSubmitText"><i class="fas fa-minus-circle"></i> ÿ™ÿ≥ÿ¨ŸäŸÑ ÿµÿ±ŸÅ</span>
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
                
                <!-- ÿ≥ÿ¨ŸÑ ÿ≠ÿ±ŸÉÿßÿ™ ÿßŸÑÿπŸáÿØÿ© -->
                <div class="card">
                    <div class="card-header">
                        <i class="fas fa-history"></i> ÿ≥ÿ¨ŸÑ ÿ≠ÿ±ŸÉÿßÿ™ ÿßŸÑÿπŸáÿØÿ©
                        <button class="btn-secondary" id="exportCashTransactions" style="padding: 8px 12px; width: auto;">ÿ™ÿµÿØŸäÿ± Excel</button>
                    </div>
                    <div class="card-body">
                        <div class="filter-section">
                            <div class="filter-with-button">
                                <div class="form-group">
                                    <label><i class="fas fa-filter"></i> ŸÅŸÑÿ™ÿ±ÿ© ÿ≠ÿ≥ÿ® ÿßŸÑÿ™ÿßÿ±ŸäÿÆ</label>
                                    <input type="date" id="filterCashDate">
                                </div>
                                <button class="btn-secondary" id="filterCashBtn">
                                    <i class="fas fa-search"></i> ÿ®ÿ≠ÿ´
                                </button>
                            </div>
                            <div class="form-group" style="margin-top: 10px;">
                                <label><i class="fas fa-tag"></i> ŸÜŸàÿπ ÿßŸÑÿ≠ÿ±ŸÉÿ©</label>
                                <select id="filterCashType">
                                    <option value="">ÿ¨ŸÖŸäÿπ ÿßŸÑÿ≠ÿ±ŸÉÿßÿ™</option>
                                    <option value="ÿ•ŸäÿØÿßÿπ">ÿ•ŸäÿØÿßÿπ</option>
                                    <option value="ÿµÿ±ŸÅ">ÿµÿ±ŸÅ</option>
                                </select>
                            </div>
                            <div class="form-group" style="margin-top: 10px;">
                                <label><i class="fas fa-user"></i> ÿßŸÑŸÖÿ≥ÿ§ŸàŸÑ</label>
                                <select id="filterCashSupervisor">
                                    <option value="">ÿ¨ŸÖŸäÿπ ÿßŸÑŸÖÿ≥ÿ§ŸàŸÑŸäŸÜ</option>
                                </select>
                            </div>
                        </div>
                        <div id="cashTransactionsList" class="empty-state">
                            ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ≠ÿ±ŸÉÿßÿ™ ŸÑŸÑÿπŸáÿØÿ©
                        </div>
                    </div>
                </div>
            </div>

            <!-- ÿ≥ÿ¨ŸÑ ÿßŸÑÿ£ÿπÿ∑ÿßŸÑ -->
            <div id="faults" class="tab-content">
                <div class="card">
                    <div class="card-header">ÿ™ÿ≥ÿ¨ŸäŸÑ ÿπÿ∑ŸÑ ÿ¨ÿØŸäÿØ</div>
                    <div class="card-body">
                        <form id="faultForm">
                            <div class="form-group">
                                <label for="faultStation">ÿßÿÆÿ™ÿ± ÿßŸÑŸÖÿ≠ÿ∑ÿ©</label>
                                <select id="faultStation" required>
                                    <option value="">ÿßÿÆÿ™ÿ± ÿßŸÑŸÖÿ≠ÿ∑ÿ©</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="faultSupervisor">ÿßŸÑŸÖÿ≥ÿ§ŸàŸÑ ÿπŸÜ ÿßŸÑÿ™ÿ≥ÿ¨ŸäŸÑ</label>
                                <select id="faultSupervisor" required>
                                    <option value="">ÿßÿÆÿ™ÿ± ÿßŸÑŸÖÿ≥ÿ§ŸàŸÑ</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="faultTitle">ÿπŸÜŸàÿßŸÜ ÿßŸÑÿπÿ∑ŸÑ</label>
                                <input type="text" id="faultTitle" required placeholder="ÿ£ÿØÿÆŸÑ ÿπŸÜŸàÿßŸÜ ÿßŸÑÿπÿ∑ŸÑ">
                            </div>
                            <div class="form-group">
                                <label for="faultDescription">ÿ™ŸÅÿßÿµŸäŸÑ ÿßŸÑÿπÿ∑ŸÑ</label>
                                <textarea id="faultDescription" rows="4" required placeholder="ÿ£ÿØÿÆŸÑ ÿ™ŸÅÿßÿµŸäŸÑ ÿßŸÑÿπÿ∑ŸÑ"></textarea>
                            </div>
                            <div class="form-group">
                                <label for="faultDate">ÿ™ÿßÿ±ŸäÿÆ ÿßŸÑÿπÿ∑ŸÑ</label>
                                <input type="date" id="faultDate" required>
                            </div>
                            <div class="form-group">
                                <label for="faultStatus">ÿ≠ÿßŸÑÿ© ÿßŸÑÿπÿ∑ŸÑ</label>
                                <select id="faultStatus" required>
                                    <option value="pending">ŸÑŸÖ Ÿäÿ™ŸÖ ÿßŸÑÿ•ÿµŸÑÿßÿ≠</option>
                                    <option value="in-progress">ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ•ÿµŸÑÿßÿ≠</option>
                                    <option value="fixed">ÿ™ŸÖ ÿßŸÑÿ•ÿµŸÑÿßÿ≠</option>
                                </select>
                            </div>
                            <button type="submit" class="btn-success">
                                <span id="faultSubmitText">ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿπÿ∑ŸÑ</span>
                            </button>
                        </form>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        ÿ≥ÿ¨ŸÑ ÿßŸÑÿ£ÿπÿ∑ÿßŸÑ
                        <button class="btn-secondary" id="exportFaults" style="padding: 8px 12px; width: auto;">ÿ™ÿµÿØŸäÿ± Excel</button>
                    </div>
                    <div class="card-body">
                        <div class="filter-section">
                            <h4>ŸÅŸÑÿ™ÿ±ÿ© ÿßŸÑÿ£ÿπÿ∑ÿßŸÑ</h4>
                            <div class="filter-row">
                                <div class="form-group">
                                    <label for="filterFaultStation">ÿßÿÆÿ™ÿ± ÿßŸÑŸÖÿ≠ÿ∑ÿ©</label>
                                    <select id="filterFaultStation">
                                        <option value="">ÿ¨ŸÖŸäÿπ ÿßŸÑŸÖÿ≠ÿ∑ÿßÿ™</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="filterFaultStatus">ÿ≠ÿßŸÑÿ© ÿßŸÑÿπÿ∑ŸÑ</label>
                                    <select id="filterFaultStatus">
                                        <option value="">ÿ¨ŸÖŸäÿπ ÿßŸÑÿ≠ÿßŸÑÿßÿ™</option>
                                        <option value="pending">ŸÑŸÖ Ÿäÿ™ŸÖ ÿßŸÑÿ•ÿµŸÑÿßÿ≠</option>
                                        <option value="in-progress">ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ•ÿµŸÑÿßÿ≠</option>
                                        <option value="fixed">ÿ™ŸÖ ÿßŸÑÿ•ÿµŸÑÿßÿ≠</option>
                                    </select>
                                </div>
                            </div>
                            <div class="filter-row" style="margin-top: 10px;">
                                <div class="form-group">
                                    <label for="filterFaultStartDate">ŸÖŸÜ ÿ™ÿßÿ±ŸäÿÆ</label>
                                    <input type="date" id="filterFaultStartDate">
                                </div>
                                <div class="form-group">
                                    <label for="filterFaultEndDate">ÿ•ŸÑŸâ ÿ™ÿßÿ±ŸäÿÆ</label>
                                    <input type="date" id="filterFaultEndDate">
                                </div>
                                <div class="filter-actions">
                                    <button class="btn-success" id="applyFaultFilter">
                                        <i class="fas fa-filter"></i> ÿ™ÿ∑ÿ®ŸäŸÇ
                                    </button>
                                    <button class="btn-secondary" id="resetFaultFilter">
                                        <i class="fas fa-redo"></i> ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div id="faultsList" class="empty-state">
                            ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ£ÿπÿ∑ÿßŸÑ ŸÖÿ≥ÿ¨ŸÑÿ©
                        </div>
                    </div>
                </div>
            </div>

            <!-- ÿ•ÿØÿßÿ±ÿ© ÿßŸÑŸÖÿ≠ÿ∑ÿßÿ™ -->
            <div id="stations" class="tab-content">
                <div class="card">
                    <div class="card-header">ÿ•ÿ∂ÿßŸÅÿ© ŸÖÿ≠ÿ∑ÿ© ÿ¨ÿØŸäÿØÿ©</div>
                    <div class="card-body">
                        <form id="stationForm">
                            <div class="form-group">
                                <label for="stationName">ÿßÿ≥ŸÖ ÿßŸÑŸÖÿ≠ÿ∑ÿ©</label>
                                <input type="text" id="stationName" required placeholder="ÿ£ÿØÿÆŸÑ ÿßÿ≥ŸÖ ÿßŸÑŸÖÿ≠ÿ∑ÿ©">
                            </div>
                            <div class="form-group">
                                <label for="stationType">ŸÜŸàÿπ ÿßŸÑŸÖÿ≠ÿ∑ÿ©</label>
                                <select id="stationType" required>
                                    <option value="">ÿßÿÆÿ™ÿ± ŸÜŸàÿπ ÿßŸÑŸÖÿ≠ÿ∑ÿ©</option>
                                    <option value="ÿµÿ±ŸÅ">ÿµÿ±ŸÅ ÿµÿ≠Ÿä</option>
                                    <option value="ŸÖŸäÿßŸá">ŸÖŸäÿßŸá</option>
                                    <option value="ÿ±ŸÅÿπ">ÿ±ŸÅÿπ ÿµÿ±ŸÅ ÿµÿ≠Ÿä</option>
                                    <option value="ŸÖÿπÿßŸÑÿ¨ÿ©">ŸÖÿπÿßŸÑÿ¨ÿ©</option>
                                    <option value="ŸÖÿ≠ÿ∑ÿ© ÿ™ÿ≠ŸÑŸäÿ©">ŸÖÿ≠ÿ∑ÿ© ÿ™ÿ≠ŸÑŸäÿ©</option>
                                    <option value="ÿ£ÿÆÿ±Ÿâ">ÿ£ÿÆÿ±Ÿâ</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="stationGovernorate">ÿßŸÑŸÖÿ≠ÿßŸÅÿ∏ÿ©</label>
                                <select id="stationGovernorate" required>
                                    <option value="">ÿßÿÆÿ™ÿ± ÿßŸÑŸÖÿ≠ÿßŸÅÿ∏ÿ©</option>
                                    <option value="ÿßŸÑŸÇÿßŸáÿ±ÿ©">ÿßŸÑŸÇÿßŸáÿ±ÿ©</option>
                                    <option value="ÿßŸÑÿ¨Ÿäÿ≤ÿ©">ÿßŸÑÿ¨Ÿäÿ≤ÿ©</option>
                                    <option value="ÿßŸÑÿ•ÿ≥ŸÉŸÜÿØÿ±Ÿäÿ©">ÿßŸÑÿ•ÿ≥ŸÉŸÜÿØÿ±Ÿäÿ©</option>
                                    <option value="ÿßŸÑÿØŸÇŸáŸÑŸäÿ©">ÿßŸÑÿØŸÇŸáŸÑŸäÿ©</option>
                                    <option value="ÿßŸÑÿ¥ÿ±ŸÇŸäÿ©">ÿßŸÑÿ¥ÿ±ŸÇŸäÿ©</option>
                                    <option value="ÿßŸÑÿ∫ÿ±ÿ®Ÿäÿ©">ÿßŸÑÿ∫ÿ±ÿ®Ÿäÿ©</option>
                                    <option value="ÿßŸÑŸÇŸÑŸäŸàÿ®Ÿäÿ©">ÿßŸÑŸÇŸÑŸäŸàÿ®Ÿäÿ©</option>
                                    <option value="ÿßŸÑŸÖŸÜŸàŸÅŸäÿ©">ÿßŸÑŸÖŸÜŸàŸÅŸäÿ©</option>
                                    <option value="ÿßŸÑÿ®ÿ≠Ÿäÿ±ÿ©">ÿßŸÑÿ®ÿ≠Ÿäÿ±ÿ©</option>
                                    <option value="ŸÉŸÅÿ± ÿßŸÑÿ¥ŸäÿÆ">ŸÉŸÅÿ± ÿßŸÑÿ¥ŸäÿÆ</option>
                                    <option value="ÿØŸÖŸäÿßÿ∑">ÿØŸÖŸäÿßÿ∑</option>
                                    <option value="ÿ®Ÿàÿ±ÿ≥ÿπŸäÿØ">ÿ®Ÿàÿ±ÿ≥ÿπŸäÿØ</option>
                                    <option value="ÿßŸÑÿ•ÿ≥ŸÖÿßÿπŸäŸÑŸäÿ©">ÿßŸÑÿ•ÿ≥ŸÖÿßÿπŸäŸÑŸäÿ©</option>
                                    <option value="ÿßŸÑÿ≥ŸàŸäÿ≥">ÿßŸÑÿ≥ŸàŸäÿ≥</option>
                                    <option value="ÿ¥ŸÖÿßŸÑ ÿ≥ŸäŸÜÿßÿ°">ÿ¥ŸÖÿßŸÑ ÿ≥ŸäŸÜÿßÿ°</option>
                                    <option value="ÿ¨ŸÜŸàÿ® ÿ≥ŸäŸÜÿßÿ°">ÿ¨ŸÜŸàÿ® ÿ≥ŸäŸÜÿßÿ°</option>
                                    <option value="ÿ®ŸÜŸä ÿ≥ŸàŸäŸÅ">ÿ®ŸÜŸä ÿ≥ŸàŸäŸÅ</option>
                                    <option value="ÿßŸÑŸÅŸäŸàŸÖ">ÿßŸÑŸÅŸäŸàŸÖ</option>
                                    <option value="ÿßŸÑŸÖŸÜŸäÿß">ÿßŸÑŸÖŸÜŸäÿß</option>
                                    <option value="ÿ£ÿ≥ŸäŸàÿ∑">ÿ£ÿ≥ŸäŸàÿ∑</option>
                                    <option value="ÿ≥ŸàŸáÿßÿ¨">ÿ≥ŸàŸáÿßÿ¨</option>
                                    <option value="ŸÇŸÜÿß">ŸÇŸÜÿß</option>
                                    <option value="ÿßŸÑÿ£ŸÇÿµÿ±">ÿßŸÑÿ£ŸÇÿµÿ±</option>
                                    <option value="ÿ£ÿ≥ŸàÿßŸÜ">ÿ£ÿ≥ŸàÿßŸÜ</option>
                                    <option value="ÿßŸÑŸàÿßÿØŸä ÿßŸÑÿ¨ÿØŸäÿØ">ÿßŸÑŸàÿßÿØŸä ÿßŸÑÿ¨ÿØŸäÿØ</option>
                                    <option value="ŸÖÿ∑ÿ±Ÿàÿ≠">ŸÖÿ∑ÿ±Ÿàÿ≠</option>
                                    <option value="ÿßŸÑÿ®ÿ≠ÿ± ÿßŸÑÿ£ÿ≠ŸÖÿ±">ÿßŸÑÿ®ÿ≠ÿ± ÿßŸÑÿ£ÿ≠ŸÖÿ±</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="stationArea">ÿßŸÑŸÖŸÜÿ∑ŸÇÿ©</label>
                                <input type="text" id="stationArea" required placeholder="ÿ£ÿØÿÆŸÑ ÿßÿ≥ŸÖ ÿßŸÑŸÖŸÜÿ∑ŸÇÿ©">
                            </div>
                            <div class="form-group">
                                <label for="stationAddress">ÿßŸÑÿπŸÜŸàÿßŸÜ ÿ®ÿßŸÑÿ™ŸÅÿµŸäŸÑ</label>
                                <textarea id="stationAddress" rows="3" required placeholder="ÿ£ÿØÿÆŸÑ ÿßŸÑÿπŸÜŸàÿßŸÜ ÿ®ÿßŸÑÿ™ŸÅÿµŸäŸÑ"></textarea>
                            </div>
                            <button type="submit" class="btn-success">
                                <span id="stationSubmitText">ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑŸÖÿ≠ÿ∑ÿ©</span>
                            </button>
                        </form>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑŸÖÿ≠ÿ∑ÿßÿ™
                        <button class="btn-secondary" id="exportStations" style="padding: 8px 12px; width: auto;">ÿ™ÿµÿØŸäÿ± Excel</button>
                    </div>
                    <div class="card-body">
                        <div id="stationsList" class="empty-state">
                            ŸÑÿß ÿ™Ÿàÿ¨ÿØ ŸÖÿ≠ÿ∑ÿßÿ™ ŸÖÿ≥ÿ¨ŸÑÿ©
                        </div>
                    </div>
                </div>
            </div>

            <!-- ÿ•ÿØÿßÿ±ÿ© ÿßŸÑŸÖÿ≥ÿ§ŸàŸÑŸäŸÜ -->
            <div id="supervisors" class="tab-content">
                <div class="card">
                    <div class="card-header">ÿ•ÿ∂ÿßŸÅÿ© ŸÖÿ≥ÿ§ŸàŸÑ ÿ¨ÿØŸäÿØ</div>
                    <div class="card-body">
                        <form id="supervisorForm">
                            <div class="form-group">
                                <label for="supervisorEmployee">ÿßÿÆÿ™ÿ± ÿßŸÑŸÖŸàÿ∏ŸÅ ŸÖŸÜ ŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™</label>
                                <select id="supervisorEmployee" required>
                                    <option value="">ÿßÿÆÿ™ÿ± ÿßŸÑŸÖŸàÿ∏ŸÅ</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="supervisorPassword">ŸÉŸÑŸÖÿ© ÿßŸÑÿ≥ÿ±</label>
                                <div style="display: flex; gap: 10px;">
                                    <input type="text" id="supervisorPassword" required placeholder="ÿ£ÿØÿÆŸÑ ŸÉŸÑŸÖÿ© ÿßŸÑÿ≥ÿ± ŸÑŸÑŸÖÿ≥ÿ§ŸàŸÑ" style="flex: 1;">
                                    <button type="button" class="btn-secondary" id="generatePasswordBtn" style="width: auto; padding: 14px;">
                                        <i class="fas fa-key"></i> ÿ•ŸÜÿ¥ÿßÿ°
                                    </button>
                                </div>
                                <div class="validation-error" id="supervisorPasswordError">ŸÉŸÑŸÖÿ© ÿßŸÑÿ≥ÿ± ŸÖÿ∑ŸÑŸàÿ®ÿ©</div>
                            </div>
                            <div class="form-group">
                                <label for="supervisorActive">ÿ≠ÿßŸÑÿ© ÿßŸÑŸÖÿ≥ÿ§ŸàŸÑ</label>
                                <select id="supervisorActive" required>
                                    <option value="true">ŸÅÿπÿßŸÑ</option>
                                    <option value="false">ÿ∫Ÿäÿ± ŸÅÿπÿßŸÑ</option>
                                </select>
                            </div>
                            <button type="submit" class="btn-success">
                                <span id="supervisorSubmitText">ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑŸÖÿ≥ÿ§ŸàŸÑ</span>
                            </button>
                        </form>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑŸÖÿ≥ÿ§ŸàŸÑŸäŸÜ
                        <button class="btn-secondary" id="exportSupervisors" style="padding: 8px 12px; width: auto;">ÿ™ÿµÿØŸäÿ± Excel</button>
                    </div>
                    <div class="card-body">
                        <div id="supervisorsList" class="empty-state">
                            ŸÑÿß ŸäŸàÿ¨ÿØ ŸÖÿ≥ÿ§ŸàŸÑŸäŸÜ ŸÖÿ≥ÿ¨ŸÑŸäŸÜ
                        </div>
                    </div>
                </div>
            </div>

            <!-- ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™ -->
            <div id="settings" class="tab-content">
                <div class="card">
                    <div class="card-header">ÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑŸÜÿ∏ÿßŸÖ</div>
                    <div class="card-body">
                        <div class="form-group">
                            <label for="appName">ÿßÿ≥ŸÖ ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇ</label>
                            <input type="text" id="appName" value="ŸÜÿ∏ÿßŸÖ ÿ•ÿØÿßÿ±ÿ© ÿßŸÑÿ≠ÿ∂Ÿàÿ± ŸàÿßŸÑÿ∫Ÿäÿßÿ® ÿßŸÑŸÖÿ™ŸÇÿØŸÖ">
                        </div>
                        
                        <div class="form-group">
                            <label for="companyName">ÿßÿ≥ŸÖ ÿßŸÑÿ¥ÿ±ŸÉÿ©</label>
                            <input type="text" id="companyName" placeholder="ÿ£ÿØÿÆŸÑ ÿßÿ≥ŸÖ ÿßŸÑÿ¥ÿ±ŸÉÿ©">
                        </div>
                        
                        <div class="form-group">
                            <label for="defaultWorkDays">ÿ£ŸäÿßŸÖ ÿßŸÑÿπŸÖŸÑ ÿßŸÑÿßŸÅÿ™ÿ±ÿßÿ∂Ÿäÿ©</label>
                            <input type="number" id="defaultWorkDays" value="24">
                        </div>
                        
                        <div class="form-group">
                            <label for="language">ÿßŸÑŸÑÿ∫ÿ©</label>
                            <select id="language">
                                <option value="ar">ÿßŸÑÿπÿ±ÿ®Ÿäÿ©</option>
                                <option value="en">English</option>
                            </select>
                        </div>
                        
                        <button class="btn-success" id="saveSettingsBtn">ÿ≠ŸÅÿ∏ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™</button>
                    </div>
                </div>
            </div>

            <!-- ÿßŸÑŸÜÿ≥ÿÆ ÿßŸÑÿßÿ≠ÿ™Ÿäÿßÿ∑Ÿä -->
            <div id="backup" class="tab-content">
                <div class="card">
                    <div class="card-header">ÿßŸÑŸÜÿ≥ÿÆ ÿßŸÑÿßÿ≠ÿ™Ÿäÿßÿ∑Ÿä ŸÑŸÑÿ®ŸäÿßŸÜÿßÿ™</div>
                    <div class="card-body">
                        <p>ŸäŸÖŸÉŸÜŸÉ ŸÖŸÜ ÿÆŸÑÿßŸÑ Ÿáÿ∞Ÿá ÿßŸÑÿµŸÅÿ≠ÿ© ÿ•ŸÜÿ¥ÿßÿ° ŸÜÿ≥ÿÆÿ© ÿßÿ≠ÿ™Ÿäÿßÿ∑Ÿäÿ© ŸÖŸÜ ÿ¨ŸÖŸäÿπ ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇ Ÿàÿßÿ≥ÿ™ÿπÿßÿØÿ™Ÿáÿß ÿπŸÜÿØ ÿßŸÑÿ≠ÿßÿ¨ÿ©.</p>
                        
                        <div class="backup-section">
                            <h3>ÿ™ÿ≠ŸÖŸäŸÑ ŸÜÿ≥ÿÆÿ© ÿßÿ≠ÿ™Ÿäÿßÿ∑Ÿäÿ©</h3>
                            <p>ŸÇŸÖ ÿ®ÿ™ÿ≠ŸÖŸäŸÑ ŸÜÿ≥ÿÆÿ© ÿßÿ≠ÿ™Ÿäÿßÿ∑Ÿäÿ© ŸÖŸÜ ÿ¨ŸÖŸäÿπ ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇ (ÿßŸÑŸÖŸàÿ∏ŸÅŸäŸÜÿå ÿßŸÑÿ≠ÿ∂Ÿàÿ±ÿå ÿßŸÑÿ•ÿ¨ÿßÿ≤ÿßÿ™ÿå ŸàÿßŸÑÿ≠ÿ±ŸÉÿßÿ™ ÿßŸÑŸÖÿßŸÑŸäÿ©ÿå ÿßŸÑŸÖÿ≠ÿ∑ÿßÿ™ÿå ÿßŸÑŸÖÿ≥ÿ§ŸàŸÑŸäŸÜÿå ÿßŸÑÿ£ÿπÿ∑ÿßŸÑ).</p>
                            <button class="btn-success" id="downloadBackupBtn">
                                <i class="fas fa-download"></i> ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÜÿ≥ÿÆÿ© ÿßŸÑÿßÿ≠ÿ™Ÿäÿßÿ∑Ÿäÿ©
                            </button>
                        </div>
                        
                        <div class="backup-section">
                            <h3>ÿßÿ≥ÿ™ÿπÿßÿØÿ© ŸÜÿ≥ÿÆÿ© ÿßÿ≠ÿ™Ÿäÿßÿ∑Ÿäÿ©</h3>
                            <p>ŸÇŸÖ ÿ®ÿ±ŸÅÿπ ŸÜÿ≥ÿÆÿ© ÿßÿ≠ÿ™Ÿäÿßÿ∑Ÿäÿ© ÿ≥ÿßÿ®ŸÇÿ© ŸÑÿßÿ≥ÿ™ÿπÿßÿØÿ© ÿ¨ŸÖŸäÿπ ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇ.</p>
                            <div class="form-group">
                                <label for="backupFile">ÿßÿÆÿ™ÿ± ŸÖŸÑŸÅ ÿßŸÑŸÜÿ≥ÿÆÿ© ÿßŸÑÿßÿ≠ÿ™Ÿäÿßÿ∑Ÿäÿ©</label>
                                <input type="file" id="backupFile" accept=".json">
                            </div>
                            <button class="btn-warning" id="restoreBackupBtn">
                                <i class="fas fa-upload"></i> ÿßÿ≥ÿ™ÿπÿßÿØÿ© ÿßŸÑŸÜÿ≥ÿÆÿ© ÿßŸÑÿßÿ≠ÿ™Ÿäÿßÿ∑Ÿäÿ©
                            </button>
                        </div>
                        
                        <div class="backup-section">
                            <h3>ÿ≠ÿ∞ŸÅ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™</h3>
                            <p>ÿ™ÿ≠ÿ∞Ÿäÿ±: Ÿáÿ∞ÿß ÿßŸÑÿ•ÿ¨ÿ±ÿßÿ° ÿ≥ŸäŸÇŸàŸÖ ÿ®ÿ≠ÿ∞ŸÅ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ŸàŸÑÿß ŸäŸÖŸÉŸÜ ÿßŸÑÿ™ÿ±ÿßÿ¨ÿπ ÿπŸÜŸá.</p>
                            <button class="btn-danger" id="deleteAllDataBtn">
                                <i class="fas fa-trash"></i> ÿ≠ÿ∞ŸÅ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™
                            </button>
                        </div>
                        
                        <div class="backup-section">
                            <h3>ÿ≠ÿ∞ŸÅ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿ®ÿ¥ŸÉŸÑ ÿßŸÜÿ™ŸÇÿßÿ¶Ÿä</h3>
                            <p>ŸäŸÖŸÉŸÜŸÉ ŸáŸÜÿß ÿ≠ÿ∞ŸÅ ÿ¨ÿ≤ÿ° ŸÖÿ≠ÿØÿØ ŸÖŸÜ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ (ŸÖÿ´ŸÑ ÿ≥ÿ¨ŸÑÿßÿ™ ÿßŸÑÿ≠ÿ∂Ÿàÿ±) ŸÑŸÅÿ™ÿ±ÿ© ÿ≤ŸÖŸÜŸäÿ© ŸÖÿπŸäŸÜÿ© ÿØŸàŸÜ ÿßŸÑÿ™ÿ£ÿ´Ÿäÿ± ÿπŸÑŸâ ÿ®ÿßŸÇŸä ÿßŸÑŸÜÿ∏ÿßŸÖ.</p>
                            
                            <div class="form-group">
                                <label for="selectiveDataType">ÿßÿÆÿ™ÿ± ŸÜŸàÿπ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸÖÿ±ÿßÿØ ÿ≠ÿ∞ŸÅŸáÿß</label>
                                <select id="selectiveDataType" required>
                                    <option value="attendance">ÿ≥ÿ¨ŸÑÿßÿ™ ÿßŸÑÿ≠ÿ∂Ÿàÿ±</option>
                                    <option value="financials">ÿßŸÑÿ≠ÿ±ŸÉÿßÿ™ ÿßŸÑŸÖÿßŸÑŸäÿ©</option>
                                    <option value="cashTransactions">ÿ≠ÿ±ŸÉÿßÿ™ ÿßŸÑÿπŸáÿØÿ©</option>
                                    <option value="faults">ÿ≥ÿ¨ŸÑ ÿßŸÑÿ£ÿπÿ∑ÿßŸÑ</option>
                                </select>
                            </div>
                            
                            <div class="filter-row">
                                <div class="form-group">
                                    <label for="selectiveStartDate">ŸÖŸÜ ÿ™ÿßÿ±ŸäÿÆ</label>
                                    <input type="date" id="selectiveStartDate" required>
                                </div>
                                <div class="form-group">
                                    <label for="selectiveEndDate">ÿ•ŸÑŸâ ÿ™ÿßÿ±ŸäÿÆ</label>
                                    <input type="date" id="selectiveEndDate" required>
                                </div>
                            </div>
                            
                            <button class="btn-danger" id="deleteSelectiveDataBtn">
                                <i class="fas fa-trash-alt"></i> ÿ≠ÿ∞ŸÅ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸÖÿ≠ÿØÿØÿ©
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <nav class="bottom-nav">
            <a href="#" class="nav-item" data-target="dashboard">
                <div class="nav-icon"><i class="fas fa-home"></i></div>
                <div class="nav-text">ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©</div>
            </a>
            <a href="#" class="nav-item" data-target="employees">
                <div class="nav-icon"><i class="fas fa-users"></i></div>
                <div class="nav-text">ÿßŸÑŸÖŸàÿ∏ŸÅŸäŸÜ</div>
            </a>
            <a href="#" class="nav-item-attendance" data-target="attendance">
                <div class="nav-icon"><i class="fas fa-user-check"></i></div>
                <div class="nav-text">ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿ≠ÿ∂Ÿàÿ±</div>
            </a>
            <a href="#" class="nav-item" data-target="faults">
                <div class="nav-icon"><i class="fas fa-exclamation-triangle"></i></div>
                <div class="nav-text">ÿßŸÑÿ£ÿπÿ∑ÿßŸÑ</div>
            </a>
            <a href="#" class="nav-item" data-target="stations">
                <div class="nav-icon"><i class="fas fa-building"></i></div>
                <div class="nav-text">ÿßŸÑŸÖÿ≠ÿ∑ÿßÿ™</div>
            </a>
        </nav>
    </div>

    <script>
        // ÿ•ÿπÿØÿßÿØÿßÿ™ Firebase - ŸÜŸÅÿ≥ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖÿ© ŸÅŸä ÿ™ÿ∑ÿ®ŸäŸÇ ÿßŸÑŸÖÿ≥ÿ§ŸàŸÑŸäŸÜ
        const firebaseConfig = {
            apiKey: "AIzaSyDjImFc52SF5TlN7k7vz0H6-8bWl8Pkz0k",
            authDomain: "haat-a88ee.firebaseapp.com",
            databaseURL: "https://haat-a88ee-default-rtdb.firebaseio.com",
            projectId: "haat-a88ee",
            storageBucket: "haat-a88ee.appspot.com",
            messagingSenderId: "123456789012",
            appId: "1:123456789012:web:abcdef1234567890"
        };

        // ÿ™ŸáŸäÿ¶ÿ© Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // ŸÖÿ™ÿ∫Ÿäÿ±ÿßÿ™ ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇ
        let employees = [];
        let attendance = [];
        let leaves = [];
        let financials = [];
        let employeeDatabase = [];
        let cashTransactions = []; // ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿπŸáÿØÿ©
        let stations = [];
        let supervisors = [];
        let faults = [];
        let currentReportData = null;
        let isConnected = false;
        let connectionRetryCount = 0;
        const maxRetries = 3;
        
        // ŸÉŸÑŸÖÿßÿ™ ÿπÿ±ÿ®Ÿäÿ© ŸÑÿ•ŸÜÿ¥ÿßÿ° ŸÉŸÑŸÖÿßÿ™ ÿ≥ÿ± ÿπÿ¥Ÿàÿßÿ¶Ÿäÿ©
        const arabicWords = [
            'ŸÇŸÖÿ©', 'ÿ®ÿ≠ÿ±', 'ŸÜŸàÿ±', 'ÿ≥ÿ≠ÿ±', 'ÿ£ŸÖŸÑ', 'ŸÜÿ¨ÿßÿ≠', 'ÿ™ŸÖŸäÿ≤', 'ÿßÿ®ÿØÿßÿπ', 'ÿ™ŸÅŸàŸÇ', 'ÿ±ŸäÿßÿØÿ©',
            'ÿ≥ŸÖÿßÿ°', 'ŸÇŸÖÿ±', 'ÿ¥ŸÖÿ≥', 'Ÿàÿ±ÿØ', 'ÿπÿ∑ÿ±', 'ŸÑÿ§ŸÑÿ§', 'ŸÖÿ±ÿ¨ÿßŸÜ', 'ŸäÿßŸÇŸàÿ™', 'ÿ≤ŸÖÿ±ÿØ', 'ŸÅŸäÿ±Ÿàÿ≤',
            'ÿµŸÇÿ±', 'ŸÜÿ≥ÿ±', 'ÿ£ÿ≥ÿØ', 'ŸÜŸÖÿ±', 'ŸÅŸáÿØ', 'ÿ∫ÿ≤ÿßŸÑ', 'ŸäŸÖÿßŸÖÿ©', 'ÿ®ŸÑÿ®ŸÑ', 'ÿπŸÜÿØŸÑŸäÿ®', 'ÿ®ŸàŸÖÿ©',
            'ŸÜÿÆŸÑÿ©', 'ÿ≤Ÿäÿ™ŸàŸÜ', 'ÿ™ŸÅÿßÿ≠', 'ÿ®ÿ±ÿ™ŸÇÿßŸÑ', 'ŸÑŸäŸÖŸàŸÜ', 'ŸÖÿßŸÜÿ¨Ÿà', 'ÿπŸÜÿ®', 'ÿ™ŸäŸÜ', 'ÿ±ŸÖÿßŸÜ', 'ŸÅÿ±ÿßŸàŸÑÿ©'
        ];

        // ÿπŸÜÿßÿµÿ± DOM
        const sideMenu = document.getElementById('sideMenu');
        const overlay = document.getElementById('overlay');
        const menuBtn = document.getElementById('menuBtn');
        const closeMenu = document.getElementById('closeMenu');
        const exportBtn = document.getElementById('exportBtn');
        const connectionStatus = document.getElementById('connectionStatus');

        // ÿ™ŸáŸäÿ¶ÿ© ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇ
        document.addEventListener('DOMContentLoaded', function() {
            const today = new Date().toISOString().split('T')[0];
            
            // ÿ™ÿπŸäŸäŸÜ ÿßŸÑÿ™Ÿàÿßÿ±ŸäÿÆ ÿßŸÑÿßŸÅÿ™ÿ±ÿßÿ∂Ÿäÿ©
            document.getElementById('attendanceDate').value = today;
            document.getElementById('leaveStart').value = today;
            document.getElementById('leaveEnd').value = today;
            document.getElementById('financialDate').value = today;
            document.getElementById('faultDate').value = today;
            document.getElementById('cashDepositDate').value = today;
            document.getElementById('cashWithdrawalDate').value = today;
            document.getElementById('filterCashDate').value = today;
            document.getElementById('selectMonthForReport').value = new Date().toISOString().slice(0, 7);
            
            const currentMonth = new Date().toISOString().slice(0, 7);
            document.getElementById('filterAttendanceMonth').value = currentMonth;
            document.getElementById('reportMonth').value = currentMonth;
            document.getElementById('filterFinancialMonth').value = currentMonth;
            
            document.getElementById('leaveFilterStartDate').value = today;
            document.getElementById('leaveFilterEndDate').value = today;
            document.getElementById('filterFaultStartDate').value = today;
            document.getElementById('filterFaultEndDate').value = today;
            
            const firstDayOfMonth = new Date(new Date().getFullYear(), new Date().getMonth(), 1).toISOString().split('T')[0];
            document.getElementById('selectiveStartDate').value = firstDayOfMonth;
            document.getElementById('selectiveEndDate').value = today;
            
            setupEventListeners();
            monitorConnection();
            loadAllData();
            
            // ÿ•ÿÆŸÅÿßÿ° ŸÜŸÖŸàÿ∞ÿ¨ ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑŸÖŸàÿ∏ŸÅ ŸÅŸä ÿßŸÑÿ®ÿØÿßŸäÿ©
            document.getElementById('employeeForm').classList.add('hidden');
            document.getElementById('employeeFormMessage').style.display = 'block';
        });

        // ŸÖÿ±ÿßŸÇÿ®ÿ© ÿ≠ÿßŸÑÿ© ÿßŸÑÿßÿ™ÿµÿßŸÑ ÿ®ŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™
        function monitorConnection() {
            const connectedRef = firebase.database().ref(".info/connected");
            connectedRef.on("value", function(snap) {
                if (snap.val() === true) {
                    isConnected = true;
                    connectionRetryCount = 0;
                    connectionStatus.textContent = "‚úì ŸÖÿ™ÿµŸÑ ÿ®ŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿ≥ÿ≠ÿßÿ®Ÿäÿ©";
                    connectionStatus.className = "connection-status connection-online";
                    connectionStatus.style.display = "block";
                    
                    if (!isConnected) {
                        loadAllData();
                    }
                } else {
                    isConnected = false;
                    connectionStatus.textContent = "‚úó ÿ∫Ÿäÿ± ŸÖÿ™ÿµŸÑ ÿ®ŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿ≥ÿ≠ÿßÿ®Ÿäÿ©";
                    connectionStatus.className = "connection-status connection-offline";
                    connectionStatus.style.display = "block";
                    
                    if (connectionRetryCount < maxRetries) {
                        connectionRetryCount++;
                        setTimeout(() => {
                            if (!isConnected) {
                                monitorConnection();
                            }
                        }, 5000);
                    }
                }
            });
        }

        // ÿ™ÿ≠ŸÖŸäŸÑ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ŸÖŸÜ Firebase
        function loadAllData() {
            showLoadingState(true);
            
            Promise.all([
                loadData('employees'),
                loadData('attendance'),
                loadData('leaves'),
                loadData('financials'),
                loadData('employeeDatabase'),
                loadData('cashTransactions'), // ÿ™ÿ≠ŸÖŸäŸÑ ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿπŸáÿØÿ©
                loadData('stations'),
                loadData('supervisors'),
                loadData('faults')
            ]).then(() => {
                showLoadingState(false);
                updateEmployeesDropdowns();
                updateDatabaseEmployeesDropdown();
                updateStationDropdowns();
                updateSupervisorDropdowns();
                updateCashSupervisorDropdowns(); // ÿ™ÿ≠ÿØŸäÿ´ ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑŸÖÿ≥ÿ§ŸàŸÑŸäŸÜ ŸÅŸä ŸÜŸÖÿßÿ∞ÿ¨ ÿßŸÑÿπŸáÿØÿ©
                updateDashboard();
                updateCashStats(); // ÿ™ÿ≠ÿØŸäÿ´ ÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™ ÿßŸÑÿπŸáÿØÿ©
                displayEmployeesList();
                displayEmployeeDatabase();
                displayAttendanceList();
                displayLeavesList();
                displayFinancialsList();
                displayCashTransactions(); // ÿπÿ±ÿ∂ ÿ≠ÿ±ŸÉÿßÿ™ ÿßŸÑÿπŸáÿØÿ©
                updateCashSummary(); // ÿ™ÿ≠ÿØŸäÿ´ ŸÖŸÑÿÆÿµ ÿßŸÑÿπŸáÿØÿ©
                displayStationsList();
                displaySupervisorsList();
                displayFaultsList();
                displayRecentCashTransactions(); // ÿπÿ±ÿ∂ ÿ¢ÿÆÿ± ÿ≠ÿ±ŸÉÿßÿ™ ÿßŸÑÿπŸáÿØÿ© ŸÅŸä ŸÑŸàÿ≠ÿ© ÿßŸÑÿ™ÿ≠ŸÉŸÖ
                
                connectionStatus.textContent = "‚úì ÿ™ŸÖ ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿ®ŸÜÿ¨ÿßÿ≠ ŸÖŸÜ ÿßŸÑÿ≥ÿ≠ÿßÿ®ÿ©";
                connectionStatus.className = "connection-status connection-online";
                connectionStatus.style.display = "block";
                setTimeout(() => {
                    connectionStatus.style.display = "none";
                }, 3000);
            }).catch(error => {
                console.error('ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ŸÖŸÜ Firebase:', error);
                showLoadingState(false);
                
                connectionStatus.textContent = "‚úó ŸÅÿ¥ŸÑ ÿßŸÑÿßÿ™ÿµÿßŸÑ ÿ®ŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿ≥ÿ≠ÿßÿ®Ÿäÿ©";
                connectionStatus.className = "connection-status connection-offline";
                connectionStatus.style.display = "block";
                
                showErrorMessage('ŸÅÿ¥ŸÑ ÿßŸÑÿßÿ™ÿµÿßŸÑ ÿ®ŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿ≥ÿ≠ÿßÿ®Ÿäÿ©. Ÿäÿ±ÿ¨Ÿâ ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿßÿ™ÿµÿßŸÑ ÿßŸÑÿ•ŸÜÿ™ÿ±ŸÜÿ™ ŸàÿßŸÑŸÖÿ≠ÿßŸàŸÑÿ© ŸÖÿ±ÿ© ÿ£ÿÆÿ±Ÿâ.');
            });
        }

        // ÿ™ÿ≠ŸÖŸäŸÑ ÿ®ŸäÿßŸÜÿßÿ™ ŸÖÿ≠ÿØÿØÿ© ŸÖŸÜ Firebase
        function loadData(dataType) {
            return new Promise((resolve, reject) => {
                database.ref(dataType).once('value')
                    .then((snapshot) => {
                        const data = snapshot.val();
                        
                        if (data) {
                            const dataArray = Object.keys(data).map(key => {
                                return { id: key, ...data[key] };
                            });
                            
                            if (dataType === 'employees') employees = dataArray;
                            else if (dataType === 'attendance') attendance = dataArray;
                            else if (dataType === 'leaves') leaves = dataArray;
                            else if (dataType === 'financials') financials = dataArray;
                            else if (dataType === 'employeeDatabase') employeeDatabase = dataArray;
                            else if (dataType === 'cashTransactions') cashTransactions = dataArray;
                            else if (dataType === 'stations') stations = dataArray;
                            else if (dataType === 'supervisors') supervisors = dataArray;
                            else if (dataType === 'faults') faults = dataArray;
                        } else {
                            if (dataType === 'employees') employees = [];
                            else if (dataType === 'attendance') attendance = [];
                            else if (dataType === 'leaves') leaves = [];
                            else if (dataType === 'financials') financials = [];
                            else if (dataType === 'employeeDatabase') employeeDatabase = [];
                            else if (dataType === 'cashTransactions') cashTransactions = [];
                            else if (dataType === 'stations') stations = [];
                            else if (dataType === 'supervisors') supervisors = [];
                            else if (dataType === 'faults') faults = [];
                        }
                        
                        resolve();
                    })
                    .catch((error) => {
                        console.error(`ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ≠ŸÖŸäŸÑ ${dataType}:`, error);
                        reject(error);
                    });
            });
        }

        // ÿ≠ŸÅÿ∏ ÿ®ŸäÿßŸÜÿßÿ™ ÿ•ŸÑŸâ Firebase
        function saveData(dataType, data) {
            return new Promise((resolve, reject) => {
                let dataToSave = {};
                
                if (Array.isArray(data)) {
                    data.forEach(item => {
                        if (item.id) {
                            const { id, ...itemData } = item;
                            dataToSave[id] = itemData;
                        } else {
                            const newId = Date.now().toString();
                            dataToSave[newId] = item;
                        }
                    });
                } else {
                    dataToSave = data;
                }
                
                database.ref(dataType).set(dataToSave)
                    .then(() => {
                        resolve();
                    })
                    .catch((error) => {
                        console.error(`ÿÆÿ∑ÿ£ ŸÅŸä ÿ≠ŸÅÿ∏ ${dataType} ŸÅŸä Firebase:`, error);
                        reject(error);
                    });
            });
        }

        // ÿ•ÿ∂ÿßŸÅÿ© ÿ®ŸäÿßŸÜÿßÿ™ ÿ•ŸÑŸâ Firebase
        function addData(dataType, newItem) {
            return new Promise((resolve, reject) => {
                const newId = Date.now().toString() + Math.random().toString(36).substr(2, 5);
                const itemWithId = { id: newId, ...newItem };
                
                database.ref(`${dataType}/${newId}`).set(newItem)
                    .then(() => {
                        // ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÖÿµŸÅŸàŸÅÿ© ÿßŸÑŸÖÿ≠ŸÑŸäÿ©
                        if (dataType === 'employees') employees.push(itemWithId);
                        else if (dataType === 'attendance') attendance.push(itemWithId);
                        else if (dataType === 'leaves') leaves.push(itemWithId);
                        else if (dataType === 'financials') financials.push(itemWithId);
                        else if (dataType === 'employeeDatabase') employeeDatabase.push(itemWithId);
                        else if (dataType === 'cashTransactions') cashTransactions.push(itemWithId);
                        else if (dataType === 'stations') stations.push(itemWithId);
                        else if (dataType === 'supervisors') supervisors.push(itemWithId);
                        else if (dataType === 'faults') faults.push(itemWithId);
                        
                        resolve(itemWithId);
                    })
                    .catch((error) => {
                        console.error(`ÿÆÿ∑ÿ£ ŸÅŸä ÿ•ÿ∂ÿßŸÅÿ© ${dataType} ÿ•ŸÑŸâ Firebase:`, error);
                        reject(error);
                    });
            });
        }

        // ÿ™ÿ≠ÿØŸäÿ´ ÿ®ŸäÿßŸÜÿßÿ™ ŸÅŸä Firebase
        function updateData(dataType, id, updatedData) {
            return new Promise((resolve, reject) => {
                database.ref(`${dataType}/${id}`).update(updatedData)
                    .then(() => {
                        let itemIndex;
                        if (dataType === 'employees') {
                            itemIndex = employees.findIndex(item => item.id === id);
                            if (itemIndex !== -1) employees[itemIndex] = { ...employees[itemIndex], ...updatedData };
                        } else if (dataType === 'attendance') {
                            itemIndex = attendance.findIndex(item => item.id === id);
                            if (itemIndex !== -1) attendance[itemIndex] = { ...attendance[itemIndex], ...updatedData };
                        } else if (dataType === 'leaves') {
                            itemIndex = leaves.findIndex(item => item.id === id);
                            if (itemIndex !== -1) leaves[itemIndex] = { ...leaves[itemIndex], ...updatedData };
                        } else if (dataType === 'financials') {
                            itemIndex = financials.findIndex(item => item.id === id);
                            if (itemIndex !== -1) financials[itemIndex] = { ...financials[itemIndex], ...updatedData };
                        } else if (dataType === 'employeeDatabase') {
                            itemIndex = employeeDatabase.findIndex(item => item.id === id);
                            if (itemIndex !== -1) employeeDatabase[itemIndex] = { ...employeeDatabase[itemIndex], ...updatedData };
                        } else if (dataType === 'cashTransactions') {
                            itemIndex = cashTransactions.findIndex(item => item.id === id);
                            if (itemIndex !== -1) cashTransactions[itemIndex] = { ...cashTransactions[itemIndex], ...updatedData };
                        } else if (dataType === 'stations') {
                            itemIndex = stations.findIndex(item => item.id === id);
                            if (itemIndex !== -1) stations[itemIndex] = { ...stations[itemIndex], ...updatedData };
                        } else if (dataType === 'supervisors') {
                            itemIndex = supervisors.findIndex(item => item.id === id);
                            if (itemIndex !== -1) supervisors[itemIndex] = { ...supervisors[itemIndex], ...updatedData };
                        } else if (dataType === 'faults') {
                            itemIndex = faults.findIndex(item => item.id === id);
                            if (itemIndex !== -1) faults[itemIndex] = { ...faults[itemIndex], ...updatedData };
                        }
                        
                        resolve();
                    })
                    .catch((error) => {
                        console.error(`ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ≠ÿØŸäÿ´ ${dataType} ŸÅŸä Firebase:`, error);
                        reject(error);
                    });
            });
        }

        // ÿ≠ÿ∞ŸÅ ÿ®ŸäÿßŸÜÿßÿ™ ŸÖŸÜ Firebase
        function deleteData(dataType, id) {
            return new Promise((resolve, reject) => {
                database.ref(`${dataType}/${id}`).remove()
                    .then(() => {
                        if (dataType === 'employees') employees = employees.filter(item => item.id !== id);
                        else if (dataType === 'attendance') attendance = attendance.filter(item => item.id !== id);
                        else if (dataType === 'leaves') leaves = leaves.filter(item => item.id !== id);
                        else if (dataType === 'financials') financials = financials.filter(item => item.id !== id);
                        else if (dataType === 'employeeDatabase') employeeDatabase = employeeDatabase.filter(item => item.id !== id);
                        else if (dataType === 'cashTransactions') cashTransactions = cashTransactions.filter(item => item.id !== id);
                        else if (dataType === 'stations') stations = stations.filter(item => item.id !== id);
                        else if (dataType === 'supervisors') supervisors = supervisors.filter(item => item.id !== id);
                        else if (dataType === 'faults') faults = faults.filter(item => item.id !== id);
                        
                        resolve();
                    })
                    .catch((error) => {
                        console.error(`ÿÆÿ∑ÿ£ ŸÅŸä ÿ≠ÿ∞ŸÅ ${dataType} ŸÖŸÜ Firebase:`, error);
                        reject(error);
                    });
            });
        }

        // ÿ•ÿ∏Ÿáÿßÿ± ÿ±ÿ≥ÿßŸÑÿ© ÿÆÿ∑ÿ£
        function showErrorMessage(message) {
            const errorDiv = document.createElement('div');
            errorDiv.className = 'error-container';
            errorDiv.innerHTML = `
                <i class="fas fa-exclamation-triangle" style="font-size: 3rem; color: var(--danger);"></i>
                <p style="margin: 15px 0;">${message}</p>
                <button class="retry-button" onclick="location.reload()">
                    <i class="fas fa-sync-alt"></i> ÿ•ÿπÿßÿØÿ© ÿßŸÑŸÖÿ≠ÿßŸàŸÑÿ©
                </button>
            `;
            
            const mainContent = document.querySelector('.main-content');
            mainContent.innerHTML = '';
            mainContent.appendChild(errorDiv);
        }

        // ÿ•ÿ∏Ÿáÿßÿ±/ÿ•ÿÆŸÅÿßÿ° ÿ≠ÿßŸÑÿ© ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ
        function showLoadingState(show) {
            const buttons = document.querySelectorAll('button[type="submit"]');
            
            if (show) {
                buttons.forEach(button => {
                    const textSpan = button.querySelector('span');
                    if (textSpan) {
                        textSpan.innerHTML = '<div class="loading"></div> ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ...';
                        button.disabled = true;
                    }
                });
                
                const autoAttendanceBtn = document.getElementById('autoAttendanceBtn');
                if (autoAttendanceBtn) {
                    autoAttendanceBtn.querySelector('span').innerHTML = '<div class="loading"></div> ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ™ÿ≥ÿ¨ŸäŸÑ...';
                    autoAttendanceBtn.disabled = true;
                }
                
                const generateReportBtn = document.getElementById('generateReport');
                if (generateReportBtn) {
                    generateReportBtn.querySelector('span').innerHTML = '<div class="loading"></div> ÿ¨ÿßÿ±Ÿä ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑÿ™ŸÇÿ±Ÿäÿ±...';
                    generateReportBtn.disabled = true;
                }
            } else {
                buttons.forEach(button => {
                    const textSpan = button.querySelector('span');
                    if (textSpan) {
                        if (button.closest('#employeeForm')) textSpan.textContent = 'ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑŸÖŸàÿ∏ŸÅ';
                        else if (button.closest('#employeeDatabaseForm')) textSpan.textContent = 'ÿ•ÿ∂ÿßŸÅÿ© ÿ•ŸÑŸâ ŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™';
                        else if (button.closest('#manualAttendanceForm')) textSpan.textContent = 'ÿ™ÿ≥ÿ¨ŸäŸÑ';
                        else if (button.closest('#leaveForm')) textSpan.textContent = 'ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿ•ÿ¨ÿßÿ≤ÿ©';
                        else if (button.closest('#financialForm')) textSpan.textContent = 'ÿ™ÿ≥ÿ¨ŸäŸÑ';
                        else if (button.closest('#cashDepositForm')) textSpan.innerHTML = '<i class="fas fa-plus-circle"></i> ÿ™ÿ≥ÿ¨ŸäŸÑ ÿ•ŸäÿØÿßÿπ';
                        else if (button.closest('#cashWithdrawalForm')) textSpan.innerHTML = '<i class="fas fa-minus-circle"></i> ÿ™ÿ≥ÿ¨ŸäŸÑ ÿµÿ±ŸÅ';
                        else if (button.closest('#faultForm')) textSpan.textContent = 'ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿπÿ∑ŸÑ';
                        else if (button.closest('#stationForm')) textSpan.textContent = 'ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑŸÖÿ≠ÿ∑ÿ©';
                        else if (button.closest('#supervisorForm')) textSpan.textContent = 'ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑŸÖÿ≥ÿ§ŸàŸÑ';
                        button.disabled = false;
                    }
                });
                
                const autoAttendanceBtn = document.getElementById('autoAttendanceBtn');
                if (autoAttendanceBtn) {
                    autoAttendanceBtn.querySelector('span').textContent = 'ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿ≠ÿ∂Ÿàÿ± ÿßŸÑÿ™ŸÑŸÇÿßÿ¶Ÿä';
                    autoAttendanceBtn.disabled = false;
                }
                
                const generateReportBtn = document.getElementById('generateReport');
                if (generateReportBtn) {
                    generateReportBtn.querySelector('span').textContent = 'ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑÿ™ŸÇÿ±Ÿäÿ±';
                    generateReportBtn.disabled = false;
                }
            }
        }

        // ÿ•ŸÜÿ¥ÿßÿ° ŸÉŸÑŸÖÿ© ÿ≥ÿ± ÿπÿ¥Ÿàÿßÿ¶Ÿäÿ©
        function generateRandomPassword() {
            const word1 = arabicWords[Math.floor(Math.random() * arabicWords.length)];
            const word2 = arabicWords[Math.floor(Math.random() * arabicWords.length)];
            const numbers = Math.floor(Math.random() * 900) + 100;
            
            return `${word1}_${word2}_${numbers}`;
        }

        // ÿ•ÿπÿØÿßÿØ ŸÖÿ≥ÿ™ŸÖÿπŸä ÿßŸÑÿ£ÿ≠ÿØÿßÿ´
        function setupEventListeners() {
            // ÿßŸÑŸÇÿßÿ¶ŸÖÿ© ÿßŸÑÿ¨ÿßŸÜÿ®Ÿäÿ©
            menuBtn.addEventListener('click', toggleSideMenu);
            closeMenu.addEventListener('click', toggleSideMenu);
            overlay.addEventListener('click', toggleSideMenu);
            
            // ÿ£ÿ≤ÿ±ÿßÿ± ÿßŸÑÿ™ÿµÿØŸäÿ±
            exportBtn.addEventListener('click', exportAllData);
            document.getElementById('exportEmployees').addEventListener('click', exportEmployeesToExcel);
            document.getElementById('exportEmployeeDatabase').addEventListener('click', exportEmployeeDatabaseToExcel);
            document.getElementById('exportAttendance').addEventListener('click', exportAttendanceToExcel);
            document.getElementById('exportLeaves').addEventListener('click', exportLeavesToExcel);
            document.getElementById('exportFinancials').addEventListener('click', exportFinancialsToExcel);
            document.getElementById('exportReport').addEventListener('click', exportReportToExcel);
            document.getElementById('exportCashTransactions').addEventListener('click', exportCashToExcel);
            document.getElementById('exportFaults').addEventListener('click', exportFaultsToExcel);
            document.getElementById('exportStations').addEventListener('click', exportStationsToExcel);
            document.getElementById('exportSupervisors').addEventListener('click', exportSupervisorsToExcel);
            
            // ÿßŸÑÿ™ŸÜŸÇŸÑ ÿ®ŸäŸÜ ÿßŸÑÿµŸÅÿ≠ÿßÿ™
            document.querySelectorAll('.nav-item, .nav-item-attendance, .quick-action, .see-all, .menu-link').forEach(item => {
                item.addEventListener('click', function(e) {
                    e.preventDefault();
                    const target = this.getAttribute('data-target');
                    
                    if (target) {
                        showPage(target);
                        
                        if (this.classList.contains('nav-item') || this.classList.contains('nav-item-attendance')) {
                            document.querySelectorAll('.nav-item').forEach(nav => nav.classList.remove('active'));
                            document.querySelectorAll('.nav-item-attendance').forEach(nav => nav.classList.remove('active'));
                            this.classList.add('active');
                        }
                        
                        if (this.classList.contains('menu-link')) {
                            document.querySelectorAll('.menu-link').forEach(link => link.classList.remove('active'));
                            this.classList.add('active');
                            toggleSideMenu();
                            updateBottomNavFromSidebar(target);
                        }
                    }
                });
            });
            
            // ÿ•ÿ∏Ÿáÿßÿ±/ÿ•ÿÆŸÅÿßÿ° ŸÜŸÖŸàÿ∞ÿ¨ ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑŸÖŸàÿ∏ŸÅ
            document.getElementById('showAddForm').addEventListener('click', function() {
                const form = document.getElementById('employeeForm');
                const message = document.getElementById('employeeFormMessage');
                
                if (form.classList.contains('hidden')) {
                    form.classList.remove('hidden');
                    message.style.display = 'none';
                    this.textContent = 'ÿ•ÿÆŸÅÿßÿ° ÿßŸÑŸÜŸÖŸàÿ∞ÿ¨';
                } else {
                    form.classList.add('hidden');
                    message.style.display = 'block';
                    this.textContent = 'ÿ•ÿ∏Ÿáÿßÿ± ÿßŸÑŸÜŸÖŸàÿ∞ÿ¨';
                }
            });
            
            // ŸÜŸÖÿßÿ∞ÿ¨ ÿßŸÑÿ•ÿ∂ÿßŸÅÿ©
            document.getElementById('employeeForm').addEventListener('submit', function(e) {
                e.preventDefault();
                addEmployee();
            });
            
            document.getElementById('employeeDatabaseForm').addEventListener('submit', function(e) {
                e.preventDefault();
                addEmployeeToDatabase();
            });
            
            document.getElementById('manualAttendanceForm').addEventListener('submit', function(e) {
                e.preventDefault();
                recordManualAttendance();
            });
            
            document.getElementById('leaveForm').addEventListener('submit', function(e) {
                e.preventDefault();
                addLeave();
            });
            
            document.getElementById('financialForm').addEventListener('submit', function(e) {
                e.preventDefault();
                addFinancial();
            });
            
            document.getElementById('faultForm').addEventListener('submit', function(e) {
                e.preventDefault();
                addFault();
            });
            
            document.getElementById('stationForm').addEventListener('submit', function(e) {
                e.preventDefault();
                addStation();
            });
            
            document.getElementById('supervisorForm').addEventListener('submit', function(e) {
                e.preventDefault();
                addSupervisor();
            });
            
            // ŸÜŸÖÿßÿ∞ÿ¨ ÿßŸÑÿπŸáÿØÿ©
            document.getElementById('cashDepositForm').addEventListener('submit', function(e) {
                e.preventDefault();
                addCashDeposit();
            });
            
            document.getElementById('cashWithdrawalForm').addEventListener('submit', function(e) {
                e.preventDefault();
                addCashWithdrawal();
            });
            
            // ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿµÿ≠ÿ© ÿßŸÑŸÖÿØÿÆŸÑÿßÿ™
            document.getElementById('empName').addEventListener('blur', function() {
                checkEmployeeDuplicate(this.value, 'empNameError');
            });
            
            document.getElementById('empPhone').addEventListener('blur', function() {
                checkPhoneDuplicate(this.value, 'empPhoneError');
            });
            
            document.getElementById('dbEmpName').addEventListener('blur', function() {
                checkEmployeeDatabaseDuplicate(this.value, 'dbEmpNameError');
            });
            
            document.getElementById('dbEmpPhone').addEventListener('blur', function() {
                checkPhoneDatabaseDuplicate(this.value, 'dbEmpPhoneError');
            });
            
            document.getElementById('cashDepositAmount').addEventListener('blur', function() {
                validateAmount(this.value, 'cashDepositAmountError');
            });
            
            document.getElementById('cashWithdrawalAmount').addEventListener('blur', function() {
                validateAmount(this.value, 'cashWithdrawalAmountError');
            });
            
            // ÿ™ŸàŸÑŸäÿØ ŸÉŸÑŸÖÿ© ÿ≥ÿ± ÿπÿ¥Ÿàÿßÿ¶Ÿäÿ©
            document.getElementById('generatePasswordBtn').addEventListener('click', function() {
                const passwordField = document.getElementById('supervisorPassword');
                passwordField.value = generateRandomPassword();
            });
            
            // ÿ£ÿ≤ÿ±ÿßÿ± ÿßŸÑŸÅŸÑÿ™ÿ±ÿ©
            document.getElementById('generateReport').addEventListener('click', function() {
                generateSalaryReport();
            });
            
            document.getElementById('applyAttendanceFilter').addEventListener('click', function() {
                displayAttendanceList();
            });
            
            document.getElementById('applyLeaveFilter').addEventListener('click', function() {
                displayLeavesList();
            });
            
            document.getElementById('resetLeaveFilter').addEventListener('click', function() {
                const today = new Date().toISOString().split('T')[0];
                document.getElementById('leaveFilterStartDate').value = today;
                document.getElementById('leaveFilterEndDate').value = today;
                document.getElementById('filterLeaveStation').value = '';
                displayLeavesList();
            });
            
            document.getElementById('applyFinancialFilter').addEventListener('click', function() {
                displayFinancialsList();
            });
            
            document.getElementById('applyFaultFilter').addEventListener('click', function() {
                displayFaultsList();
            });
            
            document.getElementById('resetFaultFilter').addEventListener('click', function() {
                const today = new Date().toISOString().split('T')[0];
                document.getElementById('filterFaultStartDate').value = today;
                document.getElementById('filterFaultEndDate').value = today;
                document.getElementById('filterFaultStation').value = '';
                document.getElementById('filterFaultStatus').value = '';
                displayFaultsList();
            });
            
            // ŸÅŸÑÿ™ÿ±ÿ© ÿßŸÑÿπŸáÿØÿ©
            document.getElementById('filterCashBtn').addEventListener('click', function() {
                displayCashTransactions();
            });
            
            document.getElementById('filterCashType').addEventListener('change', function() {
                displayCashTransactions();
            });
            
            document.getElementById('filterCashSupervisor').addEventListener('change', function() {
                displayCashTransactions();
            });
            
            // ÿ™ŸÅÿπŸäŸÑ ÿ™ÿ®ŸàŸäÿ®ÿßÿ™ ÿßŸÑÿπŸáÿØÿ©
            document.querySelectorAll('.cash-tab[data-tab]').forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabId = this.getAttribute('data-tab');
                    
                    document.querySelectorAll('.cash-tab').forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.cash-tab-content').forEach(c => c.classList.remove('active'));
                    
                    this.classList.add('active');
                    document.getElementById(tabId).classList.add('active');
                });
            });
            
            // ÿ®ÿ≠ÿ´ ŸÅŸä ŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™
            document.getElementById('searchEmployee').addEventListener('input', function() {
                displayEmployeeDatabase();
            });
            
            // ŸÅŸÑÿ™ÿ± ŸÑŸàÿ≠ÿ© ÿßŸÑÿ™ÿ≠ŸÉŸÖ
            document.getElementById('dashboardStationFilter').addEventListener('change', function() {
                updateDashboard();
            });
            
            // ÿ™ŸÇÿ±Ÿäÿ± ÿßŸÑŸÖŸàÿ∏ŸÅ
            document.getElementById('generateEmployeeReportBtn').addEventListener('click', generateEmployeeReport);
            
            // ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿ≠ÿ∂Ÿàÿ± ÿßŸÑÿ™ŸÑŸÇÿßÿ¶Ÿä
            document.getElementById('autoAttendanceBtn').addEventListener('click', function() {
                recordAutoAttendance();
            });
            
            // ÿßÿ≥ÿ™Ÿäÿ±ÿßÿØ ŸÖŸÜ ŸÖŸÑŸÅ
            document.getElementById('downloadTemplateBtn').addEventListener('click', downloadTemplate);
            document.getElementById('previewImportBtn').addEventListener('click', previewImport);
            document.getElementById('importEmployeesBtn').addEventListener('click', importEmployees);
            document.getElementById('importFromDatabaseBtn').addEventListener('click', importFromDatabase);
            
            // ÿßÿ≥ÿ™Ÿäÿ±ÿßÿØ ÿ¨Ÿáÿßÿ™ ÿßŸÑÿßÿ™ÿµÿßŸÑ
            document.getElementById('importContactsBtn').addEventListener('click', importContacts);
            document.getElementById('selectAllContacts').addEventListener('click', selectAllContacts);
            document.getElementById('deselectAllContacts').addEventListener('click', deselectAllContacts);
            document.getElementById('addSelectedContactsBtn').addEventListener('click', addSelectedContacts);
            
            // ÿßŸÑŸÜÿ≥ÿÆ ÿßŸÑÿßÿ≠ÿ™Ÿäÿßÿ∑Ÿä
            document.getElementById('downloadBackupBtn').addEventListener('click', downloadBackup);
            document.getElementById('restoreBackupBtn').addEventListener('click', restoreBackup);
            document.getElementById('deleteAllDataBtn').addEventListener('click', deleteAllData);
            document.getElementById('deleteSelectiveDataBtn').addEventListener('click', deleteSelectiveData);
            
            // ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿÆÿ±Ÿàÿ¨
            document.getElementById('logoutBtn').addEventListener('click', function(e) {
                e.preventDefault();
                if (confirm('ŸáŸÑ ÿ™ÿ±ŸäÿØ ÿ≠ŸÇŸãÿß ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿÆÿ±Ÿàÿ¨ÿü')) {
                    alert('ÿ™ŸÖ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿÆÿ±Ÿàÿ¨ ÿ®ŸÜÿ¨ÿßÿ≠');
                }
            });
            
            // ÿ≠ŸÅÿ∏ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™
            document.getElementById('saveSettingsBtn').addEventListener('click', function() {
                alert('ÿ™ŸÖ ÿ≠ŸÅÿ∏ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™ ÿ®ŸÜÿ¨ÿßÿ≠');
            });
        }

        // ÿ™ÿ≠ÿØŸäÿ´ ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑŸÖÿ≥ÿ§ŸàŸÑŸäŸÜ ŸÅŸä ŸÜŸÖÿßÿ∞ÿ¨ ÿßŸÑÿπŸáÿØÿ©
        function updateCashSupervisorDropdowns() {
            const dropdowns = [
                'cashDepositSupervisor',
                'cashWithdrawalSupervisor',
                'filterCashSupervisor'
            ];
            
            dropdowns.forEach(dropdownId => {
                const dropdown = document.getElementById(dropdownId);
                if (!dropdown) return;
                
                dropdown.innerHTML = '<option value="">ÿßÿÆÿ™ÿ± ÿßŸÑŸÖÿ≥ÿ§ŸàŸÑ</option>';
                
                supervisors.forEach(sup => {
                    if (sup.active) {
                        const option = document.createElement('option');
                        option.value = sup.id;
                        option.textContent = sup.employeeName;
                        dropdown.appendChild(option);
                    }
                });
                
                if (dropdownId === 'filterCashSupervisor') {
                    const allOption = document.createElement('option');
                    allOption.value = '';
                    allOption.textContent = 'ÿ¨ŸÖŸäÿπ ÿßŸÑŸÖÿ≥ÿ§ŸàŸÑŸäŸÜ';
                    dropdown.prepend(allOption);
                }
            });
        }

        // ÿ™ÿ≠ÿØŸäÿ´ ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑŸÖÿ≠ÿ∑ÿßÿ™
        function updateStationDropdowns() {
            const dropdowns = [
                'attendanceStation',
                'leaveStation',
                'financialStation',
                'faultStation',
                'filterAttendanceStation',
                'filterLeaveStation',
                'filterFinancialStation',
                'filterFaultStation',
                'dashboardStationFilter',
                'cashDepositStation',
                'cashWithdrawalStation'
            ];
            
            dropdowns.forEach(dropdownId => {
                const dropdown = document.getElementById(dropdownId);
                if (!dropdown) return;
                
                dropdown.innerHTML = '<option value="">ÿßÿÆÿ™ÿ± ÿßŸÑŸÖÿ≠ÿ∑ÿ©</option>';
                
                stations.forEach(station => {
                    const option = document.createElement('option');
                    option.value = station.name;
                    option.textContent = station.name;
                    dropdown.appendChild(option);
                });
                
                if (dropdownId.includes('filter') || dropdownId === 'dashboardStationFilter') {
                    const allOption = document.createElement('option');
                    allOption.value = '';
                    allOption.textContent = 'ÿ¨ŸÖŸäÿπ ÿßŸÑŸÖÿ≠ÿ∑ÿßÿ™';
                    dropdown.prepend(allOption);
                }
            });
        }

        // ÿ™ÿ≠ÿØŸäÿ´ ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑŸÖÿ≥ÿ§ŸàŸÑŸäŸÜ
        function updateSupervisorDropdowns() {
            const dropdowns = [
                'attendanceSupervisor',
                'leaveSupervisor',
                'financialSupervisor',
                'faultSupervisor',
                'cashDepositSupervisor',
                'cashWithdrawalSupervisor'
            ];
            
            dropdowns.forEach(dropdownId => {
                const dropdown = document.getElementById(dropdownId);
                if (!dropdown) return;
                
                dropdown.innerHTML = '<option value="">ÿßÿÆÿ™ÿ± ÿßŸÑŸÖÿ≥ÿ§ŸàŸÑ</option>';
                
                supervisors.forEach(sup => {
                    if (sup.active) {
                        const option = document.createElement('option');
                        option.value = sup.id;
                        option.textContent = sup.employeeName;
                        dropdown.appendChild(option);
                    }
                });
            });
            
            // ÿ™ÿ≠ÿØŸäÿ´ ŸÅŸÑÿ™ÿ± ÿßŸÑŸÖÿ≥ÿ§ŸàŸÑŸäŸÜ ŸÅŸä ÿßŸÑÿπŸáÿØÿ©
            const filterDropdown = document.getElementById('filterCashSupervisor');
            if (filterDropdown) {
                filterDropdown.innerHTML = '<option value="">ÿ¨ŸÖŸäÿπ ÿßŸÑŸÖÿ≥ÿ§ŸàŸÑŸäŸÜ</option>';
                supervisors.forEach(sup => {
                    if (sup.active) {
                        const option = document.createElement('option');
                        option.value = sup.id;
                        option.textContent = sup.employeeName;
                        filterDropdown.appendChild(option);
                    }
                });
            }
        }

        // ÿ™ÿ≠ÿØŸäÿ´ ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑŸÖŸàÿ∏ŸÅŸäŸÜ
        function updateEmployeesDropdowns() {
            const dropdowns = [
                'attendanceEmployee',
                'leaveEmployee',
                'financialEmployee',
                'selectEmployeeForReport',
                'filterFinancialEmployee'
            ];
            
            dropdowns.forEach(dropdownId => {
                const dropdown = document.getElementById(dropdownId);
                if (!dropdown) return;
                
                dropdown.innerHTML = '<option value="">ÿßÿÆÿ™ÿ± ÿßŸÑŸÖŸàÿ∏ŸÅ</option>';
                
                employees.forEach(emp => {
                    if (emp.active) {
                        const option = document.createElement('option');
                        option.value = emp.name;
                        option.textContent = emp.name;
                        dropdown.appendChild(option);
                    }
                });
            });
        }

        // ÿ™ÿ≠ÿØŸäÿ´ ŸÇÿßÿ¶ŸÖÿ© ŸÖŸàÿ∏ŸÅŸä ŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™
        function updateDatabaseEmployeesDropdown() {
            const dropdown = document.getElementById('selectMultipleEmployees');
            if (!dropdown) return;
            
            dropdown.innerHTML = '';
            
            const inactiveEmployees = employeeDatabase.filter(emp => !emp.active);
            
            if (inactiveEmployees.length === 0) {
                const option = document.createElement('option');
                option.textContent = 'ŸÑÿß ŸäŸàÿ¨ÿØ ŸÖŸàÿ∏ŸÅŸäŸÜ ŸÖÿ™ÿßÿ≠ŸäŸÜ ŸÑŸÑÿ•ÿ∂ÿßŸÅÿ©';
                option.disabled = true;
                dropdown.appendChild(option);
                return;
            }
            
            inactiveEmployees.forEach(emp => {
                const option = document.createElement('option');
                option.value = emp.id;
                option.textContent = `${emp.name} - ${emp.phone}`;
                dropdown.appendChild(option);
            });
            
            updateSupervisorEmployeesDropdown();
        }

        // ÿ™ÿ≠ÿØŸäÿ´ ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑŸÖŸàÿ∏ŸÅŸäŸÜ ŸÑŸÑŸÖÿ≥ÿ§ŸàŸÑŸäŸÜ
        function updateSupervisorEmployeesDropdown() {
            const dropdown = document.getElementById('supervisorEmployee');
            if (!dropdown) return;
            
            dropdown.innerHTML = '<option value="">ÿßÿÆÿ™ÿ± ÿßŸÑŸÖŸàÿ∏ŸÅ</option>';
            
            employeeDatabase.forEach(emp => {
                const isAlreadySupervisor = supervisors.some(sup => sup.employeeId === emp.id);
                if (!isAlreadySupervisor) {
                    const option = document.createElement('option');
                    option.value = emp.id;
                    option.textContent = `${emp.name} - ${emp.phone}`;
                    dropdown.appendChild(option);
                }
            });
        }

        // ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ™ŸÜŸÇŸÑ ÿßŸÑÿ≥ŸÅŸÑŸä ÿ®ŸÜÿßÿ°Ÿã ÿπŸÑŸâ ÿßŸÑÿµŸÅÿ≠ÿ© ÿßŸÑŸÖÿ≠ÿØÿØÿ©
        function updateBottomNavFromSidebar(targetPage) {
            document.querySelectorAll('.nav-item, .nav-item-attendance').forEach(nav => nav.classList.remove('active'));
            
            if (targetPage === 'dashboard') {
                document.querySelector('.nav-item[data-target="dashboard"]').classList.add('active');
            } else if (targetPage === 'employees') {
                document.querySelector('.nav-item[data-target="employees"]').classList.add('active');
            } else if (targetPage === 'attendance') {
                document.querySelector('.nav-item-attendance[data-target="attendance"]').classList.add('active');
            } else if (targetPage === 'faults') {
                document.querySelector('.nav-item[data-target="faults"]').classList.add('active');
            } else if (targetPage === 'stations') {
                document.querySelector('.nav-item[data-target="stations"]').classList.add('active');
            }
        }

        // ÿπÿ±ÿ∂ ÿßŸÑÿµŸÅÿ≠ÿ© ÿßŸÑŸÖÿ≠ÿØÿØÿ©
        function showPage(pageId) {
            document.querySelectorAll('.tab-content').forEach(page => {
                page.classList.remove('active');
            });
            document.getElementById(pageId).classList.add('active');
            
            const pageTitles = {
                'dashboard': 'ŸÑŸàÿ≠ÿ© ÿßŸÑÿ™ÿ≠ŸÉŸÖ',
                'employees': 'ÿ•ÿØÿßÿ±ÿ© ÿßŸÑŸÖŸàÿ∏ŸÅŸäŸÜ',
                'employee-database': 'ŸÇÿßÿπÿØÿ© ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸÖŸàÿ∏ŸÅŸäŸÜ',
                'attendance': 'ÿßŸÑÿ≠ÿ∂Ÿàÿ± ŸàÿßŸÑÿ∫Ÿäÿßÿ®',
                'leaves': 'ÿ•ÿØÿßÿ±ÿ© ÿßŸÑÿ•ÿ¨ÿßÿ≤ÿßÿ™',
                'employee-records': 'ÿ≥ÿ¨ŸÑ ÿßŸÑŸÖŸàÿ∏ŸÅŸäŸÜ',
                'financial': 'ÿßŸÑÿ≥ŸÑŸÅ ŸàÿßŸÑŸÖŸÉÿßŸÅÿ¢ÿ™',
                'reports': 'ÿ™ŸÇÿßÿ±Ÿäÿ± ÿßŸÑŸÖÿ±ÿ™ÿ®ÿßÿ™',
                'cash': 'ÿ•ÿØÿßÿ±ÿ© ÿßŸÑÿπŸáÿØÿ©',
                'faults': 'ÿ≥ÿ¨ŸÑ ÿßŸÑÿ£ÿπÿ∑ÿßŸÑ',
                'stations': 'ÿ•ÿØÿßÿ±ÿ© ÿßŸÑŸÖÿ≠ÿ∑ÿßÿ™',
                'supervisors': 'ÿ•ÿØÿßÿ±ÿ© ÿßŸÑŸÖÿ≥ÿ§ŸàŸÑŸäŸÜ',
                'settings': 'ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™',
                'backup': 'ÿßŸÑŸÜÿ≥ÿÆ ÿßŸÑÿßÿ≠ÿ™Ÿäÿßÿ∑Ÿä'
            };
            document.getElementById('pageTitle').textContent = pageTitles[pageId];
            
            // ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿπŸÜÿØ ŸÅÿ™ÿ≠ ÿßŸÑÿµŸÅÿ≠ÿ©
            if (pageId === 'dashboard') {
                updateDashboard();
                displayRecentCashTransactions();
            } else if (pageId === 'employees') {
                displayEmployeesList();
                updateDatabaseEmployeesDropdown();
            } else if (pageId === 'employee-database') {
                displayEmployeeDatabase();
            } else if (pageId === 'attendance') {
                displayAttendanceList();
            } else if (pageId === 'leaves') {
                displayLeavesList();
            } else if (pageId === 'employee-records') {
                updateEmployeesDropdowns();
                document.getElementById('employeeReportContainer').style.display = 'none';
            } else if (pageId === 'financial') {
                displayFinancialsList();
            } else if (pageId === 'reports') {
                generateSalaryReport();
            } else if (pageId === 'cash') {
                displayCashTransactions();
                updateCashSummary();
            } else if (pageId === 'faults') {
                displayFaultsList();
            } else if (pageId === 'stations') {
                displayStationsList();
            } else if (pageId === 'supervisors') {
                displaySupervisorsList();
                updateSupervisorEmployeesDropdown();
            }
        }

        // ÿ™ÿ®ÿØŸäŸÑ ÿßŸÑŸÇÿßÿ¶ŸÖÿ© ÿßŸÑÿ¨ÿßŸÜÿ®Ÿäÿ©
        function toggleSideMenu() {
            sideMenu.classList.toggle('active');
            overlay.classList.toggle('active');
        }

        // ==================== ÿØŸàÿßŸÑ ÿßŸÑÿπŸáÿØÿ© ====================

        // ÿ≠ÿ≥ÿßÿ® ÿßŸÑÿ±ÿµŸäÿØ ÿßŸÑÿ≠ÿßŸÑŸä ŸÑŸÑÿπŸáÿØÿ©
        function calculateCashBalance() {
            let balance = 0;
            cashTransactions.forEach(transaction => {
                if (transaction.type === 'ÿ•ŸäÿØÿßÿπ') {
                    balance += transaction.amount;
                } else if (transaction.type === 'ÿµÿ±ŸÅ') {
                    balance -= transaction.amount;
                }
            });
            return balance;
        }

        // ÿ≠ÿ≥ÿßÿ® ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑÿ•ŸäÿØÿßÿπÿßÿ™
        function calculateTotalDeposits() {
            return cashTransactions
                .filter(t => t.type === 'ÿ•ŸäÿØÿßÿπ')
                .reduce((sum, t) => sum + t.amount, 0);
        }

        // ÿ≠ÿ≥ÿßÿ® ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑŸÖÿµÿ±ŸàŸÅÿßÿ™
        function calculateTotalWithdrawals() {
            return cashTransactions
                .filter(t => t.type === 'ÿµÿ±ŸÅ')
                .reduce((sum, t) => sum + t.amount, 0);
        }

        // ÿ≠ÿ≥ÿßÿ® ÿ•ŸäÿØÿßÿπÿßÿ™ ÿßŸÑŸäŸàŸÖ
        function calculateTodayDeposits() {
            const today = new Date().toISOString().split('T')[0];
            return cashTransactions
                .filter(t => t.type === 'ÿ•ŸäÿØÿßÿπ' && t.date === today)
                .reduce((sum, t) => sum + t.amount, 0);
        }

        // ÿ≠ÿ≥ÿßÿ® ŸÖÿµÿ±ŸàŸÅÿßÿ™ ÿßŸÑŸäŸàŸÖ
        function calculateTodayWithdrawals() {
            const today = new Date().toISOString().split('T')[0];
            return cashTransactions
                .filter(t => t.type === 'ÿµÿ±ŸÅ' && t.date === today)
                .reduce((sum, t) => sum + t.amount, 0);
        }

        // ÿ™ÿ≠ÿØŸäÿ´ ÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™ ÿßŸÑÿπŸáÿØÿ© ŸÅŸä ŸÑŸàÿ≠ÿ© ÿßŸÑÿ™ÿ≠ŸÉŸÖ
        function updateCashStats() {
            const balance = calculateCashBalance();
            const totalDeposits = calculateTotalDeposits();
            const totalWithdrawals = calculateTotalWithdrawals();
            const todayDeposits = calculateTodayDeposits();
            const todayWithdrawals = calculateTodayWithdrawals();
            
            const balanceBox = document.getElementById('cashBalanceBox');
            if (balanceBox) {
                if (balance < 0) {
                    balanceBox.classList.add('negative-balance');
                } else {
                    balanceBox.classList.remove('negative-balance');
                }
            }
            
            document.getElementById('dashboardCashBalance').textContent = `${balance} ÿ¨.ŸÖ`;
            document.getElementById('dashboardTotalDeposits').textContent = `${totalDeposits} ÿ¨.ŸÖ`;
            document.getElementById('dashboardTotalWithdrawals').textContent = `${totalWithdrawals} ÿ¨.ŸÖ`;
            document.getElementById('dashboardTodayDeposits').textContent = `${todayDeposits} ÿ¨.ŸÖ`;
            document.getElementById('dashboardTodayWithdrawals').textContent = `${todayWithdrawals} ÿ¨.ŸÖ`;
        }

        // ÿ™ÿ≠ÿØŸäÿ´ ŸÖŸÑÿÆÿµ ÿßŸÑÿπŸáÿØÿ©
        function updateCashSummary() {
            const balance = calculateCashBalance();
            const balanceElement = document.getElementById('currentCashBalance');
            if (balanceElement) {
                balanceElement.textContent = `${balance} ÿ¨.ŸÖ`;
                if (balance < 0) {
                    balanceElement.classList.add('negative');
                } else {
                    balanceElement.classList.remove('negative');
                }
            }
            
            const totalDepositsElement = document.getElementById('totalDeposits');
            if (totalDepositsElement) {
                totalDepositsElement.textContent = `${calculateTotalDeposits()} ÿ¨.ŸÖ`;
            }
            
            const totalWithdrawalsElement = document.getElementById('totalWithdrawals');
            if (totalWithdrawalsElement) {
                totalWithdrawalsElement.textContent = `${calculateTotalWithdrawals()} ÿ¨.ŸÖ`;
            }
        }

        // ÿ•ÿ∂ÿßŸÅÿ© ÿ•ŸäÿØÿßÿπ ÿ¨ÿØŸäÿØ
        function addCashDeposit() {
            showLoadingState(true);
            
            const stationName = document.getElementById('cashDepositStation').value;
            const supervisorId = document.getElementById('cashDepositSupervisor').value;
            const amount = parseInt(document.getElementById('cashDepositAmount').value);
            const date = document.getElementById('cashDepositDate').value;
            const reason = document.getElementById('cashDepositReason').value;
            const notes = document.getElementById('cashDepositNotes').value;
            
            if (!supervisorId) {
                alert('Ÿäÿ±ÿ¨Ÿâ ÿßÿÆÿ™Ÿäÿßÿ± ÿßŸÑŸÖÿ≥ÿ§ŸàŸÑ');
                showLoadingState(false);
                return;
            }
            
            if (!amount || amount <= 0) {
                document.getElementById('cashDepositAmountError').style.display = 'block';
                showLoadingState(false);
                return;
            } else {
                document.getElementById('cashDepositAmountError').style.display = 'none';
            }
            
            if (!reason) {
                alert('Ÿäÿ±ÿ¨Ÿâ ÿ•ÿØÿÆÿßŸÑ ÿ≥ÿ®ÿ® ÿßŸÑÿ•ŸäÿØÿßÿπ');
                showLoadingState(false);
                return;
            }
            
            const supervisor = supervisors.find(sup => sup.id === supervisorId);
            
            const newTransaction = {
                type: 'ÿ•ŸäÿØÿßÿπ',
                stationName: stationName || '',
                supervisorId: supervisorId,
                supervisorName: supervisor ? supervisor.employeeName : 'ÿ∫Ÿäÿ± ŸÖÿπÿ±ŸàŸÅ',
                amount: amount,
                date: date,
                reason: reason,
                notes: notes || '',
                timestamp: new Date().toISOString()
            };
            
            addData('cashTransactions', newTransaction)
                .then(() => {
                    // ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ ÿßŸÑŸÜŸÖŸàÿ∞ÿ¨
                    document.getElementById('cashDepositForm').reset();
                    document.getElementById('cashDepositDate').value = new Date().toISOString().split('T')[0];
                    
                    showLoadingState(false);
                    alert('ÿ™ŸÖ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿ•ŸäÿØÿßÿπ ÿ®ŸÜÿ¨ÿßÿ≠');
                    
                    // ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™
                    loadAllData();
                })
                .catch(error => {
                    showLoadingState(false);
                    alert('ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ÿ£ÿ´ŸÜÿßÿ° ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿ•ŸäÿØÿßÿπ. Ÿäÿ±ÿ¨Ÿâ ÿßŸÑŸÖÿ≠ÿßŸàŸÑÿ© ŸÖÿ±ÿ© ÿ£ÿÆÿ±Ÿâ.');
                });
        }

        // ÿ•ÿ∂ÿßŸÅÿ© ÿµÿ±ŸÅ ÿ¨ÿØŸäÿØ (Ÿäÿ≥ŸÖÿ≠ ÿ®ÿßŸÑÿ≥ÿ≠ÿ® ÿ≠ÿ™Ÿâ ŸÖÿπ ÿ±ÿµŸäÿØ ÿ∫Ÿäÿ± ŸÉÿßŸÅŸç)
        function addCashWithdrawal() {
            showLoadingState(true);
            
            const stationName = document.getElementById('cashWithdrawalStation').value;
            const supervisorId = document.getElementById('cashWithdrawalSupervisor').value;
            const amount = parseInt(document.getElementById('cashWithdrawalAmount').value);
            const date = document.getElementById('cashWithdrawalDate').value;
            const reason = document.getElementById('cashWithdrawalReason').value;
            const recipient = document.getElementById('cashWithdrawalRecipient').value;
            const notes = document.getElementById('cashWithdrawalNotes').value;
            
            if (!supervisorId) {
                alert('Ÿäÿ±ÿ¨Ÿâ ÿßÿÆÿ™Ÿäÿßÿ± ÿßŸÑŸÖÿ≥ÿ§ŸàŸÑ');
                showLoadingState(false);
                return;
            }
            
            if (!amount || amount <= 0) {
                document.getElementById('cashWithdrawalAmountError').style.display = 'block';
                showLoadingState(false);
                return;
            } else {
                document.getElementById('cashWithdrawalAmountError').style.display = 'none';
            }
            
            if (!reason) {
                alert('Ÿäÿ±ÿ¨Ÿâ ÿ•ÿØÿÆÿßŸÑ ÿ≥ÿ®ÿ® ÿßŸÑÿµÿ±ŸÅ');
                showLoadingState(false);
                return;
            }
            
            if (!recipient) {
                alert('Ÿäÿ±ÿ¨Ÿâ ÿ•ÿØÿÆÿßŸÑ ÿßÿ≥ŸÖ ÿßŸÑŸÖÿ≥ÿ™ŸÑŸÖ');
                showLoadingState(false);
                return;
            }
            
            const supervisor = supervisors.find(sup => sup.id === supervisorId);
            
            const newTransaction = {
                type: 'ÿµÿ±ŸÅ',
                stationName: stationName || '',
                supervisorId: supervisorId,
                supervisorName: supervisor ? supervisor.employeeName : 'ÿ∫Ÿäÿ± ŸÖÿπÿ±ŸàŸÅ',
                amount: amount,
                date: date,
                reason: reason,
                recipient: recipient,
                notes: notes || '',
                timestamp: new Date().toISOString()
            };
            
            addData('cashTransactions', newTransaction)
                .then(() => {
                    // ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ ÿßŸÑŸÜŸÖŸàÿ∞ÿ¨
                    document.getElementById('cashWithdrawalForm').reset();
                    document.getElementById('cashWithdrawalDate').value = new Date().toISOString().split('T')[0];
                    
                    showLoadingState(false);
                    
                    // ÿ™ÿ≠ÿ∞Ÿäÿ± ÿ•ÿ∞ÿß ÿ£ÿµÿ®ÿ≠ ÿßŸÑÿ±ÿµŸäÿØ ÿ≥ÿßŸÑÿ®ÿßŸã
                    const newBalance = calculateCashBalance() - amount;
                    if (newBalance < 0) {
                        alert('ÿ™ŸÖ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿµÿ±ŸÅ ÿ®ŸÜÿ¨ÿßÿ≠ - ÿßŸÑÿ±ÿµŸäÿØ ÿ£ÿµÿ®ÿ≠ ÿ≥ÿßŸÑÿ®ÿßŸã');
                    } else {
                        alert('ÿ™ŸÖ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿµÿ±ŸÅ ÿ®ŸÜÿ¨ÿßÿ≠');
                    }
                    
                    // ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™
                    loadAllData();
                })
                .catch(error => {
                    showLoadingState(false);
                    alert('ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ÿ£ÿ´ŸÜÿßÿ° ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿµÿ±ŸÅ. Ÿäÿ±ÿ¨Ÿâ ÿßŸÑŸÖÿ≠ÿßŸàŸÑÿ© ŸÖÿ±ÿ© ÿ£ÿÆÿ±Ÿâ.');
                });
        }

        // ÿπÿ±ÿ∂ ÿ≠ÿ±ŸÉÿßÿ™ ÿßŸÑÿπŸáÿØÿ©
        function displayCashTransactions() {
            const container = document.getElementById('cashTransactionsList');
            if (!container) return;
            
            container.innerHTML = '';
            
            const dateFilter = document.getElementById('filterCashDate').value;
            const typeFilter = document.getElementById('filterCashType').value;
            const supervisorFilter = document.getElementById('filterCashSupervisor').value;
            
            let filteredTransactions = [...cashTransactions];
            
            if (dateFilter) {
                filteredTransactions = filteredTransactions.filter(t => t.date === dateFilter);
            }
            
            if (typeFilter) {
                filteredTransactions = filteredTransactions.filter(t => t.type === typeFilter);
            }
            
            if (supervisorFilter) {
                filteredTransactions = filteredTransactions.filter(t => t.supervisorId === supervisorFilter);
            }
            
            // ÿ™ÿ±ÿ™Ÿäÿ® ÿ™ŸÜÿßÿ≤ŸÑŸä ÿ≠ÿ≥ÿ® ÿßŸÑÿ™ÿßÿ±ŸäÿÆ
            filteredTransactions.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            if (filteredTransactions.length === 0) {
                container.innerHTML = '<div class="empty-state">ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ≠ÿ±ŸÉÿßÿ™ ŸÑŸÑÿπŸáÿØÿ©</div>';
                return;
            }
            
            filteredTransactions.forEach(transaction => {
                const item = document.createElement('div');
                item.className = 'list-item';
                
                const amountClass = transaction.type === 'ÿ•ŸäÿØÿßÿπ' ? 'cash-positive' : 'cash-negative';
                const amountSign = transaction.type === 'ÿ•ŸäÿØÿßÿπ' ? '+' : '-';
                
                const supervisor = supervisors.find(sup => sup.id === transaction.supervisorId);
                const supervisorName = supervisor ? supervisor.employeeName : (transaction.supervisorName || 'ÿ∫Ÿäÿ± ŸÖÿπÿ±ŸàŸÅ');
                
                let details = '';
                if (transaction.type === 'ÿ•ŸäÿØÿßÿπ') {
                    details = `ÿ≥ÿ®ÿ® ÿßŸÑÿ•ŸäÿØÿßÿπ: ${transaction.reason}`;
                } else {
                    details = `ÿ≥ÿ®ÿ® ÿßŸÑÿµÿ±ŸÅ: ${transaction.reason} - ÿßŸÑŸÖÿ≥ÿ™ŸÑŸÖ: ${transaction.recipient}`;
                }
                
                item.innerHTML = `
                    <div class="item-info">
                        <div class="item-title">${details}</div>
                        <div class="item-subtitle">
                            <span>${transaction.date}</span>
                            <span>${transaction.type}</span>
                            ${transaction.stationName ? `<span class="station-badge">${transaction.stationName}</span>` : ''}
                        </div>
                        <div class="item-subtitle">ÿßŸÑŸÖÿ≥ÿ§ŸàŸÑ: ${supervisorName}</div>
                        ${transaction.notes ? `<div class="item-subtitle">ŸÖŸÑÿßÿ≠ÿ∏ÿßÿ™: ${transaction.notes}</div>` : ''}
                    </div>
                    <div class="${amountClass}">${amountSign} ${transaction.amount} ÿ¨.ŸÖ</div>
                `;
                container.appendChild(item);
            });
        }

        // ÿπÿ±ÿ∂ ÿ¢ÿÆÿ± ÿ≠ÿ±ŸÉÿßÿ™ ÿßŸÑÿπŸáÿØÿ© ŸÅŸä ŸÑŸàÿ≠ÿ© ÿßŸÑÿ™ÿ≠ŸÉŸÖ
        function displayRecentCashTransactions() {
            const container = document.getElementById('recentCashTransactions');
            if (!container) return;
            
            const recent = [...cashTransactions]
                .sort((a, b) => new Date(b.date) - new Date(a.date))
                .slice(0, 5);
            
            if (recent.length === 0) {
                container.innerHTML = '<div class="empty-state">ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ≠ÿ±ŸÉÿßÿ™ ÿπŸáÿØÿ© ÿ≠ÿØŸäÿ´ÿ©</div>';
                return;
            }
            
            let html = '';
            recent.forEach(transaction => {
                const amountClass = transaction.type === 'ÿ•ŸäÿØÿßÿπ' ? 'cash-positive' : 'cash-negative';
                const amountSign = transaction.type === 'ÿ•ŸäÿØÿßÿπ' ? '+' : '-';
                
                let details = '';
                if (transaction.type === 'ÿ•ŸäÿØÿßÿπ') {
                    details = `ÿ•ŸäÿØÿßÿπ: ${transaction.reason}`;
                } else {
                    details = `ÿµÿ±ŸÅ: ${transaction.reason}`;
                }
                
                html += `
                    <div class="list-item">
                        <div class="item-info">
                            <div class="item-title">${details}</div>
                            <div class="item-subtitle">
                                <span>${transaction.date}</span>
                                ${transaction.stationName ? `<span class="station-badge">${transaction.stationName}</span>` : ''}
                            </div>
                        </div>
                        <div class="${amountClass}">${amountSign} ${transaction.amount} ÿ¨.ŸÖ</div>
                    </div>
                `;
            });
            container.innerHTML = html;
        }

        // ÿ™ÿ≠ÿØŸäÿ´ ŸÑŸàÿ≠ÿ© ÿßŸÑÿ™ÿ≠ŸÉŸÖ
        function updateDashboard() {
            const currentMonth = new Date().toISOString().slice(0, 7);
            const today = new Date().toISOString().split('T')[0];
            const selectedStation = document.getElementById('dashboardStationFilter').value;
            
            const activeEmployees = employees.filter(emp => emp.active);
            document.getElementById('totalEmployees').textContent = activeEmployees.length;
            
            let todayAttendanceRecords = attendance.filter(record => {
                if (record.date === today && (record.status === 'ÿ≠ÿßÿ∂ÿ±' || record.status === 'ÿ•ÿ¨ÿßÿ≤ÿ©')) {
                    const employee = employees.find(emp => emp.name === record.employeeName && emp.active);
                    if (employee && (!selectedStation || record.stationName === selectedStation)) {
                        return true;
                    }
                }
                return false;
            });
            document.getElementById('todayAttendance').textContent = todayAttendanceRecords.length;
            
            document.getElementById('totalStations').textContent = stations.length;
            
            const totalDeductions = financials
                .filter(f => f.type === 'ÿÆÿµŸÖ' && f.date.startsWith(currentMonth))
                .reduce((sum, f) => sum + f.amount, 0);
            document.getElementById('totalDeductions').textContent = totalDeductions + ' ÿ¨.ŸÖ';
            
            const totalRewards = financials
                .filter(f => f.type === 'ŸÖŸÉÿßŸÅÿ£ÿ©' && f.date.startsWith(currentMonth))
                .reduce((sum, f) => sum + f.amount, 0);
            document.getElementById('monthlyRewards').textContent = totalRewards + ' ÿ¨.ŸÖ';
            
            const totalLoans = financials
                .filter(f => f.type === 'ÿ≥ŸÑŸÅÿ©' && f.date.startsWith(currentMonth))
                .reduce((sum, f) => sum + f.amount, 0);
            document.getElementById('totalLoans').textContent = totalLoans + ' ÿ¨.ŸÖ';
            
            const activeFaults = faults.filter(f => f.status !== 'fixed').length;
            document.getElementById('activeFaults').textContent = activeFaults;
            
            document.getElementById('totalDbEmployees').textContent = employeeDatabase.length;
            
            // ÿ™ÿ≠ÿØŸäÿ´ ÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™ ÿßŸÑÿπŸáÿØÿ©
            updateCashStats();
            
            // ÿπÿ±ÿ∂ ÿßŸÑÿ≠ÿ∂Ÿàÿ± ÿßŸÑŸäŸàŸÖŸä
            const todayList = document.getElementById('todayAttendanceList');
            todayList.innerHTML = '';
            
            if (todayAttendanceRecords.length === 0) {
                todayList.innerHTML = '<div class="empty-state">ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ≥ÿ¨ŸÑÿßÿ™ ÿ≠ÿ∂Ÿàÿ± ŸÑŸáÿ∞ÿß ÿßŸÑŸäŸàŸÖ</div>';
                return;
            }
            
            const recordsByStation = {};
            todayAttendanceRecords.forEach(record => {
                const station = record.stationName || 'ŸÖÿ≠ÿ∑ÿ© ÿ∫Ÿäÿ± ŸÖÿ≠ÿØÿØÿ©';
                if (!recordsByStation[station]) {
                    recordsByStation[station] = [];
                }
                recordsByStation[station].push(record);
            });
            
            for (const [stationName, records] of Object.entries(recordsByStation)) {
                const stationGroup = document.createElement('div');
                stationGroup.className = 'station-group';
                
                stationGroup.innerHTML = `
                    <div class="station-group-header">
                        <span>${stationName}</span>
                        <span class="station-employee-count">ÿπÿØÿØ ÿßŸÑŸÖŸàÿ∏ŸÅŸäŸÜ: ${records.length}</span>
                    </div>
                    <div class="station-group-body" id="station-group-${stationName.replace(/\s+/g, '-')}"></div>
                `;
                todayList.appendChild(stationGroup);
                
                const groupBody = stationGroup.querySelector('.station-group-body');
                
                records.forEach(record => {
                    const supervisor = supervisors.find(sup => sup.id === record.supervisorId);
                    const supervisorName = supervisor ? supervisor.employeeName : (record.supervisorName || 'ÿ∫Ÿäÿ± ŸÖÿ≠ÿØÿØ');
                    
                    const item = document.createElement('div');
                    item.className = 'attendance-item';
                    
                    let statusBadgeClass = '';
                    let statusIcon = '';
                    if (record.status === 'ÿ≠ÿßÿ∂ÿ±') {
                        statusBadgeClass = 'status-present-badge';
                        statusIcon = '‚úÖ ÿ≠ÿßÿ∂ÿ±';
                    } else if (record.status === 'ÿ•ÿ¨ÿßÿ≤ÿ©') {
                        statusBadgeClass = 'status-leave-badge';
                        statusIcon = 'üå¥ ÿ•ÿ¨ÿßÿ≤ÿ©';
                    }
                    
                    item.innerHTML = `
                        <div class="attendance-employee-info">
                            <div class="attendance-employee-name">${record.employeeName}</div>
                            <div class="attendance-employee-details">
                                <span>ÿßŸÑŸÖÿ≥ÿ§ŸàŸÑ: ${supervisorName}</span>
                            </div>
                        </div>
                        <div class="attendance-status-badge ${statusBadgeClass}">
                            ${statusIcon}
                        </div>
                    `;
                    groupBody.appendChild(item);
                });
            }
            
            // ÿπÿ±ÿ∂ ÿ¢ÿÆÿ± ÿ≠ÿ±ŸÉÿßÿ™ ÿßŸÑÿπŸáÿØÿ©
            displayRecentCashTransactions();
        }

        // ==================== ÿßŸÑÿØŸàÿßŸÑ ÿßŸÑŸÖÿ≥ÿßÿπÿØÿ© ====================

        function checkEmployeeDuplicate(name, errorElementId) {
            const errorElement = document.getElementById(errorElementId);
            const isDuplicate = employees.some(emp => emp.name === name);
            
            if (isDuplicate) {
                errorElement.style.display = 'block';
                document.getElementById('empName').classList.add('input-error');
                return true;
            } else {
                errorElement.style.display = 'none';
                document.getElementById('empName').classList.remove('input-error');
                return false;
            }
        }
        
        function checkPhoneDuplicate(phone, errorElementId) {
            const errorElement = document.getElementById(errorElementId);
            const isDuplicate = employees.some(emp => emp.phone === phone);
            
            if (isDuplicate) {
                errorElement.style.display = 'block';
                document.getElementById('empPhone').classList.add('input-error');
                return true;
            } else {
                errorElement.style.display = 'none';
                document.getElementById('empPhone').classList.remove('input-error');
                return false;
            }
        }
        
        function checkEmployeeDatabaseDuplicate(name, errorElementId) {
            const errorElement = document.getElementById(errorElementId);
            const isDuplicate = employeeDatabase.some(emp => emp.name === name);
            
            if (isDuplicate) {
                errorElement.style.display = 'block';
                document.getElementById('dbEmpName').classList.add('input-error');
                return true;
            } else {
                errorElement.style.display = 'none';
                document.getElementById('dbEmpName').classList.remove('input-error');
                return false;
            }
        }
        
        function checkPhoneDatabaseDuplicate(phone, errorElementId) {
            const errorElement = document.getElementById(errorElementId);
            const isDuplicate = employeeDatabase.some(emp => emp.phone === phone);
            
            if (isDuplicate) {
                errorElement.style.display = 'block';
                document.getElementById('dbEmpPhone').classList.add('input-error');
                return true;
            } else {
                errorElement.style.display = 'none';
                document.getElementById('dbEmpPhone').classList.remove('input-error');
                return false;
            }
        }
        
        function validateAmount(amount, errorElementId) {
            const errorElement = document.getElementById(errorElementId);
            
            if (!amount || amount <= 0) {
                errorElement.style.display = 'block';
                errorElement.textContent = 'Ÿäÿ±ÿ¨Ÿâ ÿ•ÿØÿÆÿßŸÑ ŸÖÿ®ŸÑÿ∫ ÿµÿ≠Ÿäÿ≠';
                return false;
            } else {
                errorElement.style.display = 'none';
                return true;
            }
        }

        // ==================== ÿØŸàÿßŸÑ ÿ•ÿØÿßÿ±ÿ© ÿßŸÑŸÖŸàÿ∏ŸÅŸäŸÜ ====================

        function addEmployee() {
            showLoadingState(true);
            
            const name = document.getElementById('empName').value;
            const phone = document.getElementById('empPhone').value;
            const job = document.getElementById('empJob').value;
            const salary = parseInt(document.getElementById('empSalary').value);
            const workDays = parseInt(document.getElementById('empWorkDays').value);
            const active = document.getElementById('empActive').value === 'true';
            
            const existingEmployee = employeeDatabase.find(emp => 
                emp.name === name || emp.phone === phone
            );
            
            if (!existingEmployee) {
                showLoadingState(false);
                alert('Ÿäÿ¨ÿ® ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑŸÖŸàÿ∏ŸÅ ÿ£ŸàŸÑÿßŸã ŸÅŸä ŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ŸÇÿ®ŸÑ ÿ•ÿ∂ÿßŸÅÿ™Ÿá ÿ•ŸÑŸâ ÿßŸÑŸÖŸàÿ∏ŸÅŸäŸÜ ÿßŸÑŸÜÿ¥ÿ∑ŸäŸÜ');
                showPage('employee-database');
                return;
            }
            
            if (checkEmployeeDuplicate(name, 'empNameError') || checkPhoneDuplicate(phone, 'empPhoneError')) {
                showLoadingState(false);
                alert('ŸäŸàÿ¨ÿØ ŸÖŸàÿ∏ŸÅ ŸÖÿ≥ÿ¨ŸÑ ÿ®ŸÜŸÅÿ≥ ÿßŸÑÿßÿ≥ŸÖ ÿ£Ÿà ÿ±ŸÇŸÖ ÿßŸÑŸáÿßÿ™ŸÅ');
                return;
            }
            
            const newEmployee = {
                name,
                phone,
                job,
                salary,
                workDays,
                active,
                attendanceDays: 0,
                address: existingEmployee.address || '',
                whatsapp: existingEmployee.whatsapp || phone
            };
            
            addData('employees', newEmployee)
                .then((addedEmployee) => {
                    updateData('employeeDatabase', existingEmployee.id, { active: true })
                    .then(() => {
                        document.getElementById('employeeForm').reset();
                        document.getElementById('empWorkDays').value = 24;
                        document.getElementById('empActive').value = 'true';
                        
                        showLoadingState(false);
                        alert('ÿ™ŸÖ ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑŸÖŸàÿ∏ŸÅ ÿ®ŸÜÿ¨ÿßÿ≠');
                        loadAllData();
                    })
                    .catch(error => {
                        showLoadingState(false);
                        alert('ÿ™ŸÖ ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑŸÖŸàÿ∏ŸÅÿå ŸàŸÑŸÉŸÜ ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ≠ÿØŸäÿ´ ŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™');
                        loadAllData();
                    });
                })
                .catch(error => {
                    showLoadingState(false);
                    alert('ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ÿ£ÿ´ŸÜÿßÿ° ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑŸÖŸàÿ∏ŸÅ. Ÿäÿ±ÿ¨Ÿâ ÿßŸÑŸÖÿ≠ÿßŸàŸÑÿ© ŸÖÿ±ÿ© ÿ£ÿÆÿ±Ÿâ.');
                });
        }

        function addEmployeeToDatabase() {
            showLoadingState(true);
            
            const name = document.getElementById('dbEmpName').value;
            const phone = document.getElementById('dbEmpPhone').value;
            const whatsapp = document.getElementById('dbEmpWhatsapp').value || phone;
            const address = document.getElementById('dbEmpAddress').value;
            
            if (checkEmployeeDatabaseDuplicate(name, 'dbEmpNameError') || checkPhoneDatabaseDuplicate(phone, 'dbEmpPhoneError')) {
                showLoadingState(false);
                alert('ŸäŸàÿ¨ÿØ ŸÖŸàÿ∏ŸÅ ŸÖÿ≥ÿ¨ŸÑ ÿ®ŸÜŸÅÿ≥ ÿßŸÑÿßÿ≥ŸÖ ÿ£Ÿà ÿ±ŸÇŸÖ ÿßŸÑŸáÿßÿ™ŸÅ');
                return;
            }
            
            const newEmployee = {
                name,
                phone,
                whatsapp,
                address,
                job: '',
                salary: 0,
                workDays: 24,
                active: false,
                attendanceDays: 0
            };
            
            addData('employeeDatabase', newEmployee)
                .then(() => {
                    document.getElementById('employeeDatabaseForm').reset();
                    
                    showLoadingState(false);
                    alert('ÿ™ŸÖ ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑŸÖŸàÿ∏ŸÅ ÿ•ŸÑŸâ ŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿ®ŸÜÿ¨ÿßÿ≠');
                    loadAllData();
                })
                .catch(error => {
                    showLoadingState(false);
                    alert('ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ÿ£ÿ´ŸÜÿßÿ° ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑŸÖŸàÿ∏ŸÅ ÿ•ŸÑŸâ ŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™. Ÿäÿ±ÿ¨Ÿâ ÿßŸÑŸÖÿ≠ÿßŸàŸÑÿ© ŸÖÿ±ÿ© ÿ£ÿÆÿ±Ÿâ.');
                });
        }

        function displayEmployeesList() {
            const container = document.getElementById('employeesList');
            container.innerHTML = '';
            
            if (employees.length === 0) {
                container.innerHTML = '<div class="empty-state">ŸÑÿß ŸäŸàÿ¨ÿØ ŸÖŸàÿ∏ŸÅŸäŸÜ ŸÖÿ≥ÿ¨ŸÑŸäŸÜ</div>';
                return;
            }
            
            employees.forEach(emp => {
                const item = document.createElement('div');
                item.className = 'list-item';
                
                const statusClass = emp.active ? 'status-active' : 'status-inactive';
                const statusText = emp.active ? 'ŸÅÿπÿßŸÑ' : 'ÿ∫Ÿäÿ± ŸÅÿπÿßŸÑ';
                
                item.innerHTML = `
                    <div class="item-info">
                        <div class="item-title">${emp.name}</div>
                        <div class="item-subtitle">${emp.job} - ${emp.salary} ÿ¨.ŸÖ - ${emp.workDays} ŸäŸàŸÖ ÿπŸÖŸÑ</div>
                        <div class="employee-status ${statusClass}">${statusText}</div>
                    </div>
                    <div class="item-actions">
                        <button class="btn-edit" onclick="editEmployee('${emp.id}')">ÿ™ÿπÿØŸäŸÑ</button>
                        ${emp.active ? 
                            `<button class="btn-deactivate" onclick="toggleEmployeeStatus('${emp.id}')">ÿ™ÿπÿ∑ŸäŸÑ</button>` : 
                            `<button class="btn-activate" onclick="toggleEmployeeStatus('${emp.id}')">ÿ™ŸÅÿπŸäŸÑ</button>`
                        }
                        <button class="btn-delete" onclick="deleteEmployee('${emp.id}')">ÿ≠ÿ∞ŸÅ</button>
                    </div>
                `;
                container.appendChild(item);
            });
        }

        function displayEmployeeDatabase() {
            const container = document.getElementById('employeeDatabaseList');
            container.innerHTML = '';
            
            const searchTerm = document.getElementById('searchEmployee').value.toLowerCase();
            
            const filteredEmployees = employeeDatabase.filter(emp => 
                emp.name.toLowerCase().includes(searchTerm) || 
                emp.phone.includes(searchTerm)
            );
            
            if (filteredEmployees.length === 0) {
                container.innerHTML = '<div class="empty-state">ŸÑÿß ŸäŸàÿ¨ÿØ ŸÖŸàÿ∏ŸÅŸäŸÜ ŸÖÿ≥ÿ¨ŸÑŸäŸÜ</div>';
                return;
            }
            
            filteredEmployees.forEach(emp => {
                const card = document.createElement('div');
                card.className = 'employee-details-card';
                
                card.innerHTML = `
                    <div class="employee-details-header">
                        ${emp.name}
                        <div class="employee-status ${emp.active ? 'status-active' : 'status-inactive'}">${emp.active ? 'ŸÖŸÅÿπŸÑ' : 'ÿ∫Ÿäÿ± ŸÖŸÅÿπŸÑ'}</div>
                    </div>
                    <div class="employee-details-body">
                        <div class="employee-info-grid">
                            <div class="info-item">
                                <span class="info-label">ÿ±ŸÇŸÖ ÿßŸÑŸáÿßÿ™ŸÅ:</span>
                                <span class="info-value">${emp.phone}</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">ÿ±ŸÇŸÖ ÿßŸÑŸàÿßÿ™ÿ≥ÿßÿ®:</span>
                                <span class="info-value">${emp.whatsapp || emp.phone}</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">ÿßŸÑÿπŸÜŸàÿßŸÜ:</span>
                                <span class="info-value">${emp.address || 'ÿ∫Ÿäÿ± ŸÖÿ≠ÿØÿØ'}</span>
                            </div>
                        </div>
                        <div class="employee-actions">
                            <button class="btn-call" onclick="callEmployee('${emp.phone}')">
                                <i class="fas fa-phone"></i> ÿßÿ™ÿµŸÑ
                            </button>
                            <button class="btn-whatsapp" onclick="sendWhatsAppToEmployee('${emp.whatsapp || emp.phone}')">
                                <i class="fab fa-whatsapp"></i> Ÿàÿßÿ™ÿ≥ÿßÿ®
                            </button>
                            ${!emp.active ? 
                                `<button class="btn-activate" onclick="activateEmployeeFromDatabase('${emp.id}')">ÿ™ŸÅÿπŸäŸÑ</button>` : 
                                `<button class="btn-success" disabled>ŸÖŸÅÿπŸÑ</button>`
                            }
                            <button class="btn-edit" onclick="editEmployeeInDatabase('${emp.id}')">ÿ™ÿπÿØŸäŸÑ</button>
                            <button class="btn-delete" onclick="deleteEmployeeFromDatabase('${emp.id}')">ÿ≠ÿ∞ŸÅ</button>
                        </div>
                    </div>
                `;
                container.appendChild(card);
            });
        }

        function toggleEmployeeStatus(id) {
            const employee = employees.find(emp => emp.id === id);
            if (!employee) return;
            
            const newStatus = !employee.active;
            
            if (newStatus) {
                updateData('employees', id, { active: newStatus })
                .then(() => {
                    alert('ÿ™ŸÖ ÿ™ŸÅÿπŸäŸÑ ÿßŸÑŸÖŸàÿ∏ŸÅ ÿ®ŸÜÿ¨ÿßÿ≠');
                    loadAllData();
                })
                .catch(error => {
                    alert('ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ÿ£ÿ´ŸÜÿßÿ° ÿ™ŸÅÿπŸäŸÑ ÿßŸÑŸÖŸàÿ∏ŸÅ. Ÿäÿ±ÿ¨Ÿâ ÿßŸÑŸÖÿ≠ÿßŸàŸÑÿ© ŸÖÿ±ÿ© ÿ£ÿÆÿ±Ÿâ.');
                });
            } else {
                if (confirm('ÿ≥Ÿäÿ™ŸÖ ÿ™ÿπÿ∑ŸäŸÑ ÿßŸÑŸÖŸàÿ∏ŸÅ ŸàŸÜŸÇŸÑŸá ÿ•ŸÑŸâ ŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™. ŸáŸÑ ÿ™ÿ±ŸäÿØ ÿßŸÑŸÖÿ™ÿßÿ®ÿπÿ©ÿü')) {
                    moveEmployeeToDatabase(employee);
                }
            }
        }

        function moveEmployeeToDatabase(employee) {
            const existingEmployee = employeeDatabase.find(emp => emp.phone === employee.phone);
            
            if (existingEmployee) {
                updateData('employeeDatabase', existingEmployee.id, {
                    name: employee.name,
                    phone: employee.phone,
                    whatsapp: employee.whatsapp || employee.phone,
                    job: employee.job,
                    address: employee.address || '',
                    active: false
                })
                .then(() => {
                    deleteData('employees', employee.id)
                    .then(() => {
                        alert('ÿ™ŸÖ ŸÜŸÇŸÑ ÿßŸÑŸÖŸàÿ∏ŸÅ ÿ•ŸÑŸâ ŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿ®ŸÜÿ¨ÿßÿ≠');
                        loadAllData();
                    })
                    .catch(error => {
                        alert('ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ÿ£ÿ´ŸÜÿßÿ° ŸÜŸÇŸÑ ÿßŸÑŸÖŸàÿ∏ŸÅ ÿ•ŸÑŸâ ŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™');
                    });
                })
                .catch(error => {
                    alert('ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ÿ£ÿ´ŸÜÿßÿ° ÿ™ÿ≠ÿØŸäÿ´ ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸÖŸàÿ∏ŸÅ ŸÅŸä ŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™');
                });
            } else {
                const newEmployeeData = {
                    name: employee.name,
                    phone: employee.phone,
                    whatsapp: employee.whatsapp || employee.phone,
                    job: employee.job,
                    address: employee.address || '',
                    salary: employee.salary,
                    workDays: employee.workDays,
                    active: false
                };
                
                addData('employeeDatabase', newEmployeeData)
                .then(() => {
                    deleteData('employees', employee.id)
                    .then(() => {
                        alert('ÿ™ŸÖ ŸÜŸÇŸÑ ÿßŸÑŸÖŸàÿ∏ŸÅ ÿ•ŸÑŸâ ŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿ®ŸÜÿ¨ÿßÿ≠');
                        loadAllData();
                    })
                    .catch(error => {
                        alert('ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ÿ£ÿ´ŸÜÿßÿ° ŸÜŸÇŸÑ ÿßŸÑŸÖŸàÿ∏ŸÅ ÿ•ŸÑŸâ ŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™');
                    });
                })
                .catch(error => {
                    alert('ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ÿ£ÿ´ŸÜÿßÿ° ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑŸÖŸàÿ∏ŸÅ ÿ•ŸÑŸâ ŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™');
                });
            }
        }

        function activateEmployeeFromDatabase(id) {
            const employee = employeeDatabase.find(emp => emp.id === id);
            if (!employee) return;
            
            const existingEmployee = employees.find(emp => emp.phone === employee.phone);
            
            if (existingEmployee) {
                alert('Ÿáÿ∞ÿß ÿßŸÑŸÖŸàÿ∏ŸÅ ŸÖŸàÿ¨ŸàÿØ ÿ®ÿßŸÑŸÅÿπŸÑ ŸÅŸä ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑŸÖŸàÿ∏ŸÅŸäŸÜ ÿßŸÑŸÜÿ¥ÿ∑ŸäŸÜ');
                return;
            }
            
            const newEmployeeData = {
                name: employee.name,
                phone: employee.phone,
                job: employee.job || '',
                salary: employee.salary || 0,
                workDays: employee.workDays || 24,
                active: true,
                attendanceDays: 0
            };
            
            addData('employees', newEmployeeData)
            .then(() => {
                updateData('employeeDatabase', employee.id, { active: true })
                .then(() => {
                    alert('ÿ™ŸÖ ÿ™ŸÅÿπŸäŸÑ ÿßŸÑŸÖŸàÿ∏ŸÅ ÿ®ŸÜÿ¨ÿßÿ≠');
                    loadAllData();
                })
                .catch(error => {
                    alert('ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ÿ£ÿ´ŸÜÿßÿ° ÿ™ÿ≠ÿØŸäÿ´ ÿ≠ÿßŸÑÿ© ÿßŸÑŸÖŸàÿ∏ŸÅ ŸÅŸä ŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™');
                });
            })
            .catch(error => {
                alert('ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ÿ£ÿ´ŸÜÿßÿ° ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑŸÖŸàÿ∏ŸÅ ÿ•ŸÑŸâ ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑŸÖŸàÿ∏ŸÅŸäŸÜ ÿßŸÑŸÜÿ¥ÿ∑ŸäŸÜ');
            });
        }

        function editEmployee(id) {
            const employee = employees.find(emp => emp.id === id);
            if (!employee) return;
            
            document.getElementById('empName').value = employee.name;
            document.getElementById('empPhone').value = employee.phone;
            document.getElementById('empJob').value = employee.job;
            document.getElementById('empSalary').value = employee.salary;
            document.getElementById('empWorkDays').value = employee.workDays;
            document.getElementById('empActive').value = employee.active.toString();
            
            deleteData('employees', id)
                .then(() => {
                    alert('ŸäŸÖŸÉŸÜŸÉ ÿßŸÑÿ¢ŸÜ ÿ™ÿπÿØŸäŸÑ ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸÖŸàÿ∏ŸÅ Ÿàÿ•ÿ∂ÿßŸÅÿ™Ÿá ŸÖÿ±ÿ© ÿ£ÿÆÿ±Ÿâ');
                    showPage('employees');
                    loadAllData();
                })
                .catch(error => {
                    alert('ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ÿ£ÿ´ŸÜÿßÿ° ÿ™ÿ≠ÿ∂Ÿäÿ± ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸÖŸàÿ∏ŸÅ ŸÑŸÑÿ™ÿπÿØŸäŸÑ. Ÿäÿ±ÿ¨Ÿâ ÿßŸÑŸÖÿ≠ÿßŸàŸÑÿ© ŸÖÿ±ÿ© ÿ£ÿÆÿ±Ÿâ.');
                });
        }

        function deleteEmployee(id) {
            if (confirm('ŸáŸÑ ÿ£ŸÜÿ™ ŸÖÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ≠ÿ∞ŸÅ Ÿáÿ∞ÿß ÿßŸÑŸÖŸàÿ∏ŸÅÿü')) {
                const employee = employees.find(emp => emp.id === id);
                if (!employee) return;
                
                const employeeName = employee.name;
                
                if (confirm(`ÿ≥Ÿäÿ™ŸÖ ÿ≠ÿ∞ŸÅ ÿßŸÑŸÖŸàÿ∏ŸÅ Ÿàÿ¨ŸÖŸäÿπ ÿ®ŸäÿßŸÜÿßÿ™Ÿá ÿßŸÑŸÖÿ±ÿ™ÿ®ÿ∑ÿ© (ÿßŸÑÿ≠ÿ∂Ÿàÿ±ÿå ÿßŸÑÿ•ÿ¨ÿßÿ≤ÿßÿ™ÿå ÿßŸÑÿ≠ÿ±ŸÉÿßÿ™ ÿßŸÑŸÖÿßŸÑŸäÿ©). ŸáŸÑ ÿ™ÿ±ŸäÿØ ÿßŸÑŸÖÿ™ÿßÿ®ÿπÿ©ÿü`)) {
                    deleteData('employees', id)
                        .then(() => {
                            const attendancePromises = attendance
                                .filter(record => record.employeeName === employeeName)
                                .map(record => deleteData('attendance', record.id));
                            
                            const leavesPromises = leaves
                                .filter(leave => leave.employeeName === employeeName)
                                .map(leave => deleteData('leaves', leave.id));
                            
                            const financialsPromises = financials
                                .filter(financial => financial.employeeName === employeeName)
                                .map(financial => deleteData('financials', financial.id));
                            
                            Promise.all([
                                ...attendancePromises,
                                ...leavesPromises,
                                ...financialsPromises
                            ]).then(() => {
                                alert('ÿ™ŸÖ ÿ≠ÿ∞ŸÅ ÿßŸÑŸÖŸàÿ∏ŸÅ Ÿàÿ¨ŸÖŸäÿπ ÿ®ŸäÿßŸÜÿßÿ™Ÿá ÿßŸÑŸÖÿ±ÿ™ÿ®ÿ∑ÿ© ÿ®ŸÜÿ¨ÿßÿ≠');
                                loadAllData();
                            }).catch(error => {
                                console.error('ÿÆÿ∑ÿ£ ŸÅŸä ÿ≠ÿ∞ŸÅ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸÖÿ±ÿ™ÿ®ÿ∑ÿ©:', error);
                                alert('ÿ™ŸÖ ÿ≠ÿ∞ŸÅ ÿßŸÑŸÖŸàÿ∏ŸÅÿå ŸàŸÑŸÉŸÜ ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ŸÅŸä ÿ≠ÿ∞ŸÅ ÿ®ÿπÿ∂ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸÖÿ±ÿ™ÿ®ÿ∑ÿ©');
                                loadAllData();
                            });
                        })
                        .catch(error => {
                            alert('ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ÿ£ÿ´ŸÜÿßÿ° ÿ≠ÿ∞ŸÅ ÿßŸÑŸÖŸàÿ∏ŸÅ. Ÿäÿ±ÿ¨Ÿâ ÿßŸÑŸÖÿ≠ÿßŸàŸÑÿ© ŸÖÿ±ÿ© ÿ£ÿÆÿ±Ÿâ.');
                        });
                }
            }
        }

        function editEmployeeInDatabase(id) {
            const employee = employeeDatabase.find(emp => emp.id === id);
            if (!employee) return;
            
            const newName = prompt('ÿ£ÿØÿÆŸÑ ÿßÿ≥ŸÖ ÿßŸÑŸÖŸàÿ∏ŸÅ:', employee.name);
            if (newName !== null) {
                employee.name = newName;
            }
            
            const newPhone = prompt('ÿ£ÿØÿÆŸÑ ÿ±ŸÇŸÖ ÿßŸÑŸáÿßÿ™ŸÅ:', employee.phone);
            if (newPhone !== null) {
                employee.phone = newPhone;
            }
            
            const newWhatsapp = prompt('ÿ£ÿØÿÆŸÑ ÿ±ŸÇŸÖ ÿßŸÑŸàÿßÿ™ÿ≥ÿßÿ®:', employee.whatsapp || employee.phone);
            if (newWhatsapp !== null) {
                employee.whatsapp = newWhatsapp;
            }
            
            const newAddress = prompt('ÿ£ÿØÿÆŸÑ ÿπŸÜŸàÿßŸÜ ÿßŸÑŸÖŸàÿ∏ŸÅ:', employee.address || '');
            if (newAddress !== null) {
                employee.address = newAddress;
            }
            
            updateData('employeeDatabase', id, employee)
                .then(() => {
                    alert('ÿ™ŸÖ ÿ™ÿ≠ÿØŸäÿ´ ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸÖŸàÿ∏ŸÅ ÿ®ŸÜÿ¨ÿßÿ≠');
                    loadAllData();
                })
                .catch(error => {
                    alert('ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ÿ£ÿ´ŸÜÿßÿ° ÿ™ÿ≠ÿØŸäÿ´ ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸÖŸàÿ∏ŸÅ. Ÿäÿ±ÿ¨Ÿâ ÿßŸÑŸÖÿ≠ÿßŸàŸÑÿ© ŸÖÿ±ÿ© ÿ£ÿÆÿ±Ÿâ.');
                });
        }

        function deleteEmployeeFromDatabase(id) {
            if (confirm('ŸáŸÑ ÿ£ŸÜÿ™ ŸÖÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ≠ÿ∞ŸÅ Ÿáÿ∞ÿß ÿßŸÑŸÖŸàÿ∏ŸÅ ŸÖŸÜ ŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ÿü')) {
                deleteData('employeeDatabase', id)
                    .then(() => {
                        alert('ÿ™ŸÖ ÿ≠ÿ∞ŸÅ ÿßŸÑŸÖŸàÿ∏ŸÅ ŸÖŸÜ ŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿ®ŸÜÿ¨ÿßÿ≠');
                        loadAllData();
                    })
                    .catch(error => {
                        alert('ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ÿ£ÿ´ŸÜÿßÿ° ÿ≠ÿ∞ŸÅ ÿßŸÑŸÖŸàÿ∏ŸÅ. Ÿäÿ±ÿ¨Ÿâ ÿßŸÑŸÖÿ≠ÿßŸàŸÑÿ© ŸÖÿ±ÿ© ÿ£ÿÆÿ±Ÿâ.');
                    });
            }
        }

        function callEmployee(phone) {
            window.open(`tel:${phone}`, '_self');
        }
        
        function sendWhatsAppToEmployee(phone) {
            const message = "ŸÖÿ±ÿ≠ÿ®ÿßŸãÿå ÿ£ŸàÿØ ÿßŸÑÿ™ŸàÿßÿµŸÑ ŸÖÿπŸÉ ÿ®ÿÆÿµŸàÿµ ÿßŸÑÿπŸÖŸÑ";
            const encodedMessage = encodeURIComponent(message);
            const whatsappUrl = `https://wa.me/${phone}?text=${encodedMessage}`;
            window.open(whatsappUrl, '_blank');
        }

        // ==================== ÿØŸàÿßŸÑ ÿßŸÑÿ≠ÿ∂Ÿàÿ± ====================

        function recordManualAttendance() {
            showLoadingState(true);
            
            const employeeName = document.getElementById('attendanceEmployee').value;
            const stationName = document.getElementById('attendanceStation').value;
            const supervisorId = document.getElementById('attendanceSupervisor').value;
            const date = document.getElementById('attendanceDate').value;
            const status = document.getElementById('attendanceStatus').value;
            
            if (!employeeName || !stationName || !supervisorId || !date || !status) {
                alert('Ÿäÿ±ÿ¨Ÿâ ŸÖŸÑÿ° ÿ¨ŸÖŸäÿπ ÿßŸÑÿ≠ŸÇŸàŸÑ ÿßŸÑŸÖÿ∑ŸÑŸàÿ®ÿ©');
                showLoadingState(false);
                return;
            }
            
            const supervisor = supervisors.find(sup => sup.id === supervisorId);
            
            const existingRecord = attendance.find(record => 
                record.employeeName === employeeName && record.date === date
            );
            
            let promise;
            
            if (existingRecord) {
                promise = updateData('attendance', existingRecord.id, { 
                    status,
                    stationName,
                    supervisorId,
                    supervisorName: supervisor ? supervisor.employeeName : 'ÿ∫Ÿäÿ± ŸÖÿπÿ±ŸàŸÅ'
                });
            } else {
                const newAttendance = {
                    employeeName,
                    stationName,
                    supervisorId,
                    supervisorName: supervisor ? supervisor.employeeName : 'ÿ∫Ÿäÿ± ŸÖÿπÿ±ŸàŸÅ',
                    date,
                    status
                };
                promise = addData('attendance', newAttendance);
            }
            
            promise
                .then(() => {
                    showLoadingState(false);
                    alert('ÿ™ŸÖ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿ≠ÿ∂Ÿàÿ± ÿ®ŸÜÿ¨ÿßÿ≠');
                    loadAllData();
                })
                .catch(error => {
                    showLoadingState(false);
                    alert('ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ÿ£ÿ´ŸÜÿßÿ° ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿ≠ÿ∂Ÿàÿ±. Ÿäÿ±ÿ¨Ÿâ ÿßŸÑŸÖÿ≠ÿßŸàŸÑÿ© ŸÖÿ±ÿ© ÿ£ÿÆÿ±Ÿâ.');
                });
        }

        function recordAutoAttendance() {
            showLoadingState(true);
            
            const today = new Date().toISOString().split('T')[0];
            let recordsAdded = 0;
            let promises = [];
            
            employees.forEach(emp => {
                if (!emp.active) return;
                
                const existingRecord = attendance.find(record => 
                    record.employeeName === emp.name && record.date === today
                );
                
                if (existingRecord) {
                    return;
                }
                
                const isOnLeave = leaves.some(leave => {
                    const startDate = new Date(leave.start);
                    const endDate = new Date(leave.end);
                    const todayDate = new Date(today);
                    
                    return leave.employeeName === emp.name && 
                           todayDate >= startDate && 
                           todayDate <= endDate;
                });
                
                const status = isOnLeave ? 'ÿ•ÿ¨ÿßÿ≤ÿ©' : 'ÿ≠ÿßÿ∂ÿ±';
                
                const newAttendance = {
                    employeeName: emp.name,
                    stationName: '',
                    supervisorId: '',
                    supervisorName: 'ÿ™ŸÑŸÇÿßÿ¶Ÿä',
                    date: today,
                    status: status
                };
                
                promises.push(addData('attendance', newAttendance));
                recordsAdded++;
            });
            
            if (promises.length > 0) {
                Promise.all(promises)
                    .then(() => {
                        showLoadingState(false);
                        alert(`ÿ™ŸÖ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿ≠ÿ∂Ÿàÿ± ÿßŸÑÿ™ŸÑŸÇÿßÿ¶Ÿä ŸÑŸÄ ${recordsAdded} ŸÖŸàÿ∏ŸÅ`);
                        loadAllData();
                    })
                    .catch(error => {
                        showLoadingState(false);
                        alert('ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ÿ£ÿ´ŸÜÿßÿ° ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿ≠ÿ∂Ÿàÿ± ÿßŸÑÿ™ŸÑŸÇÿßÿ¶Ÿä. Ÿäÿ±ÿ¨Ÿâ ÿßŸÑŸÖÿ≠ÿßŸàŸÑÿ© ŸÖÿ±ÿ© ÿ£ÿÆÿ±Ÿâ.');
                    });
            } else {
                showLoadingState(false);
                alert('ÿ™ŸÖ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿ≠ÿ∂Ÿàÿ± ÿ®ÿßŸÑŸÅÿπŸÑ ŸÑÿ¨ŸÖŸäÿπ ÿßŸÑŸÖŸàÿ∏ŸÅŸäŸÜ ÿßŸÑŸÜÿ¥ÿ∑ŸäŸÜ ŸÑŸáÿ∞ÿß ÿßŸÑŸäŸàŸÖ');
            }
        }

        function displayAttendanceList() {
            const container = document.getElementById('attendanceList');
            container.innerHTML = '';
            
            const month = document.getElementById('filterAttendanceMonth').value;
            const stationFilter = document.getElementById('filterAttendanceStation').value;
            
            if (!month) {
                container.innerHTML = '<div class="empty-state">Ÿäÿ±ÿ¨Ÿâ ÿßÿÆÿ™Ÿäÿßÿ± ÿ¥Ÿáÿ± ŸÑÿπÿ±ÿ∂ ÿßŸÑÿ™ŸÇÿ±Ÿäÿ±</div>';
                return;
            }
            
            let filteredAttendance = attendance.filter(record => record.date.startsWith(month));
            
            if (stationFilter) {
                filteredAttendance = filteredAttendance.filter(record => record.stationName === stationFilter);
            }
            
            const activeEmployees = employees.filter(emp => emp.active);
            
            if (activeEmployees.length === 0) {
                container.innerHTML = '<div class="empty-state">ŸÑÿß ŸäŸàÿ¨ÿØ ŸÖŸàÿ∏ŸÅŸäŸÜ ŸÜÿ¥ÿ∑ŸäŸÜ</div>';
                return;
            }
            
            const employeeStats = {};
            
            filteredAttendance.forEach(record => {
                if (!employeeStats[record.employeeName]) {
                    employeeStats[record.employeeName] = {
                        present: 0,
                        absent: 0,
                        leave: 0,
                        station: record.stationName || 'ÿ∫Ÿäÿ± ŸÖÿ≠ÿØÿØ'
                    };
                }
                
                if (record.status === 'ÿ≠ÿßÿ∂ÿ±') employeeStats[record.employeeName].present++;
                else if (record.status === 'ÿ∫ÿßÿ¶ÿ®') employeeStats[record.employeeName].absent++;
                else if (record.status === 'ÿ•ÿ¨ÿßÿ≤ÿ©') employeeStats[record.employeeName].leave++;
            });
            
            for (let [employeeName, stats] of Object.entries(employeeStats)) {
                const item = document.createElement('div');
                item.className = 'list-item';
                item.innerHTML = `
                    <div class="item-info">
                        <div class="item-title">${employeeName}</div>
                        <div class="item-subtitle">
                            <span class="station-badge">${stats.station}</span>
                        </div>
                        <div class="item-subtitle">
                            <span>ÿ£ŸäÿßŸÖ ÿßŸÑÿ≠ÿ∂Ÿàÿ±: ${stats.present}</span>
                            <span>ÿ£ŸäÿßŸÖ ÿßŸÑÿ•ÿ¨ÿßÿ≤ÿ©: ${stats.leave}</span>
                            <span>ÿ£ŸäÿßŸÖ ÿßŸÑÿ∫Ÿäÿßÿ®: ${stats.absent}</span>
                        </div>
                    </div>
                    <div class="item-actions">
                        <button class="btn-whatsapp" onclick="sendWhatsAppMessage('${employeeName}', '${month}')">
                            <i class="fab fa-whatsapp"></i> ÿ•ÿ±ÿ≥ÿßŸÑ
                        </button>
                    </div>
                `;
                container.appendChild(item);
            }
        }

        // ==================== ÿØŸàÿßŸÑ ÿßŸÑÿ•ÿ¨ÿßÿ≤ÿßÿ™ ====================

        function addLeave() {
            showLoadingState(true);
            
            const employeeName = document.getElementById('leaveEmployee').value;
            const stationName = document.getElementById('leaveStation').value;
            const supervisorId = document.getElementById('leaveSupervisor').value;
            const type = document.getElementById('leaveType').value;
            const start = document.getElementById('leaveStart').value;
            const end = document.getElementById('leaveEnd').value;
            const notes = document.getElementById('leaveNotes').value;
            
            if (!employeeName || !stationName || !supervisorId || !type || !start || !end) {
                alert('Ÿäÿ±ÿ¨Ÿâ ŸÖŸÑÿ° ÿ¨ŸÖŸäÿπ ÿßŸÑÿ≠ŸÇŸàŸÑ ÿßŸÑŸÖÿ∑ŸÑŸàÿ®ÿ©');
                showLoadingState(false);
                return;
            }
            
            const supervisor = supervisors.find(sup => sup.id === supervisorId);
            
            const newLeave = {
                employeeName,
                stationName,
                supervisorId,
                supervisorName: supervisor ? supervisor.employeeName : 'ÿ∫Ÿäÿ± ŸÖÿπÿ±ŸàŸÅ',
                type,
                start,
                end,
                notes
            };
            
            addData('leaves', newLeave)
                .then(() => {
                    document.getElementById('leaveForm').reset();
                    document.getElementById('leaveStart').value = new Date().toISOString().split('T')[0];
                    document.getElementById('leaveEnd').value = new Date().toISOString().split('T')[0];
                    
                    showLoadingState(false);
                    alert('ÿ™ŸÖ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿ•ÿ¨ÿßÿ≤ÿ© ÿ®ŸÜÿ¨ÿßÿ≠');
                    loadAllData();
                })
                .catch(error => {
                    showLoadingState(false);
                    alert('ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ÿ£ÿ´ŸÜÿßÿ° ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿ•ÿ¨ÿßÿ≤ÿ©. Ÿäÿ±ÿ¨Ÿâ ÿßŸÑŸÖÿ≠ÿßŸàŸÑÿ© ŸÖÿ±ÿ© ÿ£ÿÆÿ±Ÿâ.');
                });
        }

        function displayLeavesList() {
            const container = document.getElementById('leavesList');
            container.innerHTML = '';
            
            const startDate = document.getElementById('leaveFilterStartDate').value;
            const endDate = document.getElementById('leaveFilterEndDate').value;
            const stationFilter = document.getElementById('filterLeaveStation').value;
            
            if (!startDate || !endDate) {
                container.innerHTML = '<div class="empty-state">Ÿäÿ±ÿ¨Ÿâ ÿßÿÆÿ™Ÿäÿßÿ± ÿ™ÿßÿ±ŸäÿÆ ÿßŸÑÿ®ÿØÿßŸäÿ© ŸàÿßŸÑŸÜŸáÿßŸäÿ©</div>';
                return;
            }
            
            if (new Date(startDate) > new Date(endDate)) {
                container.innerHTML = '<div class="empty-state">ÿ™ÿßÿ±ŸäÿÆ ÿßŸÑÿ®ÿØÿßŸäÿ© Ÿäÿ¨ÿ® ÿ£ŸÜ ŸäŸÉŸàŸÜ ŸÇÿ®ŸÑ ÿ™ÿßÿ±ŸäÿÆ ÿßŸÑŸÜŸáÿßŸäÿ©</div>';
                return;
            }
            
            let filteredLeaves = leaves.filter(leave => {
                const leaveStart = new Date(leave.start);
                const leaveEnd = new Date(leave.end);
                const filterStart = new Date(startDate);
                const filterEnd = new Date(endDate);
                
                const dateMatch = (leaveStart <= filterEnd && leaveEnd >= filterStart);
                const stationMatch = !stationFilter || leave.stationName === stationFilter;
                
                return dateMatch && stationMatch;
            });
            
            if (filteredLeaves.length === 0) {
                container.innerHTML = `<div class="empty-state">ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ•ÿ¨ÿßÿ≤ÿßÿ™ ŸÖÿ≥ÿ¨ŸÑÿ© ŸÅŸä ÿßŸÑŸÅÿ™ÿ±ÿ© ŸÖŸÜ ${startDate} ÿ•ŸÑŸâ ${endDate}</div>`;
                return;
            }
            
            filteredLeaves.forEach(leave => {
                const startDateObj = new Date(leave.start);
                const endDateObj = new Date(leave.end);
                const duration = Math.ceil((endDateObj - startDateObj) / (1000 * 60 * 60 * 24)) + 1;
                
                const supervisor = supervisors.find(sup => sup.id === leave.supervisorId);
                const supervisorName = supervisor ? supervisor.employeeName : (leave.supervisorName || 'ÿ∫Ÿäÿ± ŸÖÿ≠ÿØÿØ');
                
                const item = document.createElement('div');
                item.className = 'list-item';
                item.innerHTML = `
                    <div class="item-info">
                        <div class="item-title">${leave.employeeName}</div>
                        <div class="item-subtitle">
                            <span class="station-badge">${leave.stationName || 'ÿ∫Ÿäÿ± ŸÖÿ≠ÿØÿØ'}</span>
                            <span>${leave.type} - ${duration} ŸäŸàŸÖ</span>
                        </div>
                        <div class="item-subtitle">
                            <span>${leave.start} ÿ•ŸÑŸâ ${leave.end}</span>
                            <span>ÿßŸÑŸÖÿ≥ÿ§ŸàŸÑ: ${supervisorName}</span>
                        </div>
                    </div>
                    <div class="item-actions">
                        <button class="btn-edit" onclick="editLeave('${leave.id}')">ÿ™ÿπÿØŸäŸÑ</button>
                        <button class="btn-delete" onclick="deleteLeave('${leave.id}')">ÿ≠ÿ∞ŸÅ</button>
                    </div>
                `;
                container.appendChild(item);
            });
        }

        function editLeave(id) {
            const leave = leaves.find(l => l.id === id);
            if (!leave) return;
            
            document.getElementById('leaveEmployee').value = leave.employeeName;
            document.getElementById('leaveType').value = leave.type;
            document.getElementById('leaveStart').value = leave.start;
            document.getElementById('leaveEnd').value = leave.end;
            document.getElementById('leaveNotes').value = leave.notes;
            
            deleteData('leaves', id)
                .then(() => {
                    alert('ŸäŸÖŸÉŸÜŸÉ ÿßŸÑÿ¢ŸÜ ÿ™ÿπÿØŸäŸÑ ÿßŸÑÿ•ÿ¨ÿßÿ≤ÿ© Ÿàÿ™ÿ≥ÿ¨ŸäŸÑŸáÿß ŸÖÿ±ÿ© ÿ£ÿÆÿ±Ÿâ');
                    showPage('leaves');
                    loadAllData();
                })
                .catch(error => {
                    alert('ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ÿ£ÿ´ŸÜÿßÿ° ÿ™ÿ≠ÿ∂Ÿäÿ± ÿßŸÑÿ•ÿ¨ÿßÿ≤ÿ© ŸÑŸÑÿ™ÿπÿØŸäŸÑ. Ÿäÿ±ÿ¨Ÿâ ÿßŸÑŸÖÿ≠ÿßŸàŸÑÿ© ŸÖÿ±ÿ© ÿ£ÿÆÿ±Ÿâ.');
                });
        }

        function deleteLeave(id) {
            if (confirm('ŸáŸÑ ÿ£ŸÜÿ™ ŸÖÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ≠ÿ∞ŸÅ Ÿáÿ∞Ÿá ÿßŸÑÿ•ÿ¨ÿßÿ≤ÿ©ÿü')) {
                deleteData('leaves', id)
                    .then(() => {
                        alert('ÿ™ŸÖ ÿ≠ÿ∞ŸÅ ÿßŸÑÿ•ÿ¨ÿßÿ≤ÿ© ÿ®ŸÜÿ¨ÿßÿ≠');
                        loadAllData();
                    })
                    .catch(error => {
                        alert('ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ÿ£ÿ´ŸÜÿßÿ° ÿ≠ÿ∞ŸÅ ÿßŸÑÿ•ÿ¨ÿßÿ≤ÿ©. Ÿäÿ±ÿ¨Ÿâ ÿßŸÑŸÖÿ≠ÿßŸàŸÑÿ© ŸÖÿ±ÿ© ÿ£ÿÆÿ±Ÿâ.');
                    });
            }
        }

        // ==================== ÿØŸàÿßŸÑ ÿßŸÑÿ≠ÿ±ŸÉÿßÿ™ ÿßŸÑŸÖÿßŸÑŸäÿ© ====================

        function addFinancial() {
            showLoadingState(true);
            
            const employeeName = document.getElementById('financialEmployee').value;
            const stationName = document.getElementById('financialStation').value;
            const supervisorId = document.getElementById('financialSupervisor').value;
            const type = document.getElementById('financialType').value;
            const amount = parseInt(document.getElementById('financialAmount').value);
            const date = document.getElementById('financialDate').value;
            const notes = document.getElementById('financialNotes').value;
            
            if (!employeeName || !stationName || !supervisorId || !type || !amount || !date) {
                alert('Ÿäÿ±ÿ¨Ÿâ ŸÖŸÑÿ° ÿ¨ŸÖŸäÿπ ÿßŸÑÿ≠ŸÇŸàŸÑ ÿßŸÑŸÖÿ∑ŸÑŸàÿ®ÿ©');
                showLoadingState(false);
                return;
            }
            
            const supervisor = supervisors.find(sup => sup.id === supervisorId);
            
            const newFinancial = {
                employeeName,
                stationName,
                supervisorId,
                supervisorName: supervisor ? supervisor.employeeName : 'ÿ∫Ÿäÿ± ŸÖÿπÿ±ŸàŸÅ',
                type,
                amount,
                date,
                notes,
                timestamp: new Date().toISOString()
            };
            
            addData('financials', newFinancial)
                .then(() => {
                    document.getElementById('financialForm').reset();
                    document.getElementById('financialDate').value = new Date().toISOString().split('T')[0];
                    
                    showLoadingState(false);
                    alert('ÿ™ŸÖ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿ≠ÿ±ŸÉÿ© ÿßŸÑŸÖÿßŸÑŸäÿ© ÿ®ŸÜÿ¨ÿßÿ≠');
                    loadAllData();
                })
                .catch(error => {
                    showLoadingState(false);
                    alert('ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ÿ£ÿ´ŸÜÿßÿ° ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿ≠ÿ±ŸÉÿ© ÿßŸÑŸÖÿßŸÑŸäÿ©. Ÿäÿ±ÿ¨Ÿâ ÿßŸÑŸÖÿ≠ÿßŸàŸÑÿ© ŸÖÿ±ÿ© ÿ£ÿÆÿ±Ÿâ.');
                });
        }

        function displayFinancialsList() {
            const container = document.getElementById('financialList');
            container.innerHTML = '';
            
            const month = document.getElementById('filterFinancialMonth') ? 
                         document.getElementById('filterFinancialMonth').value : '';
            const employeeFilter = document.getElementById('filterFinancialEmployee') ? 
                              document.getElementById('filterFinancialEmployee').value : '';
            const stationFilter = document.getElementById('filterFinancialStation') ? 
                              document.getElementById('filterFinancialStation').value : '';
            const typeFilter = document.getElementById('filterFinancialType') ? 
                              document.getElementById('filterFinancialType').value : '';
            
            let filteredFinancials = financials;
            
            if (month) {
                filteredFinancials = filteredFinancials.filter(financial => 
                    financial.date.startsWith(month)
                );
            }
            
            if (employeeFilter) {
                filteredFinancials = filteredFinancials.filter(financial => 
                    financial.employeeName === employeeFilter
                );
            }
            
            if (stationFilter) {
                filteredFinancials = filteredFinancials.filter(financial => 
                    financial.stationName === stationFilter
                );
            }
            
            if (typeFilter) {
                filteredFinancials = filteredFinancials.filter(financial => 
                    financial.type === typeFilter
                );
            }
            
            if (filteredFinancials.length === 0) {
                container.innerHTML = '<div class="empty-state">ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ≠ÿ±ŸÉÿßÿ™ ŸÖÿßŸÑŸäÿ© ŸÖÿ≥ÿ¨ŸÑÿ©</div>';
                return;
            }
            
            filteredFinancials.forEach(financial => {
                const supervisor = supervisors.find(sup => sup.id === financial.supervisorId);
                const supervisorName = supervisor ? supervisor.employeeName : (financial.supervisorName || 'ÿ∫Ÿäÿ± ŸÖÿ≠ÿØÿØ');
                
                const item = document.createElement('div');
                item.className = 'list-item';
                item.innerHTML = `
                    <div class="item-info">
                        <div class="item-title">${financial.employeeName}</div>
                        <div class="item-subtitle">
                            <span class="station-badge">${financial.stationName || 'ÿ∫Ÿäÿ± ŸÖÿ≠ÿØÿØ'}</span>
                            <span>${financial.type} - ${financial.amount} ÿ¨.ŸÖ</span>
                        </div>
                        <div class="item-subtitle">
                            <span>${financial.date}</span>
                            <span>ÿßŸÑŸÖÿ≥ÿ§ŸàŸÑ: ${supervisorName}</span>
                        </div>
                    </div>
                    <div class="item-actions">
                        <button class="btn-edit" onclick="editFinancial('${financial.id}')">ÿ™ÿπÿØŸäŸÑ</button>
                        <button class="btn-delete" onclick="deleteFinancial('${financial.id}')">ÿ≠ÿ∞ŸÅ</button>
                    </div>
                `;
                container.appendChild(item);
            });
        }

        function editFinancial(id) {
            const financial = financials.find(f => f.id === id);
            if (!financial) return;
            
            document.getElementById('financialEmployee').value = financial.employeeName;
            document.getElementById('financialType').value = financial.type;
            document.getElementById('financialAmount').value = financial.amount;
            document.getElementById('financialDate').value = financial.date;
            document.getElementById('financialNotes').value = financial.notes;
            
            deleteData('financials', id)
                .then(() => {
                    alert('ŸäŸÖŸÉŸÜŸÉ ÿßŸÑÿ¢ŸÜ ÿ™ÿπÿØŸäŸÑ ÿßŸÑÿ≠ÿ±ŸÉÿ© ÿßŸÑŸÖÿßŸÑŸäÿ© Ÿàÿ™ÿ≥ÿ¨ŸäŸÑŸáÿß ŸÖÿ±ÿ© ÿ£ÿÆÿ±Ÿâ');
                    showPage('financial');
                    loadAllData();
                })
                .catch(error => {
                    alert('ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ÿ£ÿ´ŸÜÿßÿ° ÿ™ÿ≠ÿ∂Ÿäÿ± ÿßŸÑÿ≠ÿ±ŸÉÿ© ÿßŸÑŸÖÿßŸÑŸäÿ© ŸÑŸÑÿ™ÿπÿØŸäŸÑ. Ÿäÿ±ÿ¨Ÿâ ÿßŸÑŸÖÿ≠ÿßŸàŸÑÿ© ŸÖÿ±ÿ© ÿ£ÿÆÿ±Ÿâ.');
                });
        }

        function deleteFinancial(id) {
            if (confirm('ŸáŸÑ ÿ£ŸÜÿ™ ŸÖÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ≠ÿ∞ŸÅ Ÿáÿ∞Ÿá ÿßŸÑÿ≠ÿ±ŸÉÿ© ÿßŸÑŸÖÿßŸÑŸäÿ©ÿü')) {
                deleteData('financials', id)
                    .then(() => {
                        alert('ÿ™ŸÖ ÿ≠ÿ∞ŸÅ ÿßŸÑÿ≠ÿ±ŸÉÿ© ÿßŸÑŸÖÿßŸÑŸäÿ© ÿ®ŸÜÿ¨ÿßÿ≠');
                        loadAllData();
                    })
                    .catch(error => {
                        alert('ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ÿ£ÿ´ŸÜÿßÿ° ÿ≠ÿ∞ŸÅ ÿßŸÑÿ≠ÿ±ŸÉÿ© ÿßŸÑŸÖÿßŸÑŸäÿ©. Ÿäÿ±ÿ¨Ÿâ ÿßŸÑŸÖÿ≠ÿßŸàŸÑÿ© ŸÖÿ±ÿ© ÿ£ÿÆÿ±Ÿâ.');
                    });
            }
        }

        // ==================== ÿØŸàÿßŸÑ ÿßŸÑÿ£ÿπÿ∑ÿßŸÑ ====================

        function addFault() {
            showLoadingState(true);
            
            const stationName = document.getElementById('faultStation').value;
            const supervisorId = document.getElementById('faultSupervisor').value;
            const title = document.getElementById('faultTitle').value;
            const description = document.getElementById('faultDescription').value;
            const date = document.getElementById('faultDate').value;
            const status = document.getElementById('faultStatus').value;
            
            if (!stationName || !supervisorId || !title || !description || !date || !status) {
                alert('Ÿäÿ±ÿ¨Ÿâ ŸÖŸÑÿ° ÿ¨ŸÖŸäÿπ ÿßŸÑÿ≠ŸÇŸàŸÑ ÿßŸÑŸÖÿ∑ŸÑŸàÿ®ÿ©');
                showLoadingState(false);
                return;
            }
            
            const supervisor = supervisors.find(sup => sup.id === supervisorId);
            
            const newFault = {
                stationName,
                supervisorId,
                supervisorName: supervisor ? supervisor.employeeName : 'ÿ∫Ÿäÿ± ŸÖÿπÿ±ŸàŸÅ',
                title,
                description,
                date,
                status,
                createdAt: new Date().toISOString()
            };
            
            addData('faults', newFault)
                .then(() => {
                    document.getElementById('faultForm').reset();
                    document.getElementById('faultDate').value = new Date().toISOString().split('T')[0];
                    
                    showLoadingState(false);
                    alert('ÿ™ŸÖ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿπÿ∑ŸÑ ÿ®ŸÜÿ¨ÿßÿ≠');
                    loadAllData();
                })
                .catch(error => {
                    showLoadingState(false);
                    alert('ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ÿ£ÿ´ŸÜÿßÿ° ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿπÿ∑ŸÑ. Ÿäÿ±ÿ¨Ÿâ ÿßŸÑŸÖÿ≠ÿßŸàŸÑÿ© ŸÖÿ±ÿ© ÿ£ÿÆÿ±Ÿâ.');
                });
        }

        function displayFaultsList() {
            const container = document.getElementById('faultsList');
            container.innerHTML = '';
            
            const stationFilter = document.getElementById('filterFaultStation').value;
            const statusFilter = document.getElementById('filterFaultStatus').value;
            const startDate = document.getElementById('filterFaultStartDate').value;
            const endDate = document.getElementById('filterFaultEndDate').value;
            
            let filteredFaults = faults;
            
            if (stationFilter) {
                filteredFaults = filteredFaults.filter(fault => fault.stationName === stationFilter);
            }
            
            if (statusFilter) {
                filteredFaults = filteredFaults.filter(fault => fault.status === statusFilter);
            }
            
            if (startDate && endDate) {
                filteredFaults = filteredFaults.filter(fault => {
                    return fault.date >= startDate && fault.date <= endDate;
                });
            }
            
            if (filteredFaults.length === 0) {
                container.innerHTML = '<div class="empty-state">ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ£ÿπÿ∑ÿßŸÑ ŸÖÿ≥ÿ¨ŸÑÿ©</div>';
                return;
            }
            
            filteredFaults.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            filteredFaults.forEach(fault => {
                const item = document.createElement('div');
                item.className = 'list-item';
                
                let statusClass = '';
                let statusText = '';
                
                if (fault.status === 'fixed') {
                    statusClass = 'fault-fixed';
                    statusText = 'ÿ™ŸÖ ÿßŸÑÿ•ÿµŸÑÿßÿ≠';
                } else if (fault.status === 'in-progress') {
                    statusClass = 'fault-in-progress';
                    statusText = 'ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ•ÿµŸÑÿßÿ≠';
                } else {
                    statusClass = 'fault-pending';
                    statusText = 'ŸÑŸÖ Ÿäÿ™ŸÖ ÿßŸÑÿ•ÿµŸÑÿßÿ≠';
                }
                
                item.innerHTML = `
                    <div class="item-info">
                        <div class="item-title">${fault.title}</div>
                        <div class="item-subtitle">
                            <span class="station-badge">${fault.stationName}</span>
                            <span class="${statusClass}">${statusText}</span>
                        </div>
                        <div class="item-subtitle">
                            <span>ÿßŸÑŸÖÿ≥ÿ§ŸàŸÑ: ${fault.supervisorName}</span>
                            <span>ÿßŸÑÿ™ÿßÿ±ŸäÿÆ: ${fault.date}</span>
                        </div>
                        <div class="item-subtitle">${fault.description}</div>
                    </div>
                    <div class="item-actions">
                        <button class="btn-edit" onclick="editFault('${fault.id}')">ÿ™ÿπÿØŸäŸÑ</button>
                        <button class="btn-delete" onclick="deleteFault('${fault.id}')">ÿ≠ÿ∞ŸÅ</button>
                    </div>
                `;
                container.appendChild(item);
            });
        }

        function editFault(id) {
            const fault = faults.find(f => f.id === id);
            if (!fault) return;
            
            document.getElementById('faultStation').value = fault.stationName;
            document.getElementById('faultSupervisor').value = fault.supervisorId;
            document.getElementById('faultTitle').value = fault.title;
            document.getElementById('faultDescription').value = fault.description;
            document.getElementById('faultDate').value = fault.date;
            document.getElementById('faultStatus').value = fault.status;
            
            deleteData('faults', id)
                .then(() => {
                    alert('ŸäŸÖŸÉŸÜŸÉ ÿßŸÑÿ¢ŸÜ ÿ™ÿπÿØŸäŸÑ ÿßŸÑÿπÿ∑ŸÑ Ÿàÿ™ÿ≥ÿ¨ŸäŸÑŸá ŸÖÿ±ÿ© ÿ£ÿÆÿ±Ÿâ');
                    showPage('faults');
                    loadAllData();
                })
                .catch(error => {
                    alert('ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ÿ£ÿ´ŸÜÿßÿ° ÿ™ÿ≠ÿ∂Ÿäÿ± ÿßŸÑÿπÿ∑ŸÑ ŸÑŸÑÿ™ÿπÿØŸäŸÑ. Ÿäÿ±ÿ¨Ÿâ ÿßŸÑŸÖÿ≠ÿßŸàŸÑÿ© ŸÖÿ±ÿ© ÿ£ÿÆÿ±Ÿâ.');
                });
        }

        function deleteFault(id) {
            if (confirm('ŸáŸÑ ÿ£ŸÜÿ™ ŸÖÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ≠ÿ∞ŸÅ Ÿáÿ∞ÿß ÿßŸÑÿπÿ∑ŸÑÿü')) {
                deleteData('faults', id)
                    .then(() => {
                        alert('ÿ™ŸÖ ÿ≠ÿ∞ŸÅ ÿßŸÑÿπÿ∑ŸÑ ÿ®ŸÜÿ¨ÿßÿ≠');
                        loadAllData();
                    })
                    .catch(error => {
                        alert('ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ÿ£ÿ´ŸÜÿßÿ° ÿ≠ÿ∞ŸÅ ÿßŸÑÿπÿ∑ŸÑ. Ÿäÿ±ÿ¨Ÿâ ÿßŸÑŸÖÿ≠ÿßŸàŸÑÿ© ŸÖÿ±ÿ© ÿ£ÿÆÿ±Ÿâ.');
                    });
            }
        }

        // ==================== ÿØŸàÿßŸÑ ÿßŸÑŸÖÿ≠ÿ∑ÿßÿ™ ====================

        function addStation() {
            showLoadingState(true);
            
            const name = document.getElementById('stationName').value;
            const type = document.getElementById('stationType').value;
            const governorate = document.getElementById('stationGovernorate').value;
            const area = document.getElementById('stationArea').value;
            const address = document.getElementById('stationAddress').value;
            
            if (!name || !type || !governorate || !area || !address) {
                alert('Ÿäÿ±ÿ¨Ÿâ ŸÖŸÑÿ° ÿ¨ŸÖŸäÿπ ÿßŸÑÿ≠ŸÇŸàŸÑ ÿßŸÑŸÖÿ∑ŸÑŸàÿ®ÿ©');
                showLoadingState(false);
                return;
            }
            
            const newStation = {
                name,
                type,
                governorate,
                area,
                address,
                createdAt: new Date().toISOString()
            };
            
            addData('stations', newStation)
                .then(() => {
                    document.getElementById('stationForm').reset();
                    showLoadingState(false);
                    alert('ÿ™ŸÖ ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑŸÖÿ≠ÿ∑ÿ© ÿ®ŸÜÿ¨ÿßÿ≠');
                    loadAllData();
                })
                .catch(error => {
                    showLoadingState(false);
                    alert('ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ÿ£ÿ´ŸÜÿßÿ° ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑŸÖÿ≠ÿ∑ÿ©. Ÿäÿ±ÿ¨Ÿâ ÿßŸÑŸÖÿ≠ÿßŸàŸÑÿ© ŸÖÿ±ÿ© ÿ£ÿÆÿ±Ÿâ.');
                });
        }

        function displayStationsList() {
            const container = document.getElementById('stationsList');
            container.innerHTML = '';
            
            if (stations.length === 0) {
                container.innerHTML = '<div class="empty-state">ŸÑÿß ÿ™Ÿàÿ¨ÿØ ŸÖÿ≠ÿ∑ÿßÿ™ ŸÖÿ≥ÿ¨ŸÑÿ©</div>';
                return;
            }
            
            stations.forEach(station => {
                const item = document.createElement('div');
                item.className = 'list-item';
                
                item.innerHTML = `
                    <div class="item-info">
                        <div class="item-title">${station.name}</div>
                        <div class="item-subtitle">
                            <span class="station-type">${station.type}</span>
                        </div>
                        <div class="item-subtitle">
                            <span>${station.governorate} - ${station.area}</span>
                        </div>
                        <div class="item-subtitle">${station.address}</div>
                    </div>
                    <div class="item-actions">
                        <button class="btn-edit" onclick="editStation('${station.id}')">ÿ™ÿπÿØŸäŸÑ</button>
                        <button class="btn-delete" onclick="deleteStation('${station.id}')">ÿ≠ÿ∞ŸÅ</button>
                    </div>
                `;
                container.appendChild(item);
            });
        }

        function editStation(id) {
            const station = stations.find(s => s.id === id);
            if (!station) return;
            
            document.getElementById('stationName').value = station.name;
            document.getElementById('stationType').value = station.type;
            document.getElementById('stationGovernorate').value = station.governorate;
            document.getElementById('stationArea').value = station.area;
            document.getElementById('stationAddress').value = station.address;
            
            deleteData('stations', id)
                .then(() => {
                    alert('ŸäŸÖŸÉŸÜŸÉ ÿßŸÑÿ¢ŸÜ ÿ™ÿπÿØŸäŸÑ ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸÖÿ≠ÿ∑ÿ© Ÿàÿ•ÿ∂ÿßŸÅÿ™Ÿáÿß ŸÖÿ±ÿ© ÿ£ÿÆÿ±Ÿâ');
                    showPage('stations');
                    loadAllData();
                })
                .catch(error => {
                    alert('ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ÿ£ÿ´ŸÜÿßÿ° ÿ™ÿ≠ÿ∂Ÿäÿ± ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸÖÿ≠ÿ∑ÿ© ŸÑŸÑÿ™ÿπÿØŸäŸÑ. Ÿäÿ±ÿ¨Ÿâ ÿßŸÑŸÖÿ≠ÿßŸàŸÑÿ© ŸÖÿ±ÿ© ÿ£ÿÆÿ±Ÿâ.');
                });
        }

        function deleteStation(id) {
            if (confirm('ŸáŸÑ ÿ£ŸÜÿ™ ŸÖÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ≠ÿ∞ŸÅ Ÿáÿ∞Ÿá ÿßŸÑŸÖÿ≠ÿ∑ÿ©ÿü')) {
                deleteData('stations', id)
                    .then(() => {
                        alert('ÿ™ŸÖ ÿ≠ÿ∞ŸÅ ÿßŸÑŸÖÿ≠ÿ∑ÿ© ÿ®ŸÜÿ¨ÿßÿ≠');
                        loadAllData();
                    })
                    .catch(error => {
                        alert('ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ÿ£ÿ´ŸÜÿßÿ° ÿ≠ÿ∞ŸÅ ÿßŸÑŸÖÿ≠ÿ∑ÿ©. Ÿäÿ±ÿ¨Ÿâ ÿßŸÑŸÖÿ≠ÿßŸàŸÑÿ© ŸÖÿ±ÿ© ÿ£ÿÆÿ±Ÿâ.');
                    });
            }
        }

        // ==================== ÿØŸàÿßŸÑ ÿßŸÑŸÖÿ≥ÿ§ŸàŸÑŸäŸÜ ====================

        function addSupervisor() {
            showLoadingState(true);
            
            const employeeId = document.getElementById('supervisorEmployee').value;
            const password = document.getElementById('supervisorPassword').value;
            const active = document.getElementById('supervisorActive').value === 'true';
            
            if (!employeeId) {
                alert('Ÿäÿ±ÿ¨Ÿâ ÿßÿÆÿ™Ÿäÿßÿ± ŸÖŸàÿ∏ŸÅ');
                showLoadingState(false);
                return;
            }
            
            if (!password) {
                document.getElementById('supervisorPasswordError').style.display = 'block';
                showLoadingState(false);
                return;
            } else {
                document.getElementById('supervisorPasswordError').style.display = 'none';
            }
            
            const employee = employeeDatabase.find(emp => emp.id === employeeId);
            if (!employee) {
                alert('ÿßŸÑŸÖŸàÿ∏ŸÅ ÿ∫Ÿäÿ± ŸÖŸàÿ¨ŸàÿØ');
                showLoadingState(false);
                return;
            }
            
            const existingSupervisor = supervisors.find(sup => sup.employeeId === employeeId);
            if (existingSupervisor) {
                alert('Ÿáÿ∞ÿß ÿßŸÑŸÖŸàÿ∏ŸÅ ŸÖÿ∂ÿßŸÅ ÿ®ÿßŸÑŸÅÿπŸÑ ŸÉŸÖÿ≥ÿ§ŸàŸÑ');
                showLoadingState(false);
                return;
            }
            
            const newSupervisor = {
                employeeId: employee.id,
                employeeName: employee.name,
                employeePhone: employee.phone,
                password: password,
                active: active,
                createdAt: new Date().toISOString()
            };
            
            addData('supervisors', newSupervisor)
                .then(() => {
                    document.getElementById('supervisorForm').reset();
                    document.getElementById('supervisorActive').value = 'true';
                    
                    showLoadingState(false);
                    alert('ÿ™ŸÖ ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑŸÖÿ≥ÿ§ŸàŸÑ ÿ®ŸÜÿ¨ÿßÿ≠');
                    loadAllData();
                })
                .catch(error => {
                    showLoadingState(false);
                    alert('ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ÿ£ÿ´ŸÜÿßÿ° ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑŸÖÿ≥ÿ§ŸàŸÑ. Ÿäÿ±ÿ¨Ÿâ ÿßŸÑŸÖÿ≠ÿßŸàŸÑÿ© ŸÖÿ±ÿ© ÿ£ÿÆÿ±Ÿâ.');
                });
        }

        function displaySupervisorsList() {
            const container = document.getElementById('supervisorsList');
            container.innerHTML = '';
            
            if (supervisors.length === 0) {
                container.innerHTML = '<div class="empty-state">ŸÑÿß ŸäŸàÿ¨ÿØ ŸÖÿ≥ÿ§ŸàŸÑŸäŸÜ ŸÖÿ≥ÿ¨ŸÑŸäŸÜ</div>';
                return;
            }
            
            supervisors.forEach(sup => {
                const item = document.createElement('div');
                item.className = 'list-item';
                
                const statusClass = sup.active ? 'status-active' : 'status-inactive';
                const statusText = sup.active ? 'ŸÅÿπÿßŸÑ' : 'ÿ∫Ÿäÿ± ŸÅÿπÿßŸÑ';
                
                item.innerHTML = `
                    <div class="item-info">
                        <div class="item-title">${sup.employeeName}</div>
                        <div class="item-subtitle">${sup.employeePhone}</div>
                        <div class="item-subtitle">ŸÉŸÑŸÖÿ© ÿßŸÑÿ≥ÿ±: ${sup.password}</div>
                        <div class="employee-status ${statusClass}">${statusText}</div>
                    </div>
                    <div class="item-actions">
                        <button class="btn-edit" onclick="editSupervisor('${sup.id}')">ÿ™ÿπÿØŸäŸÑ</button>
                        <button class="btn-delete" onclick="deleteSupervisor('${sup.id}')">ÿ≠ÿ∞ŸÅ</button>
                    </div>
                `;
                container.appendChild(item);
            });
        }

        function editSupervisor(id) {
            const sup = supervisors.find(s => s.id === id);
            if (!sup) return;
            
            document.getElementById('supervisorEmployee').value = sup.employeeId;
            document.getElementById('supervisorPassword').value = sup.password;
            document.getElementById('supervisorActive').value = sup.active.toString();
            
            deleteData('supervisors', id)
                .then(() => {
                    alert('ŸäŸÖŸÉŸÜŸÉ ÿßŸÑÿ¢ŸÜ ÿ™ÿπÿØŸäŸÑ ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸÖÿ≥ÿ§ŸàŸÑ Ÿàÿ•ÿ∂ÿßŸÅÿ™Ÿá ŸÖÿ±ÿ© ÿ£ÿÆÿ±Ÿâ');
                    showPage('supervisors');
                    loadAllData();
                })
                .catch(error => {
                    alert('ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ÿ£ÿ´ŸÜÿßÿ° ÿ™ÿ≠ÿ∂Ÿäÿ± ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸÖÿ≥ÿ§ŸàŸÑ ŸÑŸÑÿ™ÿπÿØŸäŸÑ. Ÿäÿ±ÿ¨Ÿâ ÿßŸÑŸÖÿ≠ÿßŸàŸÑÿ© ŸÖÿ±ÿ© ÿ£ÿÆÿ±Ÿâ.');
                });
        }

        function deleteSupervisor(id) {
            if (confirm('ŸáŸÑ ÿ£ŸÜÿ™ ŸÖÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ≠ÿ∞ŸÅ Ÿáÿ∞ÿß ÿßŸÑŸÖÿ≥ÿ§ŸàŸÑÿü')) {
                deleteData('supervisors', id)
                    .then(() => {
                        alert('ÿ™ŸÖ ÿ≠ÿ∞ŸÅ ÿßŸÑŸÖÿ≥ÿ§ŸàŸÑ ÿ®ŸÜÿ¨ÿßÿ≠');
                        loadAllData();
                    })
                    .catch(error => {
                        alert('ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ÿ£ÿ´ŸÜÿßÿ° ÿ≠ÿ∞ŸÅ ÿßŸÑŸÖÿ≥ÿ§ŸàŸÑ. Ÿäÿ±ÿ¨Ÿâ ÿßŸÑŸÖÿ≠ÿßŸàŸÑÿ© ŸÖÿ±ÿ© ÿ£ÿÆÿ±Ÿâ.');
                    });
            }
        }

        // ==================== ÿØŸàÿßŸÑ ÿßŸÑÿ™ŸÇÿßÿ±Ÿäÿ± ====================

        function generateSalaryReport() {
            showLoadingState(true);
            
            const tbody = document.querySelector('#salaryReportTable tbody');
            tbody.innerHTML = '';
            
            const month = document.getElementById('reportMonth').value;
            
            if (!month) {
                alert('Ÿäÿ±ÿ¨Ÿâ ÿßÿÆÿ™Ÿäÿßÿ± ÿ¥Ÿáÿ±');
                showLoadingState(false);
                return;
            }
            
            if (employees.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" style="text-align: center; padding: 20px; color: #666;">ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ®ŸäÿßŸÜÿßÿ™ ŸÑÿπÿ±ÿ∂Ÿáÿß</td></tr>';
                showLoadingState(false);
                return;
            }
            
            employees.forEach(emp => {
                const workDays = attendance.filter(record => 
                    record.employeeName === emp.name && 
                    record.date.startsWith(month) && 
                    record.status === 'ÿ≠ÿßÿ∂ÿ±'
                ).length;
                
                const dailyRate = emp.salary / 30;
                let netSalary = 0;
                
                if (workDays >= emp.workDays) {
                    netSalary = emp.salary;
                    
                    if (workDays > emp.workDays) {
                        const extraDays = workDays - emp.workDays;
                        netSalary += extraDays * dailyRate;
                    }
                } else {
                    netSalary = workDays * dailyRate;
                }
                
                const employeeFinancials = financials.filter(f => 
                    f.employeeName === emp.name && f.date.startsWith(month)
                );
                
                const loans = employeeFinancials
                    .filter(f => f.type === 'ÿ≥ŸÑŸÅÿ©')
                    .reduce((sum, f) => sum + f.amount, 0);
                
                const rewards = employeeFinancials
                    .filter(f => f.type === 'ŸÖŸÉÿßŸÅÿ£ÿ©')
                    .reduce((sum, f) => sum + f.amount, 0);
                
                const deductions = employeeFinancials
                    .filter(f => f.type === 'ÿÆÿµŸÖ')
                    .reduce((sum, f) => sum + f.amount, 0);
                
                netSalary = netSalary + rewards - loans - deductions;
                
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${emp.name}</td>
                    <td>${emp.salary} ÿ¨.ŸÖ</td>
                    <td>${workDays} ŸäŸàŸÖ</td>
                    <td>${Math.round(netSalary)} ÿ¨.ŸÖ</td>
                    <td>
                        <button class="btn-success" onclick="showSalaryDetails('${emp.name}', '${month}')">ÿπÿ±ÿ∂ ÿßŸÑÿ™ŸÅÿßÿµŸäŸÑ</button>
                        <button class="btn-whatsapp" onclick="sendWhatsAppMessage('${emp.name}', '${month}')" style="margin-top: 5px;">
                            <i class="fab fa-whatsapp"></i> ÿ•ÿ±ÿ≥ÿßŸÑ ŸÑŸÑŸàÿßÿ™ÿ≥ÿßÿ®
                        </button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
            
            showLoadingState(false);
        }

        function showSalaryDetails(employeeName, month) {
            const emp = employees.find(e => e.name === employeeName);
            if (!emp) return;
            
            const workDays = attendance.filter(record => 
                record.employeeName === emp.name && 
                record.date.startsWith(month) && 
                record.status === 'ÿ≠ÿßÿ∂ÿ±'
            ).length;
            
            const dailyRate = emp.salary / 30;
            let netSalary = 0;
            let extraDays = 0;
            let extraSalary = 0;
            let baseSalary = 0;
            
            if (workDays >= emp.workDays) {
                baseSalary = emp.salary;
                
                if (workDays > emp.workDays) {
                    extraDays = workDays - emp.workDays;
                    extraSalary = extraDays * dailyRate;
                    netSalary = baseSalary + extraSalary;
                } else {
                    netSalary = baseSalary;
                }
            } else {
                baseSalary = workDays * dailyRate;
                netSalary = baseSalary;
            }
            
            const employeeFinancials = financials.filter(f => 
                f.employeeName === emp.name && f.date.startsWith(month)
            );
            
            const loans = employeeFinancials
                .filter(f => f.type === 'ÿ≥ŸÑŸÅÿ©')
                .reduce((sum, f) => sum + f.amount, 0);
            
            const rewards = employeeFinancials
                .filter(f => f.type === 'ŸÖŸÉÿßŸÅÿ£ÿ©')
                .reduce((sum, f) => sum + f.amount, 0);
            
            const deductions = employeeFinancials
                .filter(f => f.type === 'ÿÆÿµŸÖ')
                .reduce((sum, f) => sum + f.amount, 0);
            
            netSalary = netSalary + rewards - loans - deductions;
            
            const details = `
                <strong>ÿ™ŸÅÿßÿµŸäŸÑ ÿ±ÿßÿ™ÿ® ${emp.name} ŸÑÿ¥Ÿáÿ± ${month}</strong><br>
                - ÿßŸÑÿ±ÿßÿ™ÿ® ÿßŸÑÿ£ÿ≥ÿßÿ≥Ÿä ÿßŸÑŸÖÿ™ŸÅŸÇ ÿπŸÑŸäŸá: ${emp.salary} ÿ¨.ŸÖ<br>
                - ÿ£ŸäÿßŸÖ ÿßŸÑÿπŸÖŸÑ ÿßŸÑŸÖÿ™ŸÅŸÇ ÿπŸÑŸäŸáÿß: ${emp.workDays} ŸäŸàŸÖ<br>
                - ÿ£ŸäÿßŸÖ ÿßŸÑÿπŸÖŸÑ ÿßŸÑŸÅÿπŸÑŸäÿ©: ${workDays} ŸäŸàŸÖ<br>
                - ÿ≥ÿπÿ± ÿßŸÑŸäŸàŸÖ: ${dailyRate.toFixed(2)} ÿ¨.ŸÖ<br>
                ${workDays > emp.workDays ? `- ÿßŸÑÿ£ŸäÿßŸÖ ÿßŸÑÿ•ÿ∂ÿßŸÅŸäÿ©: ${extraDays} ŸäŸàŸÖ<br>- ŸÇŸäŸÖÿ© ÿßŸÑÿ£ŸäÿßŸÖ ÿßŸÑÿ•ÿ∂ÿßŸÅŸäÿ©: ${extraSalary.toFixed(2)} ÿ¨.ŸÖ<br>` : ''}
                - ÿßŸÑÿ±ÿßÿ™ÿ® ÿßŸÑÿ£ÿ≥ÿßÿ≥Ÿä ÿßŸÑŸÖÿ≥ÿ™ÿ≠ŸÇ: ${baseSalary.toFixed(2)} ÿ¨.ŸÖ<br>
                - ÿßŸÑÿ≥ŸÑŸÅ: ${loans} ÿ¨.ŸÖ<br>
                - ÿßŸÑŸÖŸÉÿßŸÅÿ¢ÿ™: ${rewards} ÿ¨.ŸÖ<br>
                - ÿßŸÑÿÆÿµŸàŸÖÿßÿ™: ${deductions} ÿ¨.ŸÖ<br>
                - <strong>ÿµÿßŸÅŸä ÿßŸÑÿ±ÿßÿ™ÿ®: ${Math.round(netSalary)} ÿ¨.ŸÖ</strong>
            `;
            
            alert(details);
        }

        function sendWhatsAppMessage(employeeName, month) {
            const emp = employees.find(e => e.name === employeeName);
            if (!emp) return;
            
            const workDays = attendance.filter(record => 
                record.employeeName === emp.name && 
                record.date.startsWith(month) && 
                record.status === 'ÿ≠ÿßÿ∂ÿ±'
            ).length;
            
            const dailyRate = emp.salary / 30;
            let netSalary = 0;
            let extraDays = 0;
            let extraSalary = 0;
            let baseSalary = 0;
            
            if (workDays >= emp.workDays) {
                baseSalary = emp.salary;
                
                if (workDays > emp.workDays) {
                    extraDays = workDays - emp.workDays;
                    extraSalary = extraDays * dailyRate;
                    netSalary = baseSalary + extraSalary;
                } else {
                    netSalary = baseSalary;
                }
            } else {
                baseSalary = workDays * dailyRate;
                netSalary = baseSalary;
            }
            
            const employeeFinancials = financials.filter(f => 
                f.employeeName === emp.name && f.date.startsWith(month)
            );
            
            const loans = employeeFinancials
                .filter(f => f.type === 'ÿ≥ŸÑŸÅÿ©')
                .reduce((sum, f) => sum + f.amount, 0);
            
            const rewards = employeeFinancials
                .filter(f => f.type === 'ŸÖŸÉÿßŸÅÿ£ÿ©')
                .reduce((sum, f) => sum + f.amount, 0);
            
            const deductions = employeeFinancials
                .filter(f => f.type === 'ÿÆÿµŸÖ')
                .reduce((sum, f) => sum + f.amount, 0);
            
            netSalary = netSalary + rewards - loans - deductions;
            
            const message = `ŸÖÿ±ÿ≠ÿ®ÿßŸã ${emp.name}ÿå

ÿ™ŸÅÿßÿµŸäŸÑ ÿ±ÿßÿ™ÿ®ŸÉ ŸÑÿ¥Ÿáÿ± ${month}:
- ÿßŸÑÿ±ÿßÿ™ÿ® ÿßŸÑÿ£ÿ≥ÿßÿ≥Ÿä: ${emp.salary} ÿ¨.ŸÖ
- ÿ£ŸäÿßŸÖ ÿßŸÑÿπŸÖŸÑ ÿßŸÑŸÖÿ™ŸÅŸÇ ÿπŸÑŸäŸáÿß: ${emp.workDays} ŸäŸàŸÖ
- ÿ£ŸäÿßŸÖ ÿßŸÑÿπŸÖŸÑ ÿßŸÑŸÅÿπŸÑŸäÿ©: ${workDays} ŸäŸàŸÖ
${extraDays > 0 ? `- ÿßŸÑÿ£ŸäÿßŸÖ ÿßŸÑÿ•ÿ∂ÿßŸÅŸäÿ©: ${extraDays} ŸäŸàŸÖ\n- ŸÇŸäŸÖÿ© ÿßŸÑÿ£ŸäÿßŸÖ ÿßŸÑÿ•ÿ∂ÿßŸÅŸäÿ©: ${extraSalary.toFixed(2)} ÿ¨.ŸÖ` : ''}
- ÿßŸÑÿ≥ŸÑŸÅ: ${loans} ÿ¨.ŸÖ
- ÿßŸÑŸÖŸÉÿßŸÅÿ¢ÿ™: ${rewards} ÿ¨.ŸÖ
- ÿßŸÑÿÆÿµŸàŸÖÿßÿ™: ${deductions} ÿ¨.ŸÖ
- ÿµÿßŸÅŸä ÿßŸÑÿ±ÿßÿ™ÿ®: ${Math.round(netSalary)} ÿ¨.ŸÖ

ÿ¥ŸÉÿ±ÿßŸã ŸÑÿ¨ŸáŸàÿØŸÉ!`;
            
            const encodedMessage = encodeURIComponent(message);
            const whatsappNumber = emp.whatsapp || emp.phone;
            const whatsappUrl = `https://wa.me/${whatsappNumber}?text=${encodedMessage}`;
            window.open(whatsappUrl, '_blank');
        }

        // ==================== ÿØŸàÿßŸÑ ÿ™ŸÇÿßÿ±Ÿäÿ± ÿßŸÑŸÖŸàÿ∏ŸÅŸäŸÜ ====================

        function generateEmployeeReport() {
            const employeeName = document.getElementById('selectEmployeeForReport').value;
            const month = document.getElementById('selectMonthForReport').value;
            
            if (!employeeName || !month) {
                alert('Ÿäÿ±ÿ¨Ÿâ ÿßÿÆÿ™Ÿäÿßÿ± ÿßŸÑŸÖŸàÿ∏ŸÅ ŸàÿßŸÑÿ¥Ÿáÿ±');
                return;
            }
            
            const employee = employees.find(emp => emp.name === employeeName && emp.active);
            if (!employee) {
                alert('ÿßŸÑŸÖŸàÿ∏ŸÅ ÿ∫Ÿäÿ± ŸÖŸàÿ¨ŸàÿØ ÿ£Ÿà ÿ∫Ÿäÿ± ŸÅÿπÿßŸÑ');
                return;
            }
            
            const reportData = prepareEmployeeMonthlyReport(employee, month);
            
            currentReportData = reportData;
            
            displayEmployeeReport(reportData, employee, month);
        }

        function prepareEmployeeMonthlyReport(employee, month) {
            const reportData = {
                employeeName: employee.name,
                month: month,
                attendance: [],
                leaves: [],
                financials: [],
                summary: {
                    totalPresent: 0,
                    totalAbsent: 0,
                    totalLeaves: 0,
                    totalRewards: 0,
                    totalLoans: 0,
                    totalDeductions: 0,
                    netSalary: 0,
                    extraDays: 0,
                    extraSalary: 0,
                    baseSalary: 0
                }
            };
            
            const monthAttendance = attendance.filter(record => 
                record.employeeName === employee.name && 
                record.date.startsWith(month)
            );
            
            reportData.attendance = monthAttendance;
            
            reportData.summary.totalPresent = monthAttendance.filter(a => a.status === 'ÿ≠ÿßÿ∂ÿ±').length;
            reportData.summary.totalAbsent = monthAttendance.filter(a => a.status === 'ÿ∫ÿßÿ¶ÿ®').length;
            reportData.summary.totalLeaves = monthAttendance.filter(a => a.status === 'ÿ•ÿ¨ÿßÿ≤ÿ©').length;
            
            const monthLeaves = leaves.filter(leave => 
                leave.employeeName === employee.name && 
                leave.start.startsWith(month)
            );
            
            reportData.leaves = monthLeaves;
            
            const monthFinancials = financials.filter(f => 
                f.employeeName === employee.name && 
                f.date.startsWith(month)
            );
            
            reportData.financials = monthFinancials;
            
            reportData.summary.totalRewards = monthFinancials
                .filter(f => f.type === 'ŸÖŸÉÿßŸÅÿ£ÿ©')
                .reduce((sum, f) => sum + f.amount, 0);
            
            reportData.summary.totalLoans = monthFinancials
                .filter(f => f.type === 'ÿ≥ŸÑŸÅÿ©')
                .reduce((sum, f) => sum + f.amount, 0);
            
            reportData.summary.totalDeductions = monthFinancials
                .filter(f => f.type === 'ÿÆÿµŸÖ')
                .reduce((sum, f) => sum + f.amount, 0);
            
            const dailyRate = employee.salary / 30;
            let netSalary = 0;
            let extraDays = 0;
            let extraSalary = 0;
            let baseSalary = 0;
            
            if (reportData.summary.totalPresent >= employee.workDays) {
                baseSalary = employee.salary;
                
                if (reportData.summary.totalPresent > employee.workDays) {
                    extraDays = reportData.summary.totalPresent - employee.workDays;
                    extraSalary = extraDays * dailyRate;
                    netSalary = baseSalary + extraSalary;
                } else {
                    netSalary = baseSalary;
                }
            } else {
                baseSalary = reportData.summary.totalPresent * dailyRate;
                netSalary = baseSalary;
            }
            
            netSalary = netSalary + reportData.summary.totalRewards - 
                        reportData.summary.totalLoans - reportData.summary.totalDeductions;
            
            reportData.summary.baseSalary = baseSalary;
            reportData.summary.extraDays = extraDays;
            reportData.summary.extraSalary = extraSalary;
            reportData.summary.netSalary = Math.round(netSalary);
            
            return reportData;
        }

        function displayEmployeeReport(reportData, employee, month) {
            const container = document.getElementById('employeeReportContainer');
            
            container.innerHTML = `
                <div class="employee-report-card">
                    <div class="employee-report-header">
                        <i class="fas fa-user"></i> ÿ™ŸÇÿ±Ÿäÿ± ${employee.name} - ${month}
                    </div>
                    <div class="employee-report-body">
                        <div class="report-info-grid">
                            <div class="report-info-item">
                                <span class="report-info-label">ÿßŸÑŸàÿ∏ŸäŸÅÿ©</span>
                                <span class="report-info-value">${employee.job}</span>
                            </div>
                            <div class="report-info-item">
                                <span class="report-info-label">ÿßŸÑÿ±ÿßÿ™ÿ® ÿßŸÑÿ£ÿ≥ÿßÿ≥Ÿä</span>
                                <span class="report-info-value">${employee.salary} ÿ¨.ŸÖ</span>
                            </div>
                            <div class="report-info-item">
                                <span class="report-info-label">ÿ£ŸäÿßŸÖ ÿßŸÑÿπŸÖŸÑ ÿßŸÑŸÖÿ™ŸÅŸÇ ÿπŸÑŸäŸáÿß</span>
                                <span class="report-info-value">${employee.workDays} ŸäŸàŸÖ</span>
                            </div>
                            <div class="report-info-item">
                                <span class="report-info-label">ÿ±ŸÇŸÖ ÿßŸÑŸáÿßÿ™ŸÅ</span>
                                <span class="report-info-value">${employee.phone}</span>
                            </div>
                        </div>
                        
                        <div class="attendance-stats">
                            <div class="attendance-stat present">
                                <div class="attendance-stat-value">${reportData.summary.totalPresent}</div>
                                <div class="attendance-stat-label">ÿ£ŸäÿßŸÖ ÿßŸÑÿ≠ÿ∂Ÿàÿ±</div>
                            </div>
                            <div class="attendance-stat absent">
                                <div class="attendance-stat-value">${reportData.summary.totalAbsent}</div>
                                <div class="attendance-stat-label">ÿ£ŸäÿßŸÖ ÿßŸÑÿ∫Ÿäÿßÿ®</div>
                            </div>
                            <div class="attendance-stat leave">
                                <div class="attendance-stat-value">${reportData.summary.totalLeaves}</div>
                                <div class="attendance-stat-label">ÿ£ŸäÿßŸÖ ÿßŸÑÿ•ÿ¨ÿßÿ≤ÿ©</div>
                            </div>
                        </div>
                        
                        <div class="daily-report-table">
                            <h4 style="padding: 15px; margin: 0; background: #f8f9fa; border-bottom: 2px solid var(--primary);">
                                <i class="fas fa-calendar-alt"></i> ÿßŸÑÿ™ŸÅÿßÿµŸäŸÑ ÿßŸÑŸäŸàŸÖŸäÿ©
                            </h4>
                            <table>
                                <thead>
                                    <tr>
                                        <th>ÿßŸÑŸäŸàŸÖ</th>
                                        <th>ÿßŸÑÿ™ÿßÿ±ŸäÿÆ</th>
                                        <th>ÿßŸÑŸÖÿ≠ÿ∑ÿ©</th>
                                        <th>ÿßŸÑŸÖÿ≥ÿ§ŸàŸÑ</th>
                                        <th>ÿßŸÑÿ≠ÿßŸÑÿ©</th>
                                        <th>ŸÖŸÑÿßÿ≠ÿ∏ÿßÿ™</th>
                                    </tr>
                                </thead>
                                <tbody id="dailyDetailsBody"></tbody>
                            </table>
                        </div>
                        
                        <div class="salary-summary">
                            <h4><i class="fas fa-chart-pie"></i> ŸÖŸÑÿÆÿµ ÿßŸÑÿ±ÿßÿ™ÿ® ÿßŸÑÿ¥Ÿáÿ±Ÿä</h4>
                            <div class="salary-breakdown">
                                <div class="breakdown-item">
                                    <div class="breakdown-label">ÿßŸÑÿ±ÿßÿ™ÿ® ÿßŸÑÿ£ÿ≥ÿßÿ≥Ÿä</div>
                                    <div class="breakdown-value">${reportData.summary.baseSalary.toFixed(2)} ÿ¨.ŸÖ</div>
                                </div>
                                ${reportData.summary.extraDays > 0 ? `
                                <div class="breakdown-item">
                                    <div class="breakdown-label">ÿßŸÑÿ£ŸäÿßŸÖ ÿßŸÑÿ•ÿ∂ÿßŸÅŸäÿ©</div>
                                    <div class="breakdown-value positive">+ ${reportData.summary.extraDays} ŸäŸàŸÖ</div>
                                </div>
                                <div class="breakdown-item">
                                    <div class="breakdown-label">ŸÇŸäŸÖÿ© ÿßŸÑÿ£ŸäÿßŸÖ ÿßŸÑÿ•ÿ∂ÿßŸÅŸäÿ©</div>
                                    <div class="breakdown-value positive">+ ${reportData.summary.extraSalary.toFixed(2)} ÿ¨.ŸÖ</div>
                                </div>
                                ` : ''}
                                <div class="breakdown-item">
                                    <div class="breakdown-label">ÿßŸÑŸÖŸÉÿßŸÅÿ¢ÿ™</div>
                                    <div class="breakdown-value positive">+ ${reportData.summary.totalRewards} ÿ¨.ŸÖ</div>
                                </div>
                                <div class="breakdown-item">
                                    <div class="breakdown-label">ÿßŸÑÿ≥ŸÑŸÅ</div>
                                    <div class="breakdown-value negative">- ${reportData.summary.totalLoans} ÿ¨.ŸÖ</div>
                                </div>
                                <div class="breakdown-item">
                                    <div class="breakdown-label">ÿßŸÑÿÆÿµŸàŸÖÿßÿ™</div>
                                    <div class="breakdown-value negative">- ${reportData.summary.totalDeductions} ÿ¨.ŸÖ</div>
                                </div>
                            </div>
                            <div class="net-salary">
                                <h3>ÿµÿßŸÅŸä ÿßŸÑÿ±ÿßÿ™ÿ®: ${reportData.summary.netSalary} ÿ¨.ŸÖ</h3>
                            </div>
                        </div>
                        
                        <div style="display: flex; gap: 10px; margin-top: 20px;">
                            <button class="btn-success" onclick="exportEmployeeReportToExcel()" style="flex: 1;">
                                <i class="fas fa-download"></i> ÿ™ÿµÿØŸäÿ± ÿßŸÑÿ™ŸÇÿ±Ÿäÿ±
                            </button>
                            <button class="btn-whatsapp" onclick="sendEmployeeReportWhatsApp()" style="flex: 1;">
                                <i class="fab fa-whatsapp"></i> ÿ•ÿ±ÿ≥ÿßŸÑ ÿπÿ®ÿ± Ÿàÿßÿ™ÿ≥ÿßÿ®
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            const dailyBody = document.getElementById('dailyDetailsBody');
            dailyBody.innerHTML = '';
            
            const [year, monthNum] = month.split('-').map(Number);
            const daysInMonth = new Date(year, monthNum, 0).getDate();
            const arabicDays = ['ÿßŸÑÿ£ÿ≠ÿØ', 'ÿßŸÑÿ•ÿ´ŸÜŸäŸÜ', 'ÿßŸÑÿ´ŸÑÿßÿ´ÿßÿ°', 'ÿßŸÑÿ£ÿ±ÿ®ÿπÿßÿ°', 'ÿßŸÑÿÆŸÖŸäÿ≥', 'ÿßŸÑÿ¨ŸÖÿπÿ©', 'ÿßŸÑÿ≥ÿ®ÿ™'];
            
            for (let day = 1; day <= daysInMonth; day++) {
                const dateStr = `${year}-${monthNum.toString().padStart(2, '0')}-${day.toString().padStart(2, '0')}`;
                const dateObj = new Date(dateStr);
                const dayName = arabicDays[dateObj.getDay()];
                
                const attendanceRecord = reportData.attendance.find(a => a.date === dateStr);
                let status = 'ŸÑŸÖ Ÿäÿ™ŸÖ ÿßŸÑÿ™ÿ≥ÿ¨ŸäŸÑ';
                let statusClass = '';
                let stationName = '';
                let supervisorName = '';
                let notes = '';
                
                if (attendanceRecord) {
                    status = attendanceRecord.status;
                    stationName = attendanceRecord.stationName || 'ÿ∫Ÿäÿ± ŸÖÿ≠ÿØÿØ';
                    
                    const supervisor = supervisors.find(sup => sup.id === attendanceRecord.supervisorId);
                    supervisorName = supervisor ? supervisor.employeeName : (attendanceRecord.supervisorName || 'ÿ∫Ÿäÿ± ŸÖÿ≠ÿØÿØ');
                    
                    if (status === 'ÿ≠ÿßÿ∂ÿ±') statusClass = 'status-present';
                    else if (status === 'ÿ∫ÿßÿ¶ÿ®') statusClass = 'status-absent';
                    else if (status === 'ÿ•ÿ¨ÿßÿ≤ÿ©') statusClass = 'status-leave';
                    
                    const leaveRecord = reportData.leaves.find(l => {
                        const startDate = new Date(l.start);
                        const endDate = new Date(l.end);
                        const currentDate = new Date(dateStr);
                        return currentDate >= startDate && currentDate <= endDate;
                    });
                    
                    if (leaveRecord) {
                        notes = `ÿ•ÿ¨ÿßÿ≤ÿ©: ${leaveRecord.type}`;
                        if (leaveRecord.notes) {
                            notes += ` - ${leaveRecord.notes}`;
                        }
                    }
                }
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="day-name">${dayName}</td>
                    <td>${dateStr}</td>
                    <td>${stationName}</td>
                    <td>${supervisorName}</td>
                    <td class="${statusClass}">${status}</td>
                    <td>${notes}</td>
                `;
                dailyBody.appendChild(row);
            }
            
            container.style.display = 'block';
            container.scrollIntoView({ behavior: 'smooth' });
        }

        function exportEmployeeReportToExcel() {
            if (!currentReportData) {
                alert('ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ®ŸäÿßŸÜÿßÿ™ ŸÑŸÑÿ™ÿµÿØŸäÿ±. Ÿäÿ±ÿ¨Ÿâ ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑÿ™ŸÇÿ±Ÿäÿ± ÿ£ŸàŸÑÿßŸã.');
                return;
            }
            
            const employeeName = currentReportData.employeeName;
            const month = currentReportData.month;
            const summary = currentReportData.summary;
            
            const exportData = [];
            
            exportData.push(['ÿ™ŸÇÿ±Ÿäÿ± ÿßŸÑŸÖŸàÿ∏ŸÅ ÿßŸÑÿ¥Ÿáÿ±Ÿä', '', '', '', '', '']);
            exportData.push(['ÿßÿ≥ŸÖ ÿßŸÑŸÖŸàÿ∏ŸÅ', employeeName, '', '', '', '']);
            exportData.push(['ÿßŸÑÿ¥Ÿáÿ±', month, '', '', '', '']);
            exportData.push(['', '', '', '', '', '']);
            
            exportData.push(['ÿ™ŸÅÿßÿµŸäŸÑ ÿßŸÑÿ±ÿßÿ™ÿ®', '', '', '', '', '']);
            exportData.push(['ÿßŸÑÿ±ÿßÿ™ÿ® ÿßŸÑÿ£ÿ≥ÿßÿ≥Ÿä', `${summary.baseSalary.toFixed(2)} ÿ¨.ŸÖ`, '', '', '', '']);
            exportData.push(['ÿ£ŸäÿßŸÖ ÿßŸÑÿ≠ÿ∂Ÿàÿ±', `${summary.totalPresent} ŸäŸàŸÖ`, '', '', '', '']);
            
            if (summary.extraDays > 0) {
                exportData.push(['ÿßŸÑÿ£ŸäÿßŸÖ ÿßŸÑÿ•ÿ∂ÿßŸÅŸäÿ©', `${summary.extraDays} ŸäŸàŸÖ`, '', '', '', '']);
                exportData.push(['ŸÇŸäŸÖÿ© ÿßŸÑÿ£ŸäÿßŸÖ ÿßŸÑÿ•ÿ∂ÿßŸÅŸäÿ©', `${summary.extraSalary.toFixed(2)} ÿ¨.ŸÖ`, '', '', '', '']);
            }
            
            exportData.push(['ÿßŸÑŸÖŸÉÿßŸÅÿ¢ÿ™', `${summary.totalRewards} ÿ¨.ŸÖ`, '', '', '', '']);
            exportData.push(['ÿßŸÑÿ≥ŸÑŸÅ', `${summary.totalLoans} ÿ¨.ŸÖ`, '', '', '', '']);
            exportData.push(['ÿßŸÑÿÆÿµŸàŸÖÿßÿ™', `${summary.totalDeductions} ÿ¨.ŸÖ`, '', '', '', '']);
            exportData.push(['ÿµÿßŸÅŸä ÿßŸÑÿ±ÿßÿ™ÿ®', `${summary.netSalary} ÿ¨.ŸÖ`, '', '', '', '']);
            
            exportData.push(['', '', '', '', '', '']);
            
            exportData.push(['ÿßŸÑÿ™ŸÅÿßÿµŸäŸÑ ÿßŸÑŸäŸàŸÖŸäÿ©', '', '', '', '', '']);
            exportData.push(['ÿßŸÑŸäŸàŸÖ', 'ÿßŸÑÿ™ÿßÿ±ŸäÿÆ', 'ÿßŸÑŸÖÿ≠ÿ∑ÿ©', 'ÿßŸÑŸÖÿ≥ÿ§ŸàŸÑ', 'ÿßŸÑÿ≠ÿßŸÑÿ©', 'ŸÖŸÑÿßÿ≠ÿ∏ÿßÿ™']);
            
            const [year, monthNum] = month.split('-').map(Number);
            const daysInMonth = new Date(year, monthNum, 0).getDate();
            const arabicDays = ['ÿßŸÑÿ£ÿ≠ÿØ', 'ÿßŸÑÿ•ÿ´ŸÜŸäŸÜ', 'ÿßŸÑÿ´ŸÑÿßÿ´ÿßÿ°', 'ÿßŸÑÿ£ÿ±ÿ®ÿπÿßÿ°', 'ÿßŸÑÿÆŸÖŸäÿ≥', 'ÿßŸÑÿ¨ŸÖÿπÿ©', 'ÿßŸÑÿ≥ÿ®ÿ™'];
            
            for (let day = 1; day <= daysInMonth; day++) {
                const dateStr = `${year}-${monthNum.toString().padStart(2, '0')}-${day.toString().padStart(2, '0')}`;
                const dateObj = new Date(dateStr);
                const dayName = arabicDays[dateObj.getDay()];
                
                const attendanceRecord = currentReportData.attendance.find(a => a.date === dateStr);
                let status = 'ŸÑŸÖ Ÿäÿ™ŸÖ ÿßŸÑÿ™ÿ≥ÿ¨ŸäŸÑ';
                let stationName = '';
                let supervisorName = '';
                let notes = '';
                
                if (attendanceRecord) {
                    status = attendanceRecord.status;
                    stationName = attendanceRecord.stationName || 'ÿ∫Ÿäÿ± ŸÖÿ≠ÿØÿØ';
                    
                    const supervisor = supervisors.find(sup => sup.id === attendanceRecord.supervisorId);
                    supervisorName = supervisor ? supervisor.employeeName : (attendanceRecord.supervisorName || 'ÿ∫Ÿäÿ± ŸÖÿ≠ÿØÿØ');
                    
                    const leaveRecord = currentReportData.leaves.find(l => {
                        const startDate = new Date(l.start);
                        const endDate = new Date(l.end);
                        const currentDate = new Date(dateStr);
                        return currentDate >= startDate && currentDate <= endDate;
                    });
                    
                    if (leaveRecord) {
                        notes = `ÿ•ÿ¨ÿßÿ≤ÿ©: ${leaveRecord.type}`;
                        if (leaveRecord.notes) {
                            notes += ` - ${leaveRecord.notes}`;
                        }
                    }
                }
                
                exportData.push([dayName, dateStr, stationName, supervisorName, status, notes]);
            }
            
            const worksheet = XLSX.utils.aoa_to_sheet(exportData);
            const workbook = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(workbook, worksheet, "ÿ™ŸÇÿ±Ÿäÿ± ÿßŸÑŸÖŸàÿ∏ŸÅ");
            
            const fileName = `ÿ™ŸÇÿ±Ÿäÿ±_${employeeName}_${month}.xlsx`;
            XLSX.writeFile(workbook, fileName);
            
            alert(`ÿ™ŸÖ ÿ™ÿµÿØŸäÿ± ÿßŸÑÿ™ŸÇÿ±Ÿäÿ± ÿ®ŸÜÿ¨ÿßÿ≠ ÿ®ÿßÿ≥ŸÖ: ${fileName}`);
        }

        function sendEmployeeReportWhatsApp() {
            if (!currentReportData) {
                alert('ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ®ŸäÿßŸÜÿßÿ™ ŸÑŸÑÿ•ÿ±ÿ≥ÿßŸÑ. Ÿäÿ±ÿ¨Ÿâ ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑÿ™ŸÇÿ±Ÿäÿ± ÿ£ŸàŸÑÿßŸã.');
                return;
            }
            
            const employee = employees.find(emp => emp.name === currentReportData.employeeName);
            if (!employee) return;
            
            const summary = currentReportData.summary;
            const month = currentReportData.month;
            
            const message = `ŸÖÿ±ÿ≠ÿ®ÿßŸã ${employee.name}ÿå

ÿ™ŸÅÿßÿµŸäŸÑ ÿ±ÿßÿ™ÿ®ŸÉ ŸÑÿ¥Ÿáÿ± ${month}:
- ÿßŸÑÿ±ÿßÿ™ÿ® ÿßŸÑÿ£ÿ≥ÿßÿ≥Ÿä: ${employee.salary} ÿ¨.ŸÖ
- ÿ£ŸäÿßŸÖ ÿßŸÑÿπŸÖŸÑ ÿßŸÑŸÖÿ™ŸÅŸÇ ÿπŸÑŸäŸáÿß: ${employee.workDays} ŸäŸàŸÖ
- ÿ£ŸäÿßŸÖ ÿßŸÑÿ≠ÿ∂Ÿàÿ±: ${summary.totalPresent} ŸäŸàŸÖ
${summary.extraDays > 0 ? `- ÿßŸÑÿ£ŸäÿßŸÖ ÿßŸÑÿ•ÿ∂ÿßŸÅŸäÿ©: ${summary.extraDays} ŸäŸàŸÖ\n- ŸÇŸäŸÖÿ© ÿßŸÑÿ£ŸäÿßŸÖ ÿßŸÑÿ•ÿ∂ÿßŸÅŸäÿ©: ${summary.extraSalary.toFixed(2)} ÿ¨.ŸÖ` : ''}
- ÿßŸÑÿ≥ŸÑŸÅ: ${summary.totalLoans} ÿ¨.ŸÖ
- ÿßŸÑŸÖŸÉÿßŸÅÿ¢ÿ™: ${summary.totalRewards} ÿ¨.ŸÖ
- ÿßŸÑÿÆÿµŸàŸÖÿßÿ™: ${summary.totalDeductions} ÿ¨.ŸÖ
- ÿµÿßŸÅŸä ÿßŸÑÿ±ÿßÿ™ÿ®: ${summary.netSalary} ÿ¨.ŸÖ

ÿ¥ŸÉÿ±ÿßŸã ŸÑÿ¨ŸáŸàÿØŸÉ!`;
            
            const encodedMessage = encodeURIComponent(message);
            const whatsappNumber = employee.whatsapp || employee.phone;
            const whatsappUrl = `https://wa.me/${whatsappNumber}?text=${encodedMessage}`;
            window.open(whatsappUrl, '_blank');
        }

        // ==================== ÿØŸàÿßŸÑ ÿßŸÑÿßÿ≥ÿ™Ÿäÿ±ÿßÿØ ŸàÿßŸÑÿ™ÿµÿØŸäÿ± ====================

        function downloadTemplate() {
            const templateData = [
                ['ÿßÿ≥ŸÖ ÿßŸÑŸÖŸàÿ∏ŸÅ', 'ÿ±ŸÇŸÖ ÿßŸÑŸáÿßÿ™ŸÅ', 'ÿ±ŸÇŸÖ ÿßŸÑŸàÿßÿ™ÿ≥ÿßÿ®', 'ÿßŸÑÿπŸÜŸàÿßŸÜ'],
                ['ÿ£ÿ≠ŸÖÿØ ŸÖÿ≠ŸÖÿØ', '01234567890', '01234567890', 'ÿßŸÑŸÇÿßŸáÿ±ÿ© - ŸÖÿµÿ±'],
                ['ŸÖÿ≠ŸÖÿØ ÿπŸÑŸä', '01112223344', '01112223344', 'ÿßŸÑÿ¨Ÿäÿ≤ÿ© - ŸÖÿµÿ±'],
                ['ÿ≥ÿßÿ±ÿ© ÿ£ÿ≠ŸÖÿØ', '01005556677', '01005556677', 'ÿßŸÑÿ•ÿ≥ŸÉŸÜÿØÿ±Ÿäÿ© - ŸÖÿµÿ±']
            ];
            
            const worksheet = XLSX.utils.aoa_to_sheet(templateData);
            const workbook = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(workbook, worksheet, "ÿßŸÑŸÖŸàÿ∏ŸÅŸäŸÜ");
            XLSX.writeFile(workbook, 'ŸÜŸÖŸàÿ∞ÿ¨_ÿßÿ≥ÿ™Ÿäÿ±ÿßÿØ_ÿßŸÑŸÖŸàÿ∏ŸÅŸäŸÜ.xlsx');
        }

        function previewImport() {
            const fileInput = document.getElementById('importFile');
            const file = fileInput.files[0];
            
            if (!file) {
                alert('Ÿäÿ±ÿ¨Ÿâ ÿßÿÆÿ™Ÿäÿßÿ± ŸÖŸÑŸÅ Excel ÿ£Ÿà CSV ÿ£ŸàŸÑÿßŸã');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    let jsonData = [];
                    
                    if (file.name.endsWith('.csv')) {
                        jsonData = parseCSV(e.target.result);
                    } else {
                        const data = new Uint8Array(e.target.result);
                        const workbook = XLSX.read(data, { type: 'array' });
                        const worksheet = workbook.Sheets[workbook.SheetNames[0]];
                        jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1 });
                    }
                    
                    if (jsonData.length <= 1) {
                        alert('ÿßŸÑŸÖŸÑŸÅ ŸÑÿß Ÿäÿ≠ÿ™ŸàŸä ÿπŸÑŸâ ÿ®ŸäÿßŸÜÿßÿ™ ÿ£Ÿà ÿ™ŸÜÿ≥ŸäŸÇŸá ÿ∫Ÿäÿ± ÿµÿ≠Ÿäÿ≠');
                        return;
                    }
                    
                    const headers = jsonData[0];
                    const expectedHeaders = ['ÿßÿ≥ŸÖ ÿßŸÑŸÖŸàÿ∏ŸÅ', 'ÿ±ŸÇŸÖ ÿßŸÑŸáÿßÿ™ŸÅ', 'ÿ±ŸÇŸÖ ÿßŸÑŸàÿßÿ™ÿ≥ÿßÿ®', 'ÿßŸÑÿπŸÜŸàÿßŸÜ'];
                    let headersValid = true;
                    
                    for (let i = 0; i < expectedHeaders.length; i++) {
                        if (headers[i] !== expectedHeaders[i]) {
                            headersValid = false;
                            break;
                        }
                    }
                    
                    if (!headersValid) {
                        alert('ÿ™ŸÜÿ≥ŸäŸÇ ÿßŸÑŸÖŸÑŸÅ ÿ∫Ÿäÿ± ÿµÿ≠Ÿäÿ≠. Ÿäÿ±ÿ¨Ÿâ ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ÿßŸÑŸÜŸÖŸàÿ∞ÿ¨ ÿßŸÑŸÖÿ±ŸÅŸÇ.');
                        return;
                    }
                    
                    const previewTable = document.getElementById('previewTable');
                    const tbody = previewTable.querySelector('tbody');
                    tbody.innerHTML = '';
                    
                    for (let i = 1; i < jsonData.length; i++) {
                        const row = jsonData[i];
                        if (row.length === 0) continue;
                        
                        const tr = document.createElement('tr');
                        for (let j = 0; j < 4; j++) {
                            const td = document.createElement('td');
                            td.textContent = row[j] || '';
                            tr.appendChild(td);
                        }
                        tbody.appendChild(tr);
                    }
                    
                    document.getElementById('importPreview').style.display = 'block';
                    document.getElementById('importStatus').style.display = 'none';
                    
                } catch (error) {
                    console.error('ÿÆÿ∑ÿ£ ŸÅŸä ŸÖÿπÿßŸäŸÜÿ© ÿßŸÑŸÖŸÑŸÅ:', error);
                    alert('ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ŸÅŸä ŸÖÿπÿßŸäŸÜÿ© ÿßŸÑŸÖŸÑŸÅ. Ÿäÿ±ÿ¨Ÿâ ÿßŸÑÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿµÿ≠ÿ© ÿßŸÑŸÖŸÑŸÅ ŸàÿßŸÑŸÖÿ≠ÿßŸàŸÑÿ© ŸÖÿ±ÿ© ÿ£ÿÆÿ±Ÿâ.');
                }
            };
            
            if (file.name.endsWith('.csv')) {
                reader.readAsText(file);
            } else {
                reader.readAsArrayBuffer(file);
            }
        }

        function parseCSV(csvText) {
            const lines = csvText.split('\n');
            const result = [];
            
            for (let i = 0; i < lines.length; i++) {
                if (lines[i].trim() === '') continue;
                const regex = /(?:,|\n|^)(?:"([^"]*(?:""[^"]*)*)"|([^",\n]*))/g;
                let matches;
                const row = [];
                
                while ((matches = regex.exec(lines[i])) !== null) {
                    let value = matches[1] || matches[2];
                    if (value) {
                        value = value.replace(/""/g, '"');
                    }
                    row.push(value || '');
                }
                
                result.push(row);
            }
            
            return result;
        }

        function importEmployees() {
            const fileInput = document.getElementById('importFile');
            const file = fileInput.files[0];
            
            if (!file) {
                alert('Ÿäÿ±ÿ¨Ÿâ ÿßÿÆÿ™Ÿäÿßÿ± ŸÖŸÑŸÅ Excel ÿ£Ÿà CSV ÿ£ŸàŸÑÿßŸã');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    let jsonData = [];
                    
                    if (file.name.endsWith('.csv')) {
                        jsonData = parseCSV(e.target.result);
                    } else {
                        const data = new Uint8Array(e.target.result);
                        const workbook = XLSX.read(data, { type: 'array' });
                        const worksheet = workbook.Sheets[workbook.SheetNames[0]];
                        jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1 });
                    }
                    
                    if (jsonData.length <= 1) {
                        alert('ÿßŸÑŸÖŸÑŸÅ ŸÑÿß Ÿäÿ≠ÿ™ŸàŸä ÿπŸÑŸâ ÿ®ŸäÿßŸÜÿßÿ™');
                        return;
                    }
                    
                    const headers = jsonData[0];
                    const expectedHeaders = ['ÿßÿ≥ŸÖ ÿßŸÑŸÖŸàÿ∏ŸÅ', 'ÿ±ŸÇŸÖ ÿßŸÑŸáÿßÿ™ŸÅ', 'ÿ±ŸÇŸÖ ÿßŸÑŸàÿßÿ™ÿ≥ÿßÿ®', 'ÿßŸÑÿπŸÜŸàÿßŸÜ'];
                    let headersValid = true;
                    
                    for (let i = 0; i < expectedHeaders.length; i++) {
                        if (headers[i] !== expectedHeaders[i]) {
                            headersValid = false;
                            break;
                        }
                    }
                    
                    if (!headersValid) {
                        alert('ÿ™ŸÜÿ≥ŸäŸÇ ÿßŸÑŸÖŸÑŸÅ ÿ∫Ÿäÿ± ÿµÿ≠Ÿäÿ≠. Ÿäÿ±ÿ¨Ÿâ ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ÿßŸÑŸÜŸÖŸàÿ∞ÿ¨ ÿßŸÑŸÖÿ±ŸÅŸÇ.');
                        return;
                    }
                    
                    const employeesToAdd = [];
                    const errors = [];
                    
                    for (let i = 1; i < jsonData.length; i++) {
                        const row = jsonData[i];
                        if (row.length === 0) continue;
                        
                        const name = row[0] ? row[0].toString().trim() : '';
                        const phone = row[1] ? row[1].toString().trim() : '';
                        const whatsapp = row[2] ? row[2].toString().trim() : phone;
                        const address = row[3] ? row[3].toString().trim() : '';
                        
                        if (!name || !phone) {
                            errors.push(`ÿßŸÑÿµŸÅ ${i+1}: ÿßŸÑÿßÿ≥ŸÖ Ÿàÿ±ŸÇŸÖ ÿßŸÑŸáÿßÿ™ŸÅ ŸÖÿ∑ŸÑŸàÿ®ÿßŸÜ`);
                            continue;
                        }
                        
                        if (!isValidPhone(phone)) {
                            errors.push(`ÿßŸÑÿµŸÅ ${i+1}: ÿ±ŸÇŸÖ ÿßŸÑŸáÿßÿ™ŸÅ ${phone} ÿ∫Ÿäÿ± ÿµÿ≠Ÿäÿ≠`);
                            continue;
                        }
                        
                        const isDuplicate = employeeDatabase.some(emp => 
                            emp.name === name || emp.phone === phone
                        );
                        
                        if (isDuplicate) {
                            errors.push(`ÿßŸÑÿµŸÅ ${i+1}: ÿßŸÑŸÖŸàÿ∏ŸÅ ${name} ŸÖŸàÿ¨ŸàÿØ ŸÖÿ≥ÿ®ŸÇÿßŸã`);
                            continue;
                        }
                        
                        employeesToAdd.push({
                            name,
                            phone,
                            whatsapp,
                            address,
                            active: false
                        });
                    }
                    
                    const statusDiv = document.getElementById('importStatus');
                    
                    if (employeesToAdd.length === 0 && errors.length === 0) {
                        statusDiv.innerHTML = '<div class="import-warning">ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ®ŸäÿßŸÜÿßÿ™ ÿµÿßŸÑÿ≠ÿ© ŸÑŸÑÿ•ÿ∂ÿßŸÅÿ©</div>';
                        statusDiv.style.display = 'block';
                        return;
                    }
                    
                    if (employeesToAdd.length > 0) {
                        showLoadingState(true);
                        
                        const promises = employeesToAdd.map(employee => 
                            addData('employeeDatabase', employee)
                        );
                        
                        Promise.allSettled(promises)
                            .then(results => {
                                showLoadingState(false);
                                
                                const successful = results.filter(r => r.status === 'fulfilled').length;
                                const failed = results.filter(r => r.status === 'rejected').length;
                                
                                let statusMessage = `<div class="import-success">ÿ™ŸÖ ÿ•ÿ∂ÿßŸÅÿ© ${successful} ŸÖŸàÿ∏ŸÅ ÿ®ŸÜÿ¨ÿßÿ≠</div>`;
                                
                                if (failed > 0) {
                                    statusMessage += `<div class="import-warning">ŸÅÿ¥ŸÑ ŸÅŸä ÿ•ÿ∂ÿßŸÅÿ© ${failed} ŸÖŸàÿ∏ŸÅ</div>`;
                                }
                                
                                if (errors.length > 0) {
                                    statusMessage += `<div class="import-error"><strong>ÿßŸÑÿ£ÿÆÿ∑ÿßÿ°:</strong><ul>`;
                                    errors.forEach(error => {
                                        statusMessage += `<li>${error}</li>`;
                                    });
                                    statusMessage += `</ul></div>`;
                                }
                                
                                statusDiv.innerHTML = statusMessage;
                                statusDiv.style.display = 'block';
                                
                                document.getElementById('importFile').value = '';
                                document.getElementById('importPreview').style.display = 'none';
                                
                                loadAllData();
                            })
                            .catch(error => {
                                showLoadingState(false);
                                statusDiv.innerHTML = `<div class="import-error">ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ÿ£ÿ´ŸÜÿßÿ° ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑŸÖŸàÿ∏ŸÅŸäŸÜ: ${error.message}</div>`;
                                statusDiv.style.display = 'block';
                            });
                    } else {
                        statusDiv.innerHTML = `<div class="import-error"><strong>ŸÑŸÖ Ÿäÿ™ŸÖ ÿ•ÿ∂ÿßŸÅÿ© ÿ£Ÿä ŸÖŸàÿ∏ŸÅ:</strong><ul>`;
                        errors.forEach(error => {
                            statusDiv.innerHTML += `<li>${error}</li>`;
                        });
                        statusDiv.innerHTML += `</ul></div>`;
                        statusDiv.style.display = 'block';
                    }
                    
                } catch (error) {
                    console.error('ÿÆÿ∑ÿ£ ŸÅŸä ÿßÿ≥ÿ™Ÿäÿ±ÿßÿØ ÿßŸÑŸÖŸÑŸÅ:', error);
                    alert('ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ŸÅŸä ÿßÿ≥ÿ™Ÿäÿ±ÿßÿØ ÿßŸÑŸÖŸÑŸÅ. Ÿäÿ±ÿ¨Ÿâ ÿßŸÑÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿµÿ≠ÿ© ÿßŸÑŸÖŸÑŸÅ ŸàÿßŸÑŸÖÿ≠ÿßŸàŸÑÿ© ŸÖÿ±ÿ© ÿ£ÿÆÿ±Ÿâ.');
                }
            };
            
            if (file.name.endsWith('.csv')) {
                reader.readAsText(file);
            } else {
                reader.readAsArrayBuffer(file);
            }
        }

        function isValidPhone(phone) {
            const phoneRegex = /^[0-9]{10,15}$/;
            return phoneRegex.test(phone);
        }

        function importFromDatabase() {
            const selectElement = document.getElementById('selectMultipleEmployees');
            const selectedOptions = Array.from(selectElement.selectedOptions);
            
            if (selectedOptions.length === 0) {
                alert('Ÿäÿ±ÿ¨Ÿâ ÿßÿÆÿ™Ÿäÿßÿ± ŸÖŸàÿ∏ŸÅŸäŸÜ ÿπŸÑŸâ ÿßŸÑÿ£ŸÇŸÑ');
                return;
            }
            
            const defaultJob = document.getElementById('defaultJob').value;
            const defaultSalary = parseInt(document.getElementById('defaultSalary').value) || 0;
            const defaultWorkDays = parseInt(document.getElementById('defaultWorkDays').value) || 24;
            
            if (!defaultJob) {
                alert('Ÿäÿ±ÿ¨Ÿâ ÿ•ÿØÿÆÿßŸÑ ÿßŸÑŸàÿ∏ŸäŸÅÿ© ÿßŸÑÿßŸÅÿ™ÿ±ÿßÿ∂Ÿäÿ©');
                return;
            }
            
            if (defaultSalary <= 0) {
                alert('Ÿäÿ±ÿ¨Ÿâ ÿ•ÿØÿÆÿßŸÑ ÿ±ÿßÿ™ÿ® ÿ£ÿ≥ÿßÿ≥Ÿä ÿµÿ≠Ÿäÿ≠');
                return;
            }
            
            showLoadingState(true);
            
            const promises = selectedOptions.map(option => {
                const employeeId = option.value;
                const employee = employeeDatabase.find(emp => emp.id === employeeId);
                
                if (!employee) {
                    return Promise.reject(`ÿßŸÑŸÖŸàÿ∏ŸÅ ÿ∫Ÿäÿ± ŸÖŸàÿ¨ŸàÿØ: ${option.textContent}`);
                }
                
                const isAlreadyAdded = employees.some(emp => emp.phone === employee.phone);
                
                if (isAlreadyAdded) {
                    return Promise.reject(`ÿßŸÑŸÖŸàÿ∏ŸÅ ${employee.name} ŸÖÿ∂ÿßŸÅ ÿ®ÿßŸÑŸÅÿπŸÑ`);
                }
                
                const newEmployee = {
                    name: employee.name,
                    phone: employee.phone,
                    job: defaultJob,
                    salary: defaultSalary,
                    workDays: defaultWorkDays,
                    active: true,
                    attendanceDays: 0
                };
                
                return addData('employees', newEmployee)
                    .then(() => {
                        return updateData('employeeDatabase', employeeId, { active: true });
                    });
            });
            
            Promise.allSettled(promises)
                .then(results => {
                    showLoadingState(false);
                    
                    const successful = results.filter(r => r.status === 'fulfilled').length;
                    const failed = results.filter(r => r.status === 'rejected').length;
                    
                    let message = `<div class="import-success">ÿ™ŸÖ ÿ•ÿ∂ÿßŸÅÿ© ${successful} ŸÖŸàÿ∏ŸÅ ÿ®ŸÜÿ¨ÿßÿ≠</div>`;
                    
                    if (failed > 0) {
                        message += `<div class="import-error"><strong>ŸÅÿ¥ŸÑ ŸÅŸä ÿ•ÿ∂ÿßŸÅÿ© ${failed} ŸÖŸàÿ∏ŸÅ:</strong><ul>`;
                        results.forEach((result, index) => {
                            if (result.status === 'rejected') {
                                message += `<li>${selectedOptions[index].textContent}: ${result.reason}</li>`;
                            }
                        });
                        message += `</ul></div>`;
                    }
                    
                    document.getElementById('defaultJob').value = '';
                    document.getElementById('defaultSalary').value = '';
                    document.getElementById('defaultWorkDays').value = '24';
                    selectElement.querySelectorAll('option').forEach(option => {
                        option.selected = false;
                    });
                    
                    const statusDiv = document.getElementById('importStatus');
                    statusDiv.innerHTML = message;
                    statusDiv.style.display = 'block';
                    
                    loadAllData();
                })
                .catch(error => {
                    showLoadingState(false);
                    const statusDiv = document.getElementById('importStatus');
                    statusDiv.innerHTML = `<div class="import-error">ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ÿ∫Ÿäÿ± ŸÖÿ™ŸàŸÇÿπ: ${error.message}</div>`;
                    statusDiv.style.display = 'block';
                });
        }

        // ==================== ÿØŸàÿßŸÑ ÿßÿ≥ÿ™Ÿäÿ±ÿßÿØ ÿ¨Ÿáÿßÿ™ ÿßŸÑÿßÿ™ÿµÿßŸÑ ====================

        function importContacts() {
            if ('contacts' in navigator && 'select' in navigator.contacts) {
                navigator.contacts.select(['name', 'tel'], { multiple: true })
                    .then(contacts => {
                        if (contacts.length === 0) {
                            alert('ŸÑŸÖ Ÿäÿ™ŸÖ ÿßÿÆÿ™Ÿäÿßÿ± ÿ£Ÿä ÿ¨Ÿáÿßÿ™ ÿßÿ™ÿµÿßŸÑ');
                            return;
                        }
                        displayContactsPreview(contacts);
                    })
                    .catch(error => {
                        console.error('ÿÆÿ∑ÿ£ ŸÅŸä ÿßÿ≥ÿ™Ÿäÿ±ÿßÿØ ÿ¨Ÿáÿßÿ™ ÿßŸÑÿßÿ™ÿµÿßŸÑ:', error);
                        alert('ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ŸÅŸä ÿßÿ≥ÿ™Ÿäÿ±ÿßÿØ ÿ¨Ÿáÿßÿ™ ÿßŸÑÿßÿ™ÿµÿßŸÑ. ŸÇÿØ ŸÑÿß ÿ™ŸÉŸàŸÜ Ÿáÿ∞Ÿá ÿßŸÑŸÖŸäÿ≤ÿ© ŸÖÿØÿπŸàŸÖÿ© ŸÅŸä ŸÖÿ™ÿµŸÅÿ≠ŸÉ.');
                    });
            } else {
                alert('ŸÖÿ™ÿµŸÅÿ≠ŸÉ ŸÑÿß ŸäÿØÿπŸÖ ÿßÿ≥ÿ™Ÿäÿ±ÿßÿØ ÿ¨Ÿáÿßÿ™ ÿßŸÑÿßÿ™ÿµÿßŸÑ. Ÿäÿ±ÿ¨Ÿâ ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ŸÖÿ™ÿµŸÅÿ≠ ÿ≠ÿØŸäÿ´ ŸäÿØÿπŸÖ Ÿáÿ∞Ÿá ÿßŸÑŸÖŸäÿ≤ÿ©.');
            }
        }

        function displayContactsPreview(contacts) {
            const previewDiv = document.getElementById('contactsPreview');
            const tbody = document.querySelector('#contactsPreviewTable tbody');
            tbody.innerHTML = '';
            
            contacts.forEach(contact => {
                const name = contact.name ? contact.name[0] : 'ÿ∫Ÿäÿ± ŸÖÿπÿ±ŸàŸÅ';
                const phone = contact.tel ? contact.tel[0] : 'ÿ∫Ÿäÿ± ŸÖÿ™ŸàŸÅÿ±';
                
                if (phone === 'ÿ∫Ÿäÿ± ŸÖÿ™ŸàŸÅÿ±') return;
                
                const isDuplicate = employeeDatabase.some(emp => 
                    emp.name === name || emp.phone === phone
                );
                
                const status = isDuplicate ? 'ŸÖŸàÿ¨ŸàÿØ ŸÖÿ≥ÿ®ŸÇÿßŸã' : 'ÿ¨ÿßŸáÿ≤ ŸÑŸÑÿ•ÿ∂ÿßŸÅÿ©';
                const statusClass = isDuplicate ? 'status-absent' : 'status-present';
                
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>
                        <input type="checkbox" class="contact-checkbox" ${isDuplicate ? 'disabled' : 'checked'} data-name="${name}" data-phone="${phone}">
                    </td>
                    <td>${name}</td>
                    <td>${phone}</td>
                    <td class="${statusClass}">${status}</td>
                `;
                tbody.appendChild(tr);
            });
            
            previewDiv.style.display = 'block';
        }

        function selectAllContacts() {
            const checkboxes = document.querySelectorAll('.contact-checkbox:not(:disabled)');
            checkboxes.forEach(checkbox => {
                checkbox.checked = true;
            });
        }

        function deselectAllContacts() {
            const checkboxes = document.querySelectorAll('.contact-checkbox:not(:disabled)');
            checkboxes.forEach(checkbox => {
                checkbox.checked = false;
            });
        }

        function addSelectedContacts() {
            const selectedContacts = [];
            const checkboxes = document.querySelectorAll('.contact-checkbox:checked:not(:disabled)');
            
            if (checkboxes.length === 0) {
                alert('Ÿäÿ±ÿ¨Ÿâ ÿßÿÆÿ™Ÿäÿßÿ± ÿ¨Ÿáÿßÿ™ ÿßÿ™ÿµÿßŸÑ ŸÑŸÑÿ•ÿ∂ÿßŸÅÿ©');
                return;
            }
            
            checkboxes.forEach(checkbox => {
                const name = checkbox.getAttribute('data-name');
                const phone = checkbox.getAttribute('data-phone');
                
                selectedContacts.push({
                    name,
                    phone,
                    whatsapp: phone,
                    address: '',
                    active: false
                });
            });
            
            showLoadingState(true);
            
            const promises = selectedContacts.map(contact => 
                addData('employeeDatabase', contact)
            );
            
            Promise.all(promises)
                .then(() => {
                    showLoadingState(false);
                    alert(`ÿ™ŸÖ ÿ•ÿ∂ÿßŸÅÿ© ${selectedContacts.length} ÿ¨Ÿáÿ© ÿßÿ™ÿµÿßŸÑ ÿ®ŸÜÿ¨ÿßÿ≠`);
                    document.getElementById('contactsPreview').style.display = 'none';
                    loadAllData();
                })
                .catch(error => {
                    showLoadingState(false);
                    alert('ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ÿ£ÿ´ŸÜÿßÿ° ÿ•ÿ∂ÿßŸÅÿ© ÿ¨Ÿáÿßÿ™ ÿßŸÑÿßÿ™ÿµÿßŸÑ. Ÿäÿ±ÿ¨Ÿâ ÿßŸÑŸÖÿ≠ÿßŸàŸÑÿ© ŸÖÿ±ÿ© ÿ£ÿÆÿ±Ÿâ.');
                });
        }

        // ==================== ÿØŸàÿßŸÑ ÿßŸÑŸÜÿ≥ÿÆ ÿßŸÑÿßÿ≠ÿ™Ÿäÿßÿ∑Ÿä ====================

        function downloadBackup() {
            const backupData = {
                employees: employees,
                attendance: attendance,
                leaves: leaves,
                financials: financials,
                employeeDatabase: employeeDatabase,
                cashTransactions: cashTransactions,
                stations: stations,
                supervisors: supervisors,
                faults: faults,
                backupDate: new Date().toISOString()
            };
            
            const dataStr = JSON.stringify(backupData, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `attendance_backup_${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
            
            alert('ÿ™ŸÖ ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÜÿ≥ÿÆÿ© ÿßŸÑÿßÿ≠ÿ™Ÿäÿßÿ∑Ÿäÿ© ÿ®ŸÜÿ¨ÿßÿ≠');
        }

        function restoreBackup() {
            const fileInput = document.getElementById('backupFile');
            const file = fileInput.files[0];
            
            if (!file) {
                alert('Ÿäÿ±ÿ¨Ÿâ ÿßÿÆÿ™Ÿäÿßÿ± ŸÖŸÑŸÅ ÿßŸÑŸÜÿ≥ÿÆÿ© ÿßŸÑÿßÿ≠ÿ™Ÿäÿßÿ∑Ÿäÿ©');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const backupData = JSON.parse(e.target.result);
                    
                    if (!backupData.employees || !backupData.attendance || !backupData.leaves || !backupData.financials) {
                        alert('ŸÖŸÑŸÅ ÿßŸÑŸÜÿ≥ÿÆÿ© ÿßŸÑÿßÿ≠ÿ™Ÿäÿßÿ∑Ÿäÿ© ÿ∫Ÿäÿ± ÿµÿßŸÑÿ≠');
                        return;
                    }
                    
                    if (confirm('ŸáŸÑ ÿ£ŸÜÿ™ ŸÖÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿßÿ≥ÿ™ÿπÿßÿØÿ© ÿßŸÑŸÜÿ≥ÿÆÿ© ÿßŸÑÿßÿ≠ÿ™Ÿäÿßÿ∑Ÿäÿ©ÿü ÿ≥Ÿäÿ™ŸÖ ÿßÿ≥ÿ™ÿ®ÿØÿßŸÑ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿ≠ÿßŸÑŸäÿ©.')) {
                        showLoadingState(true);
                        
                        Promise.all([
                            saveData('employees', backupData.employees),
                            saveData('attendance', backupData.attendance),
                            saveData('leaves', backupData.leaves),
                            saveData('financials', backupData.financials),
                            saveData('employeeDatabase', backupData.employeeDatabase || []),
                            saveData('cashTransactions', backupData.cashTransactions || []),
                            saveData('stations', backupData.stations || []),
                            saveData('supervisors', backupData.supervisors || []),
                            saveData('faults', backupData.faults || [])
                        ]).then(() => {
                            showLoadingState(false);
                            alert('ÿ™ŸÖ ÿßÿ≥ÿ™ÿπÿßÿØÿ© ÿßŸÑŸÜÿ≥ÿÆÿ© ÿßŸÑÿßÿ≠ÿ™Ÿäÿßÿ∑Ÿäÿ© ÿ®ŸÜÿ¨ÿßÿ≠');
                            showPage('dashboard');
                            loadAllData();
                        }).catch(error => {
                            showLoadingState(false);
                            alert('ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ÿ£ÿ´ŸÜÿßÿ° ÿßÿ≥ÿ™ÿπÿßÿØÿ© ÿßŸÑŸÜÿ≥ÿÆÿ© ÿßŸÑÿßÿ≠ÿ™Ÿäÿßÿ∑Ÿäÿ©. Ÿäÿ±ÿ¨Ÿâ ÿßŸÑŸÖÿ≠ÿßŸàŸÑÿ© ŸÖÿ±ÿ© ÿ£ÿÆÿ±Ÿâ.');
                        });
                    }
                } catch (error) {
                    console.error(error);
                    alert('ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ÿ£ÿ´ŸÜÿßÿ° ÿßÿ≥ÿ™ÿπÿßÿØÿ© ÿßŸÑŸÜÿ≥ÿÆÿ© ÿßŸÑÿßÿ≠ÿ™Ÿäÿßÿ∑Ÿäÿ©. Ÿäÿ±ÿ¨Ÿâ ÿßŸÑÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿµÿ≠ÿ© ÿßŸÑŸÖŸÑŸÅ.');
                }
            };
            reader.readAsText(file);
        }

        function deleteAllData() {
            if (confirm('ŸáŸÑ ÿ£ŸÜÿ™ ŸÖÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ≠ÿ∞ŸÅ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ÿü Ÿáÿ∞ÿß ÿßŸÑÿ•ÿ¨ÿ±ÿßÿ° ŸÑÿß ŸäŸÖŸÉŸÜ ÿßŸÑÿ™ÿ±ÿßÿ¨ÿπ ÿπŸÜŸá.')) {
                showLoadingState(true);
                
                Promise.all([
                    saveData('employees', []),
                    saveData('attendance', []),
                    saveData('leaves', []),
                    saveData('financials', []),
                    saveData('employeeDatabase', []),
                    saveData('cashTransactions', []),
                    saveData('stations', []),
                    saveData('supervisors', []),
                    saveData('faults', [])
                ]).then(() => {
                    showLoadingState(false);
                    alert('ÿ™ŸÖ ÿ≠ÿ∞ŸÅ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿ®ŸÜÿ¨ÿßÿ≠');
                    showPage('dashboard');
                    loadAllData();
                }).catch(error => {
                    showLoadingState(false);
                    alert('ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ÿ£ÿ´ŸÜÿßÿ° ÿ≠ÿ∞ŸÅ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™. Ÿäÿ±ÿ¨Ÿâ ÿßŸÑŸÖÿ≠ÿßŸàŸÑÿ© ŸÖÿ±ÿ© ÿ£ÿÆÿ±Ÿâ.');
                });
            }
        }

        function deleteSelectiveData() {
            const dataType = document.getElementById('selectiveDataType').value;
            const startDate = document.getElementById('selectiveStartDate').value;
            const endDate = document.getElementById('selectiveEndDate').value;

            if (!startDate || !endDate) {
                alert('Ÿäÿ±ÿ¨Ÿâ ÿ™ÿ≠ÿØŸäÿØ ÿ™ÿßÿ±ŸäÿÆ ÿßŸÑÿ®ÿØÿßŸäÿ© ŸàÿßŸÑŸÜŸáÿßŸäÿ©');
                return;
            }

            if (new Date(startDate) > new Date(endDate)) {
                alert('ÿ™ÿßÿ±ŸäÿÆ ÿßŸÑÿ®ÿØÿßŸäÿ© Ÿäÿ¨ÿ® ÿ£ŸÜ ŸäŸÉŸàŸÜ ŸÇÿ®ŸÑ ÿ™ÿßÿ±ŸäÿÆ ÿßŸÑŸÜŸáÿßŸäÿ©');
                return;
            }

            let dataArray, dataTypeName;
            switch (dataType) {
                case 'attendance':
                    dataArray = attendance;
                    dataTypeName = 'ÿ≥ÿ¨ŸÑÿßÿ™ ÿßŸÑÿ≠ÿ∂Ÿàÿ±';
                    break;
                case 'financials':
                    dataArray = financials;
                    dataTypeName = 'ÿßŸÑÿ≠ÿ±ŸÉÿßÿ™ ÿßŸÑŸÖÿßŸÑŸäÿ©';
                    break;
                case 'cashTransactions':
                    dataArray = cashTransactions;
                    dataTypeName = 'ÿ≠ÿ±ŸÉÿßÿ™ ÿßŸÑÿπŸáÿØÿ©';
                    break;
                case 'faults':
                    dataArray = faults;
                    dataTypeName = 'ÿ≥ÿ¨ŸÑ ÿßŸÑÿ£ÿπÿ∑ÿßŸÑ';
                    break;
                default:
                    alert('ŸÜŸàÿπ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿ∫Ÿäÿ± ÿµÿ≠Ÿäÿ≠');
                    return;
            }

            const recordsToDelete = dataArray.filter(record => {
                return record.date >= startDate && record.date <= endDate;
            });

            if (recordsToDelete.length === 0) {
                alert(`ŸÑÿß ÿ™Ÿàÿ¨ÿØ ${dataTypeName} ŸÅŸä ÿßŸÑŸÅÿ™ÿ±ÿ© ÿßŸÑŸÖÿ≠ÿØÿØÿ©`);
                return;
            }

            if (confirm(`ŸáŸÑ ÿ£ŸÜÿ™ ŸÖÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ≠ÿ∞ŸÅ ${recordsToDelete.length} ÿ≥ÿ¨ŸÑ ŸÖŸÜ ${dataTypeName} ŸÑŸÑŸÅÿ™ÿ±ÿ© ŸÖŸÜ ${startDate} ÿ•ŸÑŸâ ${endDate}ÿü Ÿáÿ∞ÿß ÿßŸÑÿ•ÿ¨ÿ±ÿßÿ° ŸÑÿß ŸäŸÖŸÉŸÜ ÿßŸÑÿ™ÿ±ÿßÿ¨ÿπ ÿπŸÜŸá.`)) {
                showLoadingState(true);

                const deletePromises = recordsToDelete.map(record => deleteData(dataType, record.id));

                Promise.all(deletePromises)
                    .then(() => {
                        showLoadingState(false);
                        alert(`ÿ™ŸÖ ÿ≠ÿ∞ŸÅ ${recordsToDelete.length} ÿ≥ÿ¨ŸÑ ÿ®ŸÜÿ¨ÿßÿ≠`);
                        loadAllData();
                    })
                    .catch(error => {
                        showLoadingState(false);
                        alert('ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ÿ£ÿ´ŸÜÿßÿ° ÿ≠ÿ∞ŸÅ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™. Ÿäÿ±ÿ¨Ÿâ ÿßŸÑŸÖÿ≠ÿßŸàŸÑÿ© ŸÖÿ±ÿ© ÿ£ÿÆÿ±Ÿâ.');
                    });
            }
        }

        // ==================== ÿØŸàÿßŸÑ ÿßŸÑÿ™ÿµÿØŸäÿ± ÿ•ŸÑŸâ Excel ====================

        function exportAllData() {
            const data = {
                ÿßŸÑŸÖŸàÿ∏ŸÅŸàŸÜ: employees,
                ÿßŸÑÿ≠ÿ∂Ÿàÿ±: attendance,
                ÿßŸÑÿ•ÿ¨ÿßÿ≤ÿßÿ™: leaves,
                ÿßŸÑÿ≠ÿ±ŸÉÿßÿ™_ÿßŸÑŸÖÿßŸÑŸäÿ©: financials,
                ŸÇÿßÿπÿØÿ©_ÿ®ŸäÿßŸÜÿßÿ™_ÿßŸÑŸÖŸàÿ∏ŸÅŸäŸÜ: employeeDatabase,
                ÿ≠ÿ±ŸÉÿßÿ™_ÿßŸÑÿπŸáÿØÿ©: cashTransactions,
                ÿßŸÑŸÖÿ≠ÿ∑ÿßÿ™: stations,
                ÿßŸÑŸÖÿ≥ÿ§ŸàŸÑŸàŸÜ: supervisors,
                ÿßŸÑÿ£ÿπÿ∑ÿßŸÑ: faults
            };
            
            exportToExcel(data, 'ÿ¨ŸÖŸäÿπ_ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™');
        }

        function exportEmployeesToExcel() {
            const data = employees.map(emp => ({
                'ÿßÿ≥ŸÖ ÿßŸÑŸÖŸàÿ∏ŸÅ': emp.name,
                'ÿ±ŸÇŸÖ ÿßŸÑŸáÿßÿ™ŸÅ': emp.phone,
                'ÿßŸÑŸàÿ∏ŸäŸÅÿ©': emp.job,
                'ÿßŸÑÿ±ÿßÿ™ÿ® ÿßŸÑÿ£ÿ≥ÿßÿ≥Ÿä (ÿ¨.ŸÖ)': emp.salary,
                'ÿ£ŸäÿßŸÖ ÿßŸÑÿπŸÖŸÑ ÿßŸÑŸÖÿ™ŸÅŸÇ ÿπŸÑŸäŸáÿß': emp.workDays,
                'ÿ£ŸäÿßŸÖ ÿßŸÑÿ≠ÿ∂Ÿàÿ± ÿßŸÑŸÅÿπŸÑŸäÿ©': emp.attendanceDays,
                'ÿßŸÑÿ≠ÿßŸÑÿ©': emp.active ? 'ŸÅÿπÿßŸÑ' : 'ÿ∫Ÿäÿ± ŸÅÿπÿßŸÑ'
            }));
            
            exportToExcel(data, 'ÿ®ŸäÿßŸÜÿßÿ™_ÿßŸÑŸÖŸàÿ∏ŸÅŸäŸÜ');
        }

        function exportEmployeeDatabaseToExcel() {
            const data = employeeDatabase.map(emp => ({
                'ÿßÿ≥ŸÖ ÿßŸÑŸÖŸàÿ∏ŸÅ': emp.name,
                'ÿ±ŸÇŸÖ ÿßŸÑŸáÿßÿ™ŸÅ': emp.phone,
                'ÿ±ŸÇŸÖ ÿßŸÑŸàÿßÿ™ÿ≥ÿßÿ®': emp.whatsapp || emp.phone,
                'ÿßŸÑÿπŸÜŸàÿßŸÜ': emp.address || 'ÿ∫Ÿäÿ± ŸÖÿ≠ÿØÿØ',
                'ÿßŸÑÿ≠ÿßŸÑÿ©': emp.active ? 'ŸÖŸÅÿπŸÑ' : 'ÿ∫Ÿäÿ± ŸÖŸÅÿπŸÑ'
            }));
            
            exportToExcel(data, 'ŸÇÿßÿπÿØÿ©_ÿ®ŸäÿßŸÜÿßÿ™_ÿßŸÑŸÖŸàÿ∏ŸÅŸäŸÜ');
        }

        function exportAttendanceToExcel() {
            const month = document.getElementById('filterAttendanceMonth').value;
            const stationFilter = document.getElementById('filterAttendanceStation').value;
            
            let filteredAttendance = attendance.filter(record => record.date.startsWith(month));
            
            if (stationFilter) {
                filteredAttendance = filteredAttendance.filter(record => record.stationName === stationFilter);
            }
            
            const data = filteredAttendance.map(record => {
                const supervisor = supervisors.find(sup => sup.id === record.supervisorId);
                const supervisorName = supervisor ? supervisor.employeeName : (record.supervisorName || 'ÿ∫Ÿäÿ± ŸÖÿ≠ÿØÿØ');
                
                return {
                    'ÿßÿ≥ŸÖ ÿßŸÑŸÖŸàÿ∏ŸÅ': record.employeeName,
                    'ÿßŸÑŸÖÿ≠ÿ∑ÿ©': record.stationName || 'ÿ∫Ÿäÿ± ŸÖÿ≠ÿØÿØ',
                    'ÿßŸÑŸÖÿ≥ÿ§ŸàŸÑ': supervisorName,
                    'ÿßŸÑÿ™ÿßÿ±ŸäÿÆ': record.date,
                    'ÿßŸÑÿ≠ÿßŸÑÿ©': record.status
                };
            });
            
            exportToExcel(data, 'ÿ≥ÿ¨ŸÑ_ÿßŸÑÿ≠ÿ∂Ÿàÿ±');
        }

        function exportLeavesToExcel() {
            const data = leaves.map(leave => {
                const startDate = new Date(leave.start);
                const endDate = new Date(leave.end);
                const duration = Math.ceil((endDate - startDate) / (1000 * 60 * 60 * 24)) + 1;
                
                const supervisor = supervisors.find(sup => sup.id === leave.supervisorId);
                const supervisorName = supervisor ? supervisor.employeeName : (leave.supervisorName || 'ÿ∫Ÿäÿ± ŸÖÿ≠ÿØÿØ');
                
                return {
                    'ÿßÿ≥ŸÖ ÿßŸÑŸÖŸàÿ∏ŸÅ': leave.employeeName,
                    'ÿßŸÑŸÖÿ≠ÿ∑ÿ©': leave.stationName || 'ÿ∫Ÿäÿ± ŸÖÿ≠ÿØÿØ',
                    'ÿßŸÑŸÖÿ≥ÿ§ŸàŸÑ': supervisorName,
                    'ŸÜŸàÿπ ÿßŸÑÿ•ÿ¨ÿßÿ≤ÿ©': leave.type,
                    'ÿ™ÿßÿ±ŸäÿÆ ÿßŸÑÿ®ÿØÿ°': leave.start,
                    'ÿ™ÿßÿ±ŸäÿÆ ÿßŸÑÿßŸÜÿ™Ÿáÿßÿ°': leave.end,
                    'ÿßŸÑŸÖÿØÿ© (ÿ£ŸäÿßŸÖ)': duration,
                    'ŸÖŸÑÿßÿ≠ÿ∏ÿßÿ™': leave.notes
                };
            });
            
            exportToExcel(data, 'ÿ≥ÿ¨ŸÑ_ÿßŸÑÿ•ÿ¨ÿßÿ≤ÿßÿ™');
        }

        function exportFinancialsToExcel() {
            const month = document.getElementById('filterFinancialMonth') ? 
                         document.getElementById('filterFinancialMonth').value : '';
            const employeeFilter = document.getElementById('filterFinancialEmployee') ? 
                              document.getElementById('filterFinancialEmployee').value : '';
            const stationFilter = document.getElementById('filterFinancialStation') ? 
                              document.getElementById('filterFinancialStation').value : '';
            const typeFilter = document.getElementById('filterFinancialType') ? 
                              document.getElementById('filterFinancialType').value : '';
            
            let filteredFinancials = financials;
            
            if (month) {
                filteredFinancials = filteredFinancials.filter(financial => 
                    financial.date.startsWith(month)
                );
            }
            
            if (employeeFilter) {
                filteredFinancials = filteredFinancials.filter(financial => 
                    financial.employeeName === employeeFilter
                );
            }
            
            if (stationFilter) {
                filteredFinancials = filteredFinancials.filter(financial => 
                    financial.stationName === stationFilter
                );
            }
            
            if (typeFilter) {
                filteredFinancials = filteredFinancials.filter(financial => 
                    financial.type === typeFilter
                );
            }
            
            const data = filteredFinancials.map(financial => {
                const supervisor = supervisors.find(sup => sup.id === financial.supervisorId);
                const supervisorName = supervisor ? supervisor.employeeName : (financial.supervisorName || 'ÿ∫Ÿäÿ± ŸÖÿ≠ÿØÿØ');
                
                return {
                    'ÿßÿ≥ŸÖ ÿßŸÑŸÖŸàÿ∏ŸÅ': financial.employeeName,
                    'ÿßŸÑŸÖÿ≠ÿ∑ÿ©': financial.stationName || 'ÿ∫Ÿäÿ± ŸÖÿ≠ÿØÿØ',
                    'ÿßŸÑŸÖÿ≥ÿ§ŸàŸÑ': supervisorName,
                    'ÿßŸÑŸÜŸàÿπ': financial.type,
                    'ÿßŸÑŸÖÿ®ŸÑÿ∫ (ÿ¨.ŸÖ)': financial.amount,
                    'ÿßŸÑÿ™ÿßÿ±ŸäÿÆ': financial.date,
                    'ŸÖŸÑÿßÿ≠ÿ∏ÿßÿ™': financial.notes
                };
            });
            
            exportToExcel(data, 'ÿßŸÑÿ≠ÿ±ŸÉÿßÿ™_ÿßŸÑŸÖÿßŸÑŸäÿ©');
        }

        function exportReportToExcel() {
            const month = document.getElementById('reportMonth').value;
            const data = [];
            
            employees.forEach(emp => {
                const workDays = attendance.filter(record => 
                    record.employeeName === emp.name && 
                    record.date.startsWith(month) && 
                    record.status === 'ÿ≠ÿßÿ∂ÿ±'
                ).length;
                
                const dailyRate = emp.salary / 30;
                let netSalary = 0;
                let extraDays = 0;
                let extraSalary = 0;
                
                if (workDays >= emp.workDays) {
                    netSalary = emp.salary;
                    
                    if (workDays > emp.workDays) {
                        extraDays = workDays - emp.workDays;
                        extraSalary = extraDays * dailyRate;
                        netSalary += extraSalary;
                    }
                } else {
                    netSalary = workDays * dailyRate;
                }
                
                const employeeFinancials = financials.filter(f => 
                    f.employeeName === emp.name && f.date.startsWith(month)
                );
                
                const loans = employeeFinancials
                    .filter(f => f.type === 'ÿ≥ŸÑŸÅÿ©')
                    .reduce((sum, f) => sum + f.amount, 0);
                
                const rewards = employeeFinancials
                    .filter(f => f.type === 'ŸÖŸÉÿßŸÅÿ£ÿ©')
                    .reduce((sum, f) => sum + f.amount, 0);
                
                const deductions = employeeFinancials
                    .filter(f => f.type === 'ÿÆÿµŸÖ')
                    .reduce((sum, f) => sum + f.amount, 0);
                
                netSalary = netSalary + rewards - loans - deductions;
                
                data.push({
                    'ÿßÿ≥ŸÖ ÿßŸÑŸÖŸàÿ∏ŸÅ': emp.name,
                    'ÿßŸÑÿ±ÿßÿ™ÿ® ÿßŸÑÿ£ÿ≥ÿßÿ≥Ÿä (ÿ¨.ŸÖ)': emp.salary,
                    'ÿ£ŸäÿßŸÖ ÿßŸÑÿπŸÖŸÑ ÿßŸÑŸÖÿ™ŸÅŸÇ ÿπŸÑŸäŸáÿß': emp.workDays,
                    'ÿ£ŸäÿßŸÖ ÿßŸÑÿπŸÖŸÑ ÿßŸÑŸÅÿπŸÑŸäÿ©': workDays,
                    'ÿßŸÑÿ£ŸäÿßŸÖ ÿßŸÑÿ•ÿ∂ÿßŸÅŸäÿ©': extraDays,
                    'ŸÇŸäŸÖÿ© ÿßŸÑÿ£ŸäÿßŸÖ ÿßŸÑÿ•ÿ∂ÿßŸÅŸäÿ© (ÿ¨.ŸÖ)': extraSalary.toFixed(2),
                    'ÿßŸÑÿ≥ŸÑŸÅ (ÿ¨.ŸÖ)': loans,
                    'ÿßŸÑŸÖŸÉÿßŸÅÿ¢ÿ™ (ÿ¨.ŸÖ)': rewards,
                    'ÿßŸÑÿÆÿµŸàŸÖÿßÿ™ (ÿ¨.ŸÖ)': deductions,
                    'ÿµÿßŸÅŸä ÿßŸÑÿ±ÿßÿ™ÿ® (ÿ¨.ŸÖ)': Math.round(netSalary)
                });
            });
            
            exportToExcel(data, 'ÿ™ŸÇÿ±Ÿäÿ±_ÿßŸÑŸÖÿ±ÿ™ÿ®ÿßÿ™');
        }

        function exportCashToExcel() {
            const dateFilter = document.getElementById('filterCashDate').value;
            const typeFilter = document.getElementById('filterCashType').value;
            const supervisorFilter = document.getElementById('filterCashSupervisor').value;
            
            let filteredTransactions = [...cashTransactions];
            
            if (dateFilter) {
                filteredTransactions = filteredTransactions.filter(t => t.date === dateFilter);
            }
            
            if (typeFilter) {
                filteredTransactions = filteredTransactions.filter(t => t.type === typeFilter);
            }
            
            if (supervisorFilter) {
                filteredTransactions = filteredTransactions.filter(t => t.supervisorId === supervisorFilter);
            }
            
            const data = filteredTransactions.map(transaction => {
                const supervisor = supervisors.find(sup => sup.id === transaction.supervisorId);
                const supervisorName = supervisor ? supervisor.employeeName : (transaction.supervisorName || 'ÿ∫Ÿäÿ± ŸÖÿπÿ±ŸàŸÅ');
                
                const baseData = {
                    'ÿßŸÑÿ™ÿßÿ±ŸäÿÆ': transaction.date,
                    'ÿßŸÑŸÜŸàÿπ': transaction.type,
                    'ÿßŸÑŸÖÿ®ŸÑÿ∫ (ÿ¨.ŸÖ)': transaction.amount,
                    'ÿßŸÑŸÖÿ≥ÿ§ŸàŸÑ': supervisorName,
                    'ÿßŸÑŸÖÿ≠ÿ∑ÿ©': transaction.stationName || 'ÿ∫Ÿäÿ± ŸÖÿ≠ÿØÿØ'
                };
                
                if (transaction.type === 'ÿ•ŸäÿØÿßÿπ') {
                    baseData['ÿ≥ÿ®ÿ® ÿßŸÑÿ•ŸäÿØÿßÿπ'] = transaction.reason;
                } else {
                    baseData['ÿ≥ÿ®ÿ® ÿßŸÑÿµÿ±ŸÅ'] = transaction.reason;
                    baseData['ÿßŸÑŸÖÿ≥ÿ™ŸÑŸÖ'] = transaction.recipient;
                }
                
                if (transaction.notes) {
                    baseData['ŸÖŸÑÿßÿ≠ÿ∏ÿßÿ™'] = transaction.notes;
                }
                
                return baseData;
            });
            
            exportToExcel(data, 'ÿ≠ÿ±ŸÉÿßÿ™_ÿßŸÑÿπŸáÿØÿ©');
        }

        function exportFaultsToExcel() {
            const data = faults.map(fault => {
                let statusText = '';
                if (fault.status === 'fixed') statusText = 'ÿ™ŸÖ ÿßŸÑÿ•ÿµŸÑÿßÿ≠';
                else if (fault.status === 'in-progress') statusText = 'ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ•ÿµŸÑÿßÿ≠';
                else statusText = 'ŸÑŸÖ Ÿäÿ™ŸÖ ÿßŸÑÿ•ÿµŸÑÿßÿ≠';
                
                return {
                    'ÿßŸÑŸÖÿ≠ÿ∑ÿ©': fault.stationName,
                    'ÿßŸÑŸÖÿ≥ÿ§ŸàŸÑ': fault.supervisorName,
                    'ÿπŸÜŸàÿßŸÜ ÿßŸÑÿπÿ∑ŸÑ': fault.title,
                    'ÿ™ŸÅÿßÿµŸäŸÑ ÿßŸÑÿπÿ∑ŸÑ': fault.description,
                    'ÿßŸÑÿ™ÿßÿ±ŸäÿÆ': fault.date,
                    'ÿßŸÑÿ≠ÿßŸÑÿ©': statusText
                };
            });
            
            exportToExcel(data, 'ÿ≥ÿ¨ŸÑ_ÿßŸÑÿ£ÿπÿ∑ÿßŸÑ');
        }

        function exportStationsToExcel() {
            const data = stations.map(station => ({
                'ÿßÿ≥ŸÖ ÿßŸÑŸÖÿ≠ÿ∑ÿ©': station.name,
                'ÿßŸÑŸÜŸàÿπ': station.type,
                'ÿßŸÑŸÖÿ≠ÿßŸÅÿ∏ÿ©': station.governorate,
                'ÿßŸÑŸÖŸÜÿ∑ŸÇÿ©': station.area,
                'ÿßŸÑÿπŸÜŸàÿßŸÜ': station.address
            }));
            
            exportToExcel(data, 'ŸÇÿßÿ¶ŸÖÿ©_ÿßŸÑŸÖÿ≠ÿ∑ÿßÿ™');
        }

        function exportSupervisorsToExcel() {
            const data = supervisors.map(sup => ({
                'ÿßÿ≥ŸÖ ÿßŸÑŸÖÿ≥ÿ§ŸàŸÑ': sup.employeeName,
                'ÿ±ŸÇŸÖ ÿßŸÑŸáÿßÿ™ŸÅ': sup.employeePhone,
                'ŸÉŸÑŸÖÿ© ÿßŸÑÿ≥ÿ±': sup.password,
                'ÿßŸÑÿ≠ÿßŸÑÿ©': sup.active ? 'ŸÅÿπÿßŸÑ' : 'ÿ∫Ÿäÿ± ŸÅÿπÿßŸÑ',
                'ÿ™ÿßÿ±ŸäÿÆ ÿßŸÑÿ•ÿ∂ÿßŸÅÿ©': sup.createdAt ? new Date(sup.createdAt).toLocaleDateString('ar-EG') : ''
            }));
            
            exportToExcel(data, 'ŸÇÿßÿ¶ŸÖÿ©_ÿßŸÑŸÖÿ≥ÿ§ŸàŸÑŸäŸÜ');
        }

        function exportToExcel(data, fileName) {
            try {
                const worksheet = XLSX.utils.json_to_sheet(data);
                const workbook = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(workbook, worksheet, "Sheet1");
                XLSX.writeFile(workbook, `${fileName}.xlsx`);
                alert(`ÿ™ŸÖ ÿ™ÿµÿØŸäÿ± ${fileName} ÿ®ŸÜÿ¨ÿßÿ≠`);
            } catch (error) {
                console.error('ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑÿ™ÿµÿØŸäÿ±:', error);
                alert('ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ÿ£ÿ´ŸÜÿßÿ° ÿßŸÑÿ™ÿµÿØŸäÿ±ÿå Ÿäÿ±ÿ¨Ÿâ ÿßŸÑŸÖÿ≠ÿßŸàŸÑÿ© ŸÖÿ±ÿ© ÿ£ÿÆÿ±Ÿâ');
            }
        }

        // ÿ¨ÿπŸÑ ÿßŸÑÿØŸàÿßŸÑ ŸÖÿ™ÿßÿ≠ÿ© ÿπÿßŸÑŸÖŸäÿßŸã
        window.editLeave = editLeave;
        window.deleteLeave = deleteLeave;
        window.editFinancial = editFinancial;
        window.deleteFinancial = deleteFinancial;
        window.editEmployee = editEmployee;
        window.toggleEmployeeStatus = toggleEmployeeStatus;
        window.callEmployee = callEmployee;
        window.sendWhatsAppToEmployee = sendWhatsAppToEmployee;
        window.activateEmployeeFromDatabase = activateEmployeeFromDatabase;
        window.editEmployeeInDatabase = editEmployeeInDatabase;
        window.deleteEmployeeFromDatabase = deleteEmployeeFromDatabase;
        window.showSalaryDetails = showSalaryDetails;
        window.sendWhatsAppMessage = sendWhatsAppMessage;
        window.exportEmployeeReportToExcel = exportEmployeeReportToExcel;
        window.sendEmployeeReportWhatsApp = sendEmployeeReportWhatsApp;
        window.editStation = editStation;
        window.deleteStation = deleteStation;
        window.editSupervisor = editSupervisor;
        window.deleteSupervisor = deleteSupervisor;
        window.editFault = editFault;
        window.deleteFault = deleteFault;
    </script>
    
    <script>
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('https://yasminnmain44-design.github.io/Management/service-worker.js').catch(function(error) {
                console.log('ServiceWorker registration failed: ', error);
            });
            
            const swCode = `
                const CACHE_NAME = 'attendance-cache-v1';
                const urlsToCache = [
                    'https://yasminnmain44-design.github.io/Management/',
                    'https://yasminnmain44-design.github.io/Management/index.html',
                    'https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css',
                    'https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js',
                    'https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js',
                    'https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js'
                ];

                self.addEventListener('install', function(event) {
                    event.waitUntil(
                        caches.open(CACHE_NAME)
                            .then(function(cache) {
                                console.log('Opened cache');
                                return cache.addAll(urlsToCache);
                            })
                    );
                });

                self.addEventListener('fetch', function(event) {
                    event.respondWith(
                        caches.match(event.request)
                            .then(function(response) {
                                if (response) {
                                    return response;
                                }
                                return fetch(event.request);
                            })
                    );
                });
            `;
            
            const blob = new Blob([swCode], { type: 'application/javascript' });
            const url = URL.createObjectURL(blob);
            
            navigator.serviceWorker.register(url).then(function(registration) {
                console.log('ServiceWorker registered successfully');
            }).catch(function(error) {
                console.log('ServiceWorker registration failed: ', error);
            });
        }
    </script>
</body>
</html>
